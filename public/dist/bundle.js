/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={43:(e,t,n)=>{n.d(t,{eJ:()=>tt,xI:()=>mn,gA:()=>rt,zK:()=>Je,x9:()=>nt});var r=n(461),i=n(126),s=n(424);function o(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var a=n(125);const c=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},u=new i.FA("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),l=new s.Vy("@firebase/auth");function h(e,...t){l.logLevel<=s.$b.ERROR&&l.error(`Auth (${r.MF}): ${e}`,...t)}function d(e,...t){throw g(e,...t)}function f(e,...t){return g(e,...t)}function p(e,t,n){const r=Object.assign(Object.assign({},c()),{[t]:n});return new i.FA("auth","Firebase",r).create(t,{appName:e.name})}function m(e){return p(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function g(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return u.create(e,...t)}function y(e,t,...n){if(!e)throw g(t,...n)}function v(e){const t="INTERNAL ASSERTION FAILED: "+e;throw h(t),new Error(t)}function w(e,t){e||v(t)}function b(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function E(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class _{constructor(e,t){this.shortDelay=e,this.longDelay=t,w(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.jZ)()||(0,i.lV)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===E()||"https:"===E()||(0,i.sr)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function I(e,t){w(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class T{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void v("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void v("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void v("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const S={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},k=new _(3e4,6e4);function C(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function A(e,t,n,r,s={}){return N(e,s,(async()=>{let s={},o={};r&&("GET"===t?o=r:s={body:JSON.stringify(r)});const a=(0,i.Am)(Object.assign({key:e.config.apiKey},o)).slice(1),c=await e._getAdditionalHeaders();c["Content-Type"]="application/json",e.languageCode&&(c["X-Firebase-Locale"]=e.languageCode);const u=Object.assign({method:t,headers:c},s);return(0,i.c1)()||(u.referrerPolicy="no-referrer"),T.fetch()(O(e,e.config.apiHost,n,a),u)}))}async function N(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},S),t);try{const t=new R(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw D(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw D(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw D(e,"email-already-in-use",s);if("USER_DISABLED"===n)throw D(e,"user-disabled",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw p(e,a,o);d(e,a)}}catch(t){if(t instanceof i.g)throw t;d(e,"network-request-failed",{message:String(t)})}}async function x(e,t,n,r,i={}){const s=await A(e,t,n,r,i);return"mfaPendingCredential"in s&&d(e,"multi-factor-auth-required",{_serverResponse:s}),s}function O(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?I(e.config,i):`${e.config.apiScheme}://${i}`}function L(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class R{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(f(this.auth,"network-request-failed"))),k.get())}))}}function D(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=f(e,t,r);return i.customData._tokenResponse=n,i}function P(e){return void 0!==e&&void 0!==e.enterprise}class M{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return L(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function U(e,t){return A(e,"GET","/v2/recaptchaConfig",C(e,t))}async function F(e,t){return A(e,"POST","/v1/accounts:lookup",t)}function V(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function j(e){return 1e3*Number(e)}function B(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return h("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,i.u)(n);return e?JSON.parse(e):(h("Failed to decode base64 JWT payload"),null)}catch(e){return h("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function z(e){const t=B(e);return y(t,"internal-error"),y(void 0!==t.exp,"internal-error"),y(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function q(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof i.g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ${constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class G{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=V(this.lastLoginAt),this.creationTime=V(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function K(e){var t;const n=e.auth,r=await e.getIdToken(),i=await q(e,F(n,{idToken:r}));y(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?H(s.providerUserInfo):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new G(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}function H(e){return e.map((e=>{var{providerId:t}=e,n=o(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class W{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){y(e.idToken,"internal-error"),y(void 0!==e.idToken,"internal-error"),y(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):z(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){y(0!==e.length,"internal-error");const t=z(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(y(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await N(e,{},(async()=>{const n=(0,i.Am)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,o=O(e,r,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",T.fetch()(o,{method:"POST",headers:a,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new W;return n&&(y("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(y("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(y("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new W,this.toJSON())}_performRefresh(){return v("not implemented")}}function Q(e,t){y("string"==typeof e||void 0===e,"internal-error",{appName:t})}class J{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=o(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new $(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new G(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await q(this,this.stsTokenManager.getToken(this.auth,e));return y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,i.Ku)(e),r=await n.getIdToken(t),s=B(r);y(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:r,authTime:V(j(s.auth_time)),issuedAtTime:V(j(s.iat)),expirationTime:V(j(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,i.Ku)(e);await K(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new J(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await K(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,r.xZ)(this.auth.app))return Promise.reject(m(this.auth));const e=await this.getIdToken();return await q(this,async function(e,t){return A(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,v=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:w,emailVerified:b,isAnonymous:E,providerData:_,stsTokenManager:I}=t;y(w&&I,e,"internal-error");const T=W.fromJSON(this.name,I);y("string"==typeof w,e,"internal-error"),Q(l,e.name),Q(h,e.name),y("boolean"==typeof b,e,"internal-error"),y("boolean"==typeof E,e,"internal-error"),Q(d,e.name),Q(f,e.name),Q(p,e.name),Q(m,e.name),Q(g,e.name),Q(v,e.name);const S=new J({uid:w,auth:e,email:h,emailVerified:b,displayName:l,isAnonymous:E,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:v});return _&&Array.isArray(_)&&(S.providerData=_.map((e=>Object.assign({},e)))),m&&(S._redirectEventId=m),S}static async _fromIdTokenResponse(e,t,n=!1){const r=new W;r.updateFromServerResponse(t);const i=new J({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await K(i),i}static async _fromGetAccountInfoResponse(e,t,n){const r=t.users[0];y(void 0!==r.localId,"internal-error");const i=void 0!==r.providerUserInfo?H(r.providerUserInfo):[],s=!(r.email&&r.passwordHash||(null==i?void 0:i.length)),o=new W;o.updateFromIdToken(n);const a=new J({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new G(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==i?void 0:i.length))};return Object.assign(a,c),a}}const Y=new Map;function X(e){w(e instanceof Function,"Expected a class definition");let t=Y.get(e);return t?(w(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Y.set(e,t),t)}class Z{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Z.type="NONE";const ee=Z;function te(e,t,n){return`firebase:${e}:${t}:${n}`}class ne{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=te(this.userKey,r.apiKey,i),this.fullPersistenceKey=te("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?J._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ne(X(ee),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||X(ee);const s=te(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=J._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new ne(i,e,n)):new ne(i,e,n)}}function re(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ae(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ie(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ue(t))return"Blackberry";if(le(t))return"Webos";if(se(t))return"Safari";if((t.includes("chrome/")||oe(t))&&!t.includes("edge/"))return"Chrome";if(ce(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function ie(e=(0,i.ZQ)()){return/firefox\//i.test(e)}function se(e=(0,i.ZQ)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function oe(e=(0,i.ZQ)()){return/crios\//i.test(e)}function ae(e=(0,i.ZQ)()){return/iemobile/i.test(e)}function ce(e=(0,i.ZQ)()){return/android/i.test(e)}function ue(e=(0,i.ZQ)()){return/blackberry/i.test(e)}function le(e=(0,i.ZQ)()){return/webos/i.test(e)}function he(e=(0,i.ZQ)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function de(e=(0,i.ZQ)()){return he(e)||ce(e)||le(e)||ue(e)||/windows phone/i.test(e)||ae(e)}function fe(e,t=[]){let n;switch(e){case"Browser":n=re((0,i.ZQ)());break;case"Worker":n=`${re((0,i.ZQ)())}-${e}`;break;default:n=e}const s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${r.MF}/${s}`}class pe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class me{constructor(e){var t,n,r,i;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(i=e.forceUpgradeOnSignin)&&void 0!==i&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,i,s,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(i=a.containsUppercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class ge{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ve(this),this.idTokenSubscription=new ve(this),this.beforeStateQueue=new pe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=X(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await ne.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await F(this,{idToken:e}),n=await J._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,r.xZ)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await K(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,r.xZ)(this.app))return Promise.reject(m(this));const t=e?(0,i.Ku)(e):null;return t&&y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(0,r.xZ)(this.app)?Promise.reject(m(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,r.xZ)(this.app)?Promise.reject(m(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(X(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return A(e,"GET","/v2/passwordPolicy",C(e,t))}(this),t=new me(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new i.FA("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return A(e,"POST","/v2/accounts:revokeToken",C(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&X(e)||this._popupRedirectResolver;y(t,this,"argument-error"),this.redirectPersistenceManager=await ne.create(this,[X(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(y(o,this,"internal-error"),o.then((()=>{s||i(this.currentUser)})),"function"==typeof t){const i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{const n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=fe(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;if((0,r.xZ)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){l.logLevel<=s.$b.WARN&&l.warn(`Auth (${r.MF}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function ye(e){return(0,i.Ku)(e)}class ve{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.tD)((e=>this.observer=e))}get next(){return y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let we={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function be(e){return we.loadJS(e)}function Ee(e){return`__${e}${Math.floor(1e6*Math.random())}`}class _e{constructor(){this.enterprise=new Ie}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Ie{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Te="NO_RECAPTCHA";class Se{constructor(e){this.type="recaptcha-enterprise",this.auth=ye(e)}async verify(e="verify",t=!1){function n(t,n,r){const i=window.grecaptcha;P(i)?i.enterprise.ready((()=>{i.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(Te)}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new _e).execute("siteKey",{action:"verify"}):new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{U(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new M(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((i=>{if(!t&&P(window.grecaptcha))n(i,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=we.recaptchaEnterpriseScript;0!==t.length&&(t+=i),be(t).then((()=>{n(i,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function ke(e,t,n,r=!1,i=!1){const s=new Se(e);let o;if(i)o=Te;else try{o=await s.verify(n)}catch(e){o=await s.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Ce(e,t,n,r,i){var s,o;if("EMAIL_PASSWORD_PROVIDER"===i){if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const i=await ke(e,t,n,"getOobCode"===n);return r(e,i)}return r(e,t).catch((async i=>{if("auth/missing-recaptcha-token"===i.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const i=await ke(e,t,n,"getOobCode"===n);return r(e,i)}return Promise.reject(i)}))}if("PHONE_PROVIDER"===i){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const i=await ke(e,t,n);return r(e,i).catch((async i=>{var s;if("AUDIT"===(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const i=await ke(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)}))}{const i=await ke(e,t,n,!1,!0);return r(e,i)}}return Promise.reject(i+" provider is not supported.")}function Ae(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Ne(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class xe{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return v("not implemented")}_getIdTokenResponse(e){return v("not implemented")}_linkToIdToken(e,t){return v("not implemented")}_getReauthenticationResolver(e){return v("not implemented")}}async function Oe(e,t){return A(e,"POST","/v1/accounts:signUp",t)}async function Le(e,t){return x(e,"POST","/v1/accounts:signInWithPassword",C(e,t))}class Re extends xe{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Re(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Re(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Ce(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Le,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return x(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{email:this._email,oobCode:this._password});default:d(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ce(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Oe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return x(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:d(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function De(e,t){return x(e,"POST","/v1/accounts:signInWithIdp",C(e,t))}class Pe extends xe{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Pe(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):d("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=o(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new Pe(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return De(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,De(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,De(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.Am)(t)}return e}}async function Me(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",C(e,t))}const Ue={USER_NOT_FOUND:"user-not-found"};class Fe extends xe{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Fe({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Fe({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return x(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await x(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t));if(n.temporaryProof)throw D(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return x(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Ue)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new Fe({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class Ve{constructor(e){var t,n,r,s,o,a;const c=(0,i.I9)((0,i.hp)(e)),u=null!==(t=c.apiKey)&&void 0!==t?t:null,l=null!==(n=c.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=c.mode)&&void 0!==r?r:null);y(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=null!==(s=c.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=c.languageCode)&&void 0!==o?o:null,this.tenantId=null!==(a=c.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,i.I9)((0,i.hp)(e)).link,n=t?(0,i.I9)((0,i.hp)(t)).deep_link_id:null,r=(0,i.I9)((0,i.hp)(e)).deep_link_id;return(r?(0,i.I9)((0,i.hp)(r)).link:null)||r||n||t||e}(e);try{return new Ve(t)}catch(e){return null}}}class je{constructor(){this.providerId=je.PROVIDER_ID}static credential(e,t){return Re._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Ve.parseLink(t);return y(n,"argument-error"),Re._fromEmailAndCode(e,n.code,n.tenantId)}}je.PROVIDER_ID="password",je.EMAIL_PASSWORD_SIGN_IN_METHOD="password",je.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Be{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ze extends Be{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class qe extends ze{constructor(){super("facebook.com")}static credential(e){return Pe._fromParams({providerId:qe.PROVIDER_ID,signInMethod:qe.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return qe.credentialFromTaggedObject(e)}static credentialFromError(e){return qe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return qe.credential(e.oauthAccessToken)}catch(e){return null}}}qe.FACEBOOK_SIGN_IN_METHOD="facebook.com",qe.PROVIDER_ID="facebook.com";class $e extends ze{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Pe._fromParams({providerId:$e.PROVIDER_ID,signInMethod:$e.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return $e.credentialFromTaggedObject(e)}static credentialFromError(e){return $e.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return $e.credential(t,n)}catch(e){return null}}}$e.GOOGLE_SIGN_IN_METHOD="google.com",$e.PROVIDER_ID="google.com";class Ge extends ze{constructor(){super("github.com")}static credential(e){return Pe._fromParams({providerId:Ge.PROVIDER_ID,signInMethod:Ge.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ge.credentialFromTaggedObject(e)}static credentialFromError(e){return Ge.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ge.credential(e.oauthAccessToken)}catch(e){return null}}}Ge.GITHUB_SIGN_IN_METHOD="github.com",Ge.PROVIDER_ID="github.com";class Ke extends ze{constructor(){super("twitter.com")}static credential(e,t){return Pe._fromParams({providerId:Ke.PROVIDER_ID,signInMethod:Ke.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Ke.credentialFromTaggedObject(e)}static credentialFromError(e){return Ke.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Ke.credential(t,n)}catch(e){return null}}}async function He(e,t){return x(e,"POST","/v1/accounts:signUp",C(e,t))}Ke.TWITTER_SIGN_IN_METHOD="twitter.com",Ke.PROVIDER_ID="twitter.com";class We{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await J._fromIdTokenResponse(e,n,r),s=Qe(n);return new We({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Qe(n);return new We({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Qe(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function Je(e){var t;if((0,r.xZ)(e.app))return Promise.reject(m(e));const n=ye(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new We({user:n.currentUser,providerId:null,operationType:"signIn"});const i=await He(n,{returnSecureToken:!0}),s=await We._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(s.user),s}class Ye extends i.g{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Ye.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Ye(e,t,n,r)}}function Xe(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Ye._fromErrorAndOperation(e,n,t,r);throw n}))}async function Ze(e,t,n=!1){if((0,r.xZ)(e.app))return Promise.reject(m(e));const i="signIn",s=await Xe(e,i,t),o=await We._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(o.user),o}async function et(e){const t=ye(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function tt(e,t,n){if((0,r.xZ)(e.app))return Promise.reject(m(e));const i=ye(e),s=Ce(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",He,"EMAIL_PASSWORD_PROVIDER"),o=await s.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&et(e),t})),a=await We._fromIdTokenResponse(i,"signIn",o);return await i._updateCurrentUser(a.user),a}function nt(e,t,n){return(0,r.xZ)(e.app)?Promise.reject(m(e)):async function(e,t){return Ze(ye(e),t)}((0,i.Ku)(e),je.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&et(e),t}))}async function rt(e,t){const n=(0,i.Ku)(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&function(e,t,n){var r;y((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),y(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),y(void 0===n.linkDomain||n.linkDomain.length>0,e,"invalid-hosting-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.linkDomain=n.linkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(y(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(y(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}(n.auth,r,t);const{email:s}=await async function(e,t){return async function(e,t){return A(e,"POST","/v1/accounts:sendOobCode",C(e,t))}(e,t)}(n.auth,r);s!==e.email&&await e.reload()}function it(e,t){return A(e,"POST","/v2/accounts/mfaEnrollment:start",C(e,t))}new WeakMap;const st="__sak";class ot{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(st,"1"),this.storage.removeItem(st),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class at extends ot{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=de(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,i.lT)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}at.type="LOCAL";const ct=at;class ut extends ot{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}ut.type="SESSION";const lt=ut;class ht{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new ht(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function dt(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ht.receivers=[];class ft{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=dt("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function pt(){return window}function mt(){return void 0!==pt().WorkerGlobalScope&&"function"==typeof pt().importScripts}const gt="firebaseLocalStorageDb",yt="firebaseLocalStorage",vt="fbase_key";class wt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function bt(e,t){return e.transaction([yt],t?"readwrite":"readonly").objectStore(yt)}function Et(){const e=indexedDB.open(gt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(yt,{keyPath:vt})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(yt)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(gt);return new wt(e).toPromise()}(),t(await Et()))}))}))}async function _t(e,t,n){const r=bt(e,!0).put({[vt]:t,value:n});return new wt(r).toPromise()}function It(e,t){const n=bt(e,!0).delete(t);return new wt(n).toPromise()}class Tt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Et()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return mt()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ht._getInstance(mt()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new ft(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Et();return await _t(e,st,"1"),await It(e,st),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>_t(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=bt(e,!1).get(t),r=await new wt(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>It(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=bt(e,!1).getAll();return new wt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Tt.type="LOCAL";const St=Tt;function kt(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:start",C(e,t))}Ee("rcb"),new _(3e4,6e4);const Ct="recaptcha";async function At(e,t,n){var r;if(!e._getRecaptchaConfig())try{await async function(e){const t=ye(e),n=await U(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new M(n);null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new Se(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){y("enroll"===t.type,e,"internal-error");const r=Ce(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",(async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===Te?(y((null==n?void 0:n.type)===Ct,e,"argument-error"),it(e,await Nt(e,t,n))):it(e,t)),"PHONE_PROVIDER");return(await r.catch((e=>Promise.reject(e)))).phoneSessionInfo.sessionInfo}{y("signin"===t.type,e,"internal-error");const s=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;y(s,e,"missing-multi-factor-info");const o=Ce(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",(async(e,t)=>t.phoneSignInInfo.captchaResponse===Te?(y((null==n?void 0:n.type)===Ct,e,"argument-error"),kt(e,await Nt(e,t,n))):kt(e,t)),"PHONE_PROVIDER");return(await o.catch((e=>Promise.reject(e)))).phoneResponseInfo.sessionInfo}}{const t=Ce(e,{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",(async(e,t)=>t.captchaResponse===Te?(y((null==n?void 0:n.type)===Ct,e,"argument-error"),Me(e,await Nt(e,t,n))):Me(e,t)),"PHONE_PROVIDER");return(await t.catch((e=>Promise.reject(e)))).sessionInfo}}finally{null==n||n._reset()}}async function Nt(e,t,n){y(n.type===Ct,e,"argument-error");const r=await n.verify();y("string"==typeof r,e,"argument-error");const i=Object.assign({},t);if("phoneEnrollmentInfo"in i){const e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if("phoneSignInInfo"in i){const e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}return Object.assign(i,{recaptchaToken:r}),i}class xt{constructor(e){this.providerId=xt.PROVIDER_ID,this.auth=ye(e)}verifyPhoneNumber(e,t){return At(this.auth,e,(0,i.Ku)(t))}static credential(e,t){return Fe._fromVerification(e,t)}static credentialFromResult(e){const t=e;return xt.credentialFromTaggedObject(t)}static credentialFromError(e){return xt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Fe._fromTokenResponse(t,n):null}}xt.PROVIDER_ID="phone",xt.PHONE_SIGN_IN_METHOD="phone";class Ot extends xe{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return De(e,this._buildIdpRequest())}_linkToIdToken(e,t){return De(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return De(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Lt(e){return Ze(e.auth,new Ot(e),e.bypassAuthState)}function Rt(e){const{auth:t,user:n}=e;return y(n,t,"internal-error"),async function(e,t,n=!1){const{auth:i}=e;if((0,r.xZ)(i.app))return Promise.reject(m(i));const s="reauthenticate";try{const r=await q(e,Xe(i,s,t,e),n);y(r.idToken,i,"internal-error");const o=B(r.idToken);y(o,i,"internal-error");const{sub:a}=o;return y(e.uid===a,i,"user-mismatch"),We._forOperation(e,s,r)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&d(i,"user-mismatch"),e}}(n,new Ot(e),e.bypassAuthState)}async function Dt(e){const{auth:t,user:n}=e;return y(n,t,"internal-error"),async function(e,t,n=!1){const r=await q(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return We._forOperation(e,"link",r)}(n,new Ot(e),e.bypassAuthState)}class Pt{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Lt;case"linkViaPopup":case"linkViaRedirect":return Dt;case"reauthViaPopup":case"reauthViaRedirect":return Rt;default:d(this.auth,"internal-error")}}resolve(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Mt=new _(2e3,1e4);class Ut extends Pt{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,Ut.currentPopupAction&&Ut.currentPopupAction.cancel(),Ut.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return y(e,this.auth,"internal-error"),e}async onExecution(){w(1===this.filter.length,"Popup operations only handle one event");const e=dt();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(f(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ut.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Mt.get())};e()}}Ut.currentPopupAction=null;const Ft=new Map;class Vt extends Pt{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Ft.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return te("pendingRedirect",e.config.apiKey,e.name)}(t),r=function(e){return X(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Ft.set(this.auth._key(),e)}return this.bypassAuthState||Ft.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function jt(e,t){Ft.set(e._key(),t)}async function Bt(e,t,n=!1){if((0,r.xZ)(e.app))return Promise.reject(m(e));const i=ye(e),s=function(e,t){return t?X(t):(y(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(i,t),o=new Vt(i,s,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class zt{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $t(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!$t(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(f(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(qt(e))}saveEventToCache(e){this.cachedEventUids.add(qt(e)),this.lastProcessedEventTime=Date.now()}}function qt(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function $t({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Gt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Kt=/^https?/;function Ht(e){const t=b(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!Kt.test(n))return!1;if(Gt.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const Wt=new _(3e4,6e4);function Qt(){const e=pt().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Jt(e){return new Promise(((t,n)=>{var r,i,s;function o(){Qt(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Qt(),n(f(e,"network-request-failed"))},timeout:Wt.get()})}if(null===(i=null===(r=pt().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=pt().gapi)||void 0===s?void 0:s.load)){const t=Ee("iframefcb");return pt()[t]=()=>{gapi.load?o():n(f(e,"network-request-failed"))},be(`${we.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Yt=null,e}))}let Yt=null;const Xt=new _(5e3,15e3),Zt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},en=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function tn(e){const t=e.config;y(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?I(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:r.MF},o=en.get(e.config.apiHost);o&&(s.eid=o);const a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${(0,i.Am)(s).slice(1)}`}const nn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class rn{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const sn=encodeURIComponent("fac");async function on(e,t,n,s,o,a){y(e.config.authDomain,e,"auth-domain-config-required"),y(e.config.apiKey,e,"invalid-api-key");const c={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:r.MF,eventId:o};if(t instanceof Be){t.setDefaultLanguage(e.languageCode),c.providerId=t.providerId||"",(0,i.Im)(t.getCustomParameters())||(c.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))c[e]=t}if(t instanceof ze){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(c.scopes=e.join(","))}e.tenantId&&(c.tid=e.tenantId);const u=c;for(const e of Object.keys(u))void 0===u[e]&&delete u[e];const l=await e._getAppCheckToken(),h=l?`#${sn}=${encodeURIComponent(l)}`:"";return`${function({config:e}){return e.emulator?I(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,i.Am)(u).slice(1)}${h}`}const an="webStorageSupport",cn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=lt,this._completeRedirectFn=Bt,this._overrideRedirectResult=jt}async _openPopup(e,t,n,r){var s;return w(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,s=600){const o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},nn),{width:r.toString(),height:s.toString(),top:o,left:a}),l=(0,i.ZQ)().toLowerCase();n&&(c=oe(l)?"_blank":n),ie(l)&&(t=t||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,i.ZQ)()){var t;return he(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==c)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",c),new rn(null);const d=window.open(t||"",c,h);y(d,e,"popup-blocked");try{d.focus()}catch(e){}return new rn(d)}(e,await on(e,t,n,b(),r),dt())}async _openRedirect(e,t,n,r){return await this._originValidation(e),i=await on(e,t,n,b(),r),pt().location.href=i,new Promise((()=>{}));var i}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(w(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Yt=Yt||Jt(e),Yt}(e),n=pt().gapi;return y(n,e,"internal-error"),t.open({where:document.body,url:tn(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Zt,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=f(e,"network-request-failed"),s=pt().setTimeout((()=>{r(i)}),Xt.get());function o(){pt().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new zt(e);return t.register("authEvent",(t=>(y(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(an,{type:an},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[an];void 0!==i&&t(!!i),d(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return A(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Ht(e))return}catch(e){}d(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return de()||se()||he()}};var un="@firebase/auth",ln="1.9.1";class hn{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const dn=(0,i.XA)("authIdTokenMaxAge")||300;let fn=null;const pn=e=>async t=>{const n=t&&await t.getIdTokenResult(),r=n&&((new Date).getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>dn)return;const i=null==n?void 0:n.token;fn!==i&&(fn=i,await fetch(e,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function mn(e=(0,r.Sx)()){const t=(0,r.j6)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,r.j6)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),r=n.getOptions();if((0,i.bD)(r,null!=t?t:{}))return e;d(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:cn,persistence:[St,ct,lt]}),s=(0,i.XA)("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(s,location.origin);if(location.origin===e.origin){const t=pn(e.toString());!function(e,t,n){(0,i.Ku)(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e){(0,i.Ku)(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}const o=(0,i.Tj)("auth");return o&&function(e,t,n){const r=ye(e);y(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const s=!!(null==n?void 0:n.disableWarnings),o=Ae(t),{host:a,port:c}=function(e){const t=Ae(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:Ne(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Ne(t)}}}(t),u={url:`${o}//${a}${null===c?"":`:${c}`}/`},l=Object.freeze({host:a,port:c,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator)return y(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void y((0,i.bD)(u,r.config.emulator)&&(0,i.bD)(l,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=u,r.emulatorConfig=l,r.settings.appVerificationDisabledForTesting=!0,s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${o}`),n}var gn;we={loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var i,s;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=f("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},gn="Browser",(0,r.om)(new a.uA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;y(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:gn,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:fe(gn)},c=new ge(n,r,i,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(X);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,r.om)(new a.uA("auth-internal",(e=>{return t=ye(e.getProvider("auth").getImmediate()),new hn(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,r.KO)(un,ln,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(gn)),(0,r.KO)(un,ln,"esm2017")},125:(e,t,n)=>{n.d(t,{h1:()=>a,uA:()=>i});var r=n(126);class i{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new r.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===s?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},126:(e,t,n)=>{n.d(t,{cY:()=>f,FA:()=>k,g:()=>S,dM:()=>T,u:()=>a,Uj:()=>o,p9:()=>B,Fy:()=>p,tD:()=>D,bD:()=>N,hp:()=>R,T9:()=>h,Tj:()=>u,yU:()=>l,XA:()=>d,Ku:()=>z,ZQ:()=>m,sr:()=>v,c1:()=>y,Im:()=>A,lT:()=>b,zW:()=>_,jZ:()=>g,lV:()=>w,nr:()=>E,Am:()=>O,I9:()=>L,eX:()=>I});const r=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(r(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==o||null==a||null==c)throw new s;const u=i<<2|o>>4;if(r.push(u),64!==a){const e=o<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=r(e);return i.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return i.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},c=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},u=e=>{var t,n;return null===(n=null===(t=c())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},l=e=>{const t=u(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},h=()=>{var e;return null===(e=c())||void 0===e?void 0:e.config},d=e=>{var t;return null===(t=c())||void 0===t?void 0:t[`_${e}`]};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function p(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function g(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())}function y(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function v(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function w(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function b(){const e=m();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function E(){return!function(){var e;const t=null===(e=c())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _(){try{return"object"==typeof indexedDB}catch(e){return!1}}function I(){return new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}function T(){return!("undefined"==typeof navigator||!navigator.cookieEnabled)}class S extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(C,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new S(r,o,n)}}const C=/\{\$([^}]+)}/g;function A(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function N(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(x(n)&&x(s)){if(!N(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function x(e){return null!==e&&"object"==typeof e}function O(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function L(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function R(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function D(e,t){const n=new P(e,t);return n.subscribe.bind(n)}class P{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=M),void 0===r.error&&(r.error=M),void 0===r.complete&&(r.complete=M);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function M(){}const U=1e3,F=2,V=144e5,j=.5;function B(e,t=U,n=F){const r=t*Math.pow(n,e),i=Math.round(j*r*(Math.random()-.5)*2);return Math.min(V,r+i)}function z(e){return e&&e._delegate?e._delegate:e}},148:(e,t,n)=>{n.d(t,{P2:()=>m});const r=(e,t)=>t.some((t=>e instanceof t));let i,s;const o=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;let h={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(s||(s=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(p(this),e),f(o.get(this))}:function(...e){return f(t.apply(p(this),e))}:function(e,...n){const r=t.call(p(this),e,...n);return c.set(r,e.sort?e.sort():[e]),f(r)}:(e instanceof IDBTransaction&&function(e){if(a.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));a.set(e,t)}(e),r(e,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,h):e);var t}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(f(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&o.set(t,e)})).catch((()=>{})),l.set(t,e),t}(e);if(u.has(e))return u.get(e);const t=d(e);return t!==e&&(u.set(e,t),l.set(t,e)),t}const p=e=>l.get(e);function m(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=f(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(f(o.result),e.oldVersion,e.newVersion,f(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const g=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],v=new Map;function w(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(v.get(t))return v.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=y.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!g.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return v.set(t,s),s}var b;b=h,h={...b,get:(e,t,n)=>w(e,t)||b.get(e,t,n),has:(e,t)=>!!w(e,t)||b.has(e,t)}},223:(e,t,n)=>{n.d(t,{Wp:()=>r.Wp});var r=n(461);(0,r.KO)("firebase","11.4.0","app")},424:(e,t,n)=>{n.d(t,{$b:()=>i,Vy:()=>u});const r=[];var i;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},c=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=a[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class u{constructor(e){this.name=e,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}},461:(e,t,n)=>{n.d(t,{KO:()=>Y,MF:()=>W,Sx:()=>J,Wp:()=>Q,j6:()=>$,om:()=>q,xZ:()=>G});var r=n(125),i=n(424),s=n(126),o=n(148);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const c="@firebase/app",u="0.11.2",l=new i.Vy("@firebase/app"),h="@firebase/app-compat",d="@firebase/analytics-compat",f="@firebase/analytics",p="@firebase/app-check-compat",m="@firebase/app-check",g="@firebase/auth",y="@firebase/auth-compat",v="@firebase/database",w="@firebase/data-connect",b="@firebase/database-compat",E="@firebase/functions",_="@firebase/functions-compat",I="@firebase/installations",T="@firebase/installations-compat",S="@firebase/messaging",k="@firebase/messaging-compat",C="@firebase/performance",A="@firebase/performance-compat",N="@firebase/remote-config",x="@firebase/remote-config-compat",O="@firebase/storage",L="@firebase/storage-compat",R="@firebase/firestore",D="@firebase/vertexai",P="@firebase/firestore-compat",M="firebase",U="[DEFAULT]",F={[c]:"fire-core",[h]:"fire-core-compat",[f]:"fire-analytics",[d]:"fire-analytics-compat",[m]:"fire-app-check",[p]:"fire-app-check-compat",[g]:"fire-auth",[y]:"fire-auth-compat",[v]:"fire-rtdb",[w]:"fire-data-connect",[b]:"fire-rtdb-compat",[E]:"fire-fn",[_]:"fire-fn-compat",[I]:"fire-iid",[T]:"fire-iid-compat",[S]:"fire-fcm",[k]:"fire-fcm-compat",[C]:"fire-perf",[A]:"fire-perf-compat",[N]:"fire-rc",[x]:"fire-rc-compat",[O]:"fire-gcs",[L]:"fire-gcs-compat",[R]:"fire-fst",[P]:"fire-fst-compat",[D]:"fire-vertex","fire-js":"fire-js",[M]:"fire-js-all"},V=new Map,j=new Map,B=new Map;function z(e,t){try{e.container.addComponent(t)}catch(n){l.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function q(e){const t=e.name;if(B.has(t))return l.debug(`There were multiple attempts to register component ${t}.`),!1;B.set(t,e);for(const t of V.values())z(t,e);for(const t of j.values())z(t,e);return!0}function $(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function G(e){return null!=e&&void 0!==e.settings}const K=new s.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class H{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.uA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw K.create("app-deleted",{appName:this._name})}}const W="11.4.0";function Q(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const i=Object.assign({name:U,automaticDataCollectionEnabled:!1},t),o=i.name;if("string"!=typeof o||!o)throw K.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.T9)()),!n)throw K.create("no-options");const a=V.get(o);if(a){if((0,s.bD)(n,a.options)&&(0,s.bD)(i,a.config))return a;throw K.create("duplicate-app",{appName:o})}const c=new r.h1(o);for(const e of B.values())c.addComponent(e);const u=new H(n,i,c);return V.set(o,u),u}function J(e=U){const t=V.get(e);if(!t&&e===U&&(0,s.T9)())return Q();if(!t)throw K.create("no-app",{appName:e});return t}function Y(e,t,n){var i;let s=null!==(i=F[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${s}" with version "${t}":`];return o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void l.warn(e.join(" "))}q(new r.uA(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const X="firebase-heartbeat-store";let Z=null;function ee(){return Z||(Z=(0,o.P2)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(X)}catch(e){console.warn(e)}}}).catch((e=>{throw K.create("idb-open",{originalErrorMessage:e.message})}))),Z}async function te(e,t){try{const n=(await ee()).transaction(X,"readwrite"),r=n.objectStore(X);await r.put(t,ne(e)),await n.done}catch(e){if(e instanceof s.g)l.warn(e.message);else{const t=K.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}function ne(e){return`${e.name}!${e.options.appId}`}class re{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new se(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ie();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){l.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=ie(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),oe(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),oe(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=(0,s.Uj)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return l.warn(e),""}}}function ie(){return(new Date).toISOString().substring(0,10)}class se{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.zW)()&&(0,s.eX)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await ee()).transaction(X),n=await t.objectStore(X).get(ne(e));return await t.done,n}catch(e){if(e instanceof s.g)l.warn(e.message);else{const t=K.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});l.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return te(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return te(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function oe(e){return(0,s.Uj)(JSON.stringify({version:2,heartbeats:e})).length}q(new r.uA("platform-logger",(e=>new a(e)),"PRIVATE")),q(new r.uA("heartbeat",(e=>new re(e)),"PRIVATE")),Y(c,u,""),Y(c,u,"esm2017"),Y("fire-js","")},594:(e,t,n)=>{n.d(t,{hq:()=>cc,rJ:()=>oa,kd:()=>oc,H9:()=>aa,x7:()=>tc,GG:()=>rc,aU:()=>ha,P:()=>za,BN:()=>ic,mZ:()=>sc,_M:()=>$a});var r,i,s=n(461),o=n(125),a=n(424),c=n(126),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},l={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];var s=e.g[3],o=t+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=(n=(i=(s=(t=n+(o<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^t&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^i&(s^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(t^n&(s^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^t&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(t^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(t^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(t=n+((o=t+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(t|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(t^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function s(e,t){this.h=t;for(var n=[],r=!0,i=e.length-1;0<=i;i--){var s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var r=t-this.blockSize,i=this.B,s=this.h,o=0;o<t;){if(0==s)for(;o<=r;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var o={};function a(e){return-128<=e&&128>e?function(e){var t=o;return Object.prototype.hasOwnProperty.call(t,e)?t[e]:t[e]=function(e){return new s([0|e],0>e?-1:0)}(e)}(e):new s([0|e],0>e?-1:0)}function c(e){if(isNaN(e)||!isFinite(e))return u;if(0>e)return m(c(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=4294967296;return new s(t,0)}var u=a(0),h=a(1),d=a(16777216);function f(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return-1==e.h}function m(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new s(n,~e.h).add(h)}function g(e,t){return e.add(m(t))}function y(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function v(e,t){this.g=e,this.h=t}function w(e,t){if(f(t))throw Error("division by zero");if(f(e))return new v(u,u);if(p(e))return t=w(m(e),t),new v(m(t.g),m(t.h));if(p(t))return t=w(e,m(t)),new v(m(t.g),t.h);if(30<e.g.length){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=h,r=t;0>=r.l(e);)n=b(n),r=b(r);var i=E(n,1),s=E(r,1);for(r=E(r,2),n=E(n,2);!f(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=E(r,1),n=E(n,1)}return t=g(e,i.j(t)),new v(i,t)}for(i=u;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=c(n)).j(t);p(o)||0<o.l(e);)o=(s=c(n-=r)).j(t);f(s)&&(s=h),i=i.add(s),e=g(e,o)}return new v(i,e)}function b(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new s(n,e.h)}function E(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,i=[],o=0;o<r;o++)i[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new s(i,e.h)}(e=s.prototype).m=function(){if(p(this))return-m(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.i(n);e+=(0<=r?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(p(this))return"-"+m(this).toString(e);for(var t=c(Math.pow(e,6)),n=this,r="";;){var i=w(n,t).g,s=((0<(n=g(n,i.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(f(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return p(e=g(this,e))?-1:f(e)?0:1},e.abs=function(){return p(this)?m(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,i=0;i<=t;i++){var o=r+(65535&this.i(i))+(65535&e.i(i)),a=(o>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=a>>>16,o&=65535,a&=65535,n[i]=a<<16|o}return new s(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(f(this)||f(e))return u;if(p(this))return p(e)?m(this).j(m(e)):m(m(this).j(e));if(p(e))return m(this.j(m(e)));if(0>this.l(d)&&0>e.l(d))return c(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<e.g.length;i++){var o=this.i(r)>>>16,a=65535&this.i(r),l=e.i(i)>>>16,h=65535&e.i(i);n[2*r+2*i]+=a*h,y(n,2*r+2*i),n[2*r+2*i+1]+=o*h,y(n,2*r+2*i+1),n[2*r+2*i+1]+=a*l,y(n,2*r+2*i+1),n[2*r+2*i+2]+=o*l,y(n,2*r+2*i+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new s(n,0)},e.A=function(e){return w(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new s(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new s(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new s(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,i=l.Md5=t,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.A,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=c,s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return m(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=c(Math.pow(n,8)),i=u,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=c(Math.pow(n,o)),i=i.j(o).add(c(a))):i=(i=i.j(r)).add(c(a))}return i},r=l.Integer=s}).apply(void 0!==u?u:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var h,d,f,p,m,g,y,v,w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},b={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof w&&w];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,r){if(r)e:{var i=n;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(r=r(s=i[e=e[e.length-1]]))!=s&&null!=r&&t(i,e,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(0,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return t}))}}));var r=r||{},i=this||self;function s(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function u(e,t,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function l(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function E(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function _(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function I(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(s(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let i=0;i<r;i++)e[t+i]=n[i]}else e.push(n)}}function T(e){return/^[\s\xa0]*$/.test(e)}function S(){var e=i.navigator;return e&&(e=e.userAgent)?e:""}function k(e){return k[" "](e),e}k[" "]=function(){};var C=!(-1==S().indexOf("Gecko")||-1!=S().toLowerCase().indexOf("webkit")&&-1==S().indexOf("Edge")||-1!=S().indexOf("Trident")||-1!=S().indexOf("MSIE")||-1!=S().indexOf("Edge"));function A(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function N(e){const t={};for(const n in e)t[n]=e[n];return t}const x="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<x.length;t++)n=x[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function L(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function R(e){i.setTimeout((()=>{throw e}),0)}function D(){var e=V;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var P=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new M),(e=>e.reset()));class M{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let U,F=!1,V=new class{constructor(){this.h=this.g=null}add(e,t){const n=P.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},j=()=>{const e=i.Promise.resolve(void 0);U=()=>{e.then(B)}};var B=()=>{for(var e;e=D();){try{e.h.call(e.g)}catch(e){R(e)}var t=P;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}F=!1};function z(){this.s=this.s,this.C=this.C}function q(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}z.prototype.s=!1,z.prototype.ma=function(){this.s||(this.s=!0,this.N())},z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},q.prototype.h=function(){this.defaultPrevented=!0};var $=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(e){}return e}();function G(e,t){if(q.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(C){e:{try{k(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:K[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&G.aa.h.call(this)}}E(G,q);var K={2:"touch",3:"pen",4:"mouse"};G.prototype.h=function(){G.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var H="closure_listenable_"+(1e6*Math.random()|0),W=0;function Q(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++W,this.da=this.fa=!1}function J(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Y(e){this.src=e,this.g={},this.h=0}function X(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(J(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Z(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.da&&s.listener==t&&s.capture==!!n&&s.ha==r)return i}return-1}Y.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=Z(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Q(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var ee="closure_lm_"+(1e6*Math.random()|0),te={};function ne(e,t,n,r,i){if(r&&r.once)return ie(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)ne(e,t[s],n,r,i);return null}return n=he(n),e&&e[H]?e.K(t,n,o(r)?!!r.capture:!!r,i):re(e,t,n,!1,r,i)}function re(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=ue(e);if(c||(e[ee]=c=new Y(e)),(n=c.add(t,n,r,a,s)).proxy)return n;if(r=function(){const e=ce;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)$||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(ae(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function ie(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)ie(e,t[s],n,r,i);return null}return n=he(n),e&&e[H]?e.L(t,n,o(r)?!!r.capture:!!r,i):re(e,t,n,!0,r,i)}function se(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)se(e,t[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=he(n),e&&e[H]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Z(s=e.g[t],n,r,i))&&(J(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=ue(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Z(t,n,r,i)),(n=-1<e?t[e]:null)&&oe(n))}function oe(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[H])X(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(ae(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=ue(t))?(X(n,e),0==n.h&&(n.src=null,t[ee]=null)):J(e)}}}function ae(e){return e in te?te[e]:te[e]="on"+e}function ce(e,t){if(e.da)e=!0;else{t=new G(t,this);var n=e.listener,r=e.ha||e.src;e.fa&&oe(e),e=n.call(r,t)}return e}function ue(e){return(e=e[ee])instanceof Y?e:null}var le="__closure_events_fn_"+(1e9*Math.random()>>>0);function he(e){return"function"==typeof e?e:(e[le]||(e[le]=function(t){return e.handleEvent(t)}),e[le])}function de(){z.call(this),this.i=new Y(this),this.M=this,this.F=null}function fe(e,t){var n,r=e.F;if(r)for(n=[];r;r=r.F)n.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new q(t,e);else if(t instanceof q)t.target=t.target||e;else{var i=t;O(t=new q(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=pe(o,r,!0,t)&&i}if(i=pe(o=t.g=e,r,!0,t)&&i,i=pe(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=pe(o=t.g=n[s],r,!1,t)&&i}function pe(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&X(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function me(e,t,n){if("function"==typeof e)n&&(e=u(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=u(e.handleEvent,e)}return 2147483647<Number(t)?-1:i.setTimeout(e,t||0)}function ge(e){e.g=me((()=>{e.g=null,e.i&&(e.i=!1,ge(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}E(de,z),de.prototype[H]=!0,de.prototype.removeEventListener=function(e,t,n,r){se(this,e,t,n,r)},de.prototype.N=function(){if(de.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)J(n[r]);delete t.g[e],t.h--}}this.F=null},de.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},de.prototype.L=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ye extends z{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ge(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ve(e){z.call(this),this.h=e,this.g={}}E(ve,z);var we=[];function be(e){A(e.g,(function(e,t){this.g.hasOwnProperty(t)&&oe(e)}),e),e.g={}}ve.prototype.N=function(){ve.aa.N.call(this),be(this)},ve.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ee=i.JSON.stringify,_e=i.JSON.parse,Ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function Te(){}function Se(e){return e.h||(e.h=e.i())}function ke(){}Te.prototype.h=null;var Ce={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ae(){q.call(this,"d")}function Ne(){q.call(this,"c")}E(Ae,q),E(Ne,q);var xe={},Oe=null;function Le(){return Oe=Oe||new de}function Re(e){q.call(this,xe.La,e)}function De(e){const t=Le();fe(t,new Re(t))}function Pe(e,t){q.call(this,xe.STAT_EVENT,e),this.stat=t}function Me(e){const t=Le();fe(t,new Pe(t,e))}function Ue(e,t){q.call(this,xe.Ma,e),this.size=t}function Fe(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){e()}),t)}function Ve(){this.g=!0}function je(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ee(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}xe.La="serverreachability",E(Re,q),xe.STAT_EVENT="statevent",E(Pe,q),xe.Ma="timingevent",E(Ue,q),Ve.prototype.xa=function(){this.g=!1},Ve.prototype.info=function(){};var Be,ze={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},qe={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function $e(){}function Ge(e,t,n,r){this.j=e,this.i=t,this.l=n,this.R=r||1,this.U=new ve(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ke}function Ke(){this.i=null,this.g="",this.h=!1}E($e,Te),$e.prototype.g=function(){return new XMLHttpRequest},$e.prototype.i=function(){return{}},Be=new $e;var He={},We={};function Qe(e,t,n){e.L=1,e.v=Et(gt(t)),e.m=n,e.P=!0,Je(e,null)}function Je(e,t){e.F=Date.now(),Ze(e),e.A=gt(e.v);var n=e.A,r=e.R;Array.isArray(r)||(r=[String(r)]),Pt(n.i,"t",r),e.C=0,n=e.j.J,e.h=new Ke,e.g=In(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ye(u(e.Y,e,e.g),e.O)),t=e.U,n=e.g,r=e.ca;var i="readystatechange";Array.isArray(i)||(i&&(we[0]=i.toString()),i=we);for(var s=0;s<i.length;s++){var o=ne(n,i[s],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?N(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),De(),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Ye(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Xe(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?We:(n=Number(t.substring(n,r)),isNaN(n)?He:(r+=1)+n>t.length?We:(t=t.slice(r,r+n),e.C=r+n,t))}function Ze(e){e.S=Date.now()+e.I,et(e,e.I)}function et(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Fe(u(e.ba,e),t)}function tt(e){e.B&&(i.clearTimeout(e.B),e.B=null)}function nt(e){0==e.j.G||e.J||vn(e.j,e)}function rt(e){tt(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,be(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function it(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||ut(n.h,e)))if(!e.K&&ut(n.h,e)&&3==n.G){try{var r=n.Da.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;yn(n),an(n)}pn(n),Me(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Fe(u(n.Za,n),6e3));if(1>=ct(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else bn(n,11)}else if((e.K||n.g==e)&&yn(n),!T(t))for(i=n.Da.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const t=u[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(lt(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.ya=e,bt(r.I,r.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((r=n).qa=_n(r,r.J?r.ia:null,r.W),o.K){ht(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(tt(a),Ze(a)),r.g=o}else fn(r);0<n.i.length&&un(n)}else"stop"!=u[0]&&"close"!=u[0]||bn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?bn(n,7):on(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}De()}catch(e){}}Ge.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==tn(e)?t.j():this.Y(e)},Ge.prototype.Y=function(e){try{if(e==this.g)e:{const d=tn(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==t||De(),tt(this);var n=this.g.Z();this.X=n;t:if(Ye(this)){var r=nn(this.g);e="";var s=r.length,o=4==tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){rt(this),nt(this);var a="";break t}this.h.i=new i.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:!(o&&t==s-1)});r.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){t:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(c)){var l=c;break t}}l=null}if(!(n=l)){this.o=!1,this.s=3,Me(12),rt(this),nt(this);break e}je(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,it(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=Xe(this,a),e==We){4==d&&(this.s=4,Me(14),n=!1),je(this.i,this.l,null,"[Incomplete Response]");break}if(e==He){this.s=4,Me(15),je(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}je(this.i,this.l,e,null),it(this,e)}if(Ye(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,Me(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var h=this.j;h.g==this&&h.ba&&!h.M&&(h.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),mn(h),h.M=!0,Me(11))}}else je(this.i,this.l,a,"[Invalid Chunked Response]"),rt(this),nt(this)}else je(this.i,this.l,a,null),it(this,a);4==d&&rt(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,Ze(this)))}else(function(e){const t={};e=(e.g&&2<=tn(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(T(e[r]))continue;var n=L(e[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=t[i]||[];t[i]=s,s.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Me(12)):(this.s=0,Me(13)),rt(this),nt(this)}}}catch(e){}},Ge.prototype.cancel=function(){this.J=!0,rt(this)},Ge.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(De(),Me(17)),rt(this),this.s=2,nt(this)):et(this,this.S-e)};var st=class{constructor(e,t){this.g=e,this.map=t}};function ot(e){this.l=e||10,e=i.PerformanceNavigationTiming?0<(e=i.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function at(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ct(e){return e.h?1:e.g?e.g.size:0}function ut(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function lt(e,t){e.g?e.g.add(t):e.h=t}function ht(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function dt(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return _(e.i)}function ft(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(s(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(s(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(s(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length,o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}ot.prototype.cancel=function(){if(this.i=dt(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var pt=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof mt){this.h=e.h,yt(this,e.j),this.o=e.o,this.g=e.g,vt(this,e.s),this.l=e.l;var t=e.i,n=new Ot;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),wt(this,n),this.m=e.m}else e&&(t=String(e).match(pt))?(this.h=!1,yt(this,t[1]||"",!0),this.o=_t(t[2]||""),this.g=_t(t[3]||"",!0),vt(this,t[4]),this.l=_t(t[5]||"",!0),wt(this,t[6]||"",!0),this.m=_t(t[7]||"")):(this.h=!1,this.i=new Ot(null,this.h))}function gt(e){return new mt(e)}function yt(e,t,n){e.j=n?_t(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function vt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function wt(e,t,n){t instanceof Ot?(e.i=t,function(e,t){t&&!e.j&&(Lt(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Rt(this,t),Pt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=It(t,Nt)),e.i=new Ot(t,e.h))}function bt(e,t,n){e.i.set(t,n)}function Et(e){return bt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function _t(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function It(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Tt),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Tt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}mt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(It(t,kt,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(It(t,kt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(It(n,"/"==n.charAt(0)?At:Ct,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",It(n,xt)),e.join("")};var St,kt=/[#\/\?@]/g,Ct=/[#\?:]/g,At=/[#\?]/g,Nt=/[#\?@]/g,xt=/#/g;function Ot(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Lt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Rt(e,t){Lt(e),t=Mt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Dt(e,t){return Lt(e),t=Mt(e,t),e.g.has(t)}function Pt(e,t,n){Rt(e,t),0<n.length&&(e.i=null,e.g.set(Mt(e,t),_(n)),e.h+=n.length)}function Mt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Ut(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function Ft(){this.g=new Ie}function Vt(e,t,n){const r=n||"";try{ft(e,(function(e,n){let i=e;o(e)&&(i=Ee(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function jt(e){this.l=e.Ub||null,this.j=e.eb||!1}function Bt(e,t){de.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function zt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function qt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,$t(e)}function $t(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Gt(e){let t="";return A(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Kt(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Gt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):bt(e,t,n))}function Ht(e){de.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=Ot.prototype).add=function(e,t){Lt(this),this.i=null,e=Mt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Lt(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},e.na=function(){Lt(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const i=e[r];for(let e=0;e<i.length;e++)n.push(t[r])}return n},e.V=function(e){Lt(this);let t=[];if("string"==typeof e)Dt(this,e)&&(t=t.concat(this.g.get(Mt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Lt(this),this.i=null,Dt(this,e=Mt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),e.push(i)}}return this.i=e.join("&")},E(jt,Te),jt.prototype.g=function(){return new Bt(this.l,this.j)},jt.prototype.i=(St={},function(){return St}),E(Bt,de),(e=Bt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,$t(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||i).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,qt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,$t(this)),this.g&&(this.readyState=3,$t(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;zt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?qt(this):$t(this),3==this.readyState&&zt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,qt(this))},e.Qa=function(e){this.g&&(this.response=e,qt(this))},e.ga=function(){this.g&&qt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Bt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),E(Ht,de);var Wt=/^https?$/i,Qt=["POST","PUT"];function Jt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Yt(e),Zt(e)}function Yt(e){e.A||(e.A=!0,fe(e,"complete"),fe(e,"error"))}function Xt(e){if(e.h&&void 0!==r&&(!e.v[1]||4!=tn(e)||2!=e.Z()))if(e.u&&4==tn(e))me(e.Ea,0,e);else if(fe(e,"readystatechange"),4==tn(e)){e.h=!1;try{const r=e.Z();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var s;if(s=0===r){var o=String(e.D).match(pt)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Wt.test(o?o.toLowerCase():"")}n=s}if(n)fe(e,"complete"),fe(e,"success");else{e.m=6;try{var a=2<tn(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Yt(e)}}finally{Zt(e)}}}function Zt(e,t){if(e.g){en(e);const n=e.g,r=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||fe(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function en(e){e.I&&(i.clearTimeout(e.I),e.I=null)}function tn(e){return e.g?e.g.readyState:0}function nn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function rn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function sn(e){this.Aa=0,this.i=[],this.j=new Ve,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,e),this.cb=rn("retryDelaySeedMs",1e4,e),this.Wa=rn("forwardChannelMaxRetries",2,e),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new ot(e&&e.concurrentRequestLimit),this.Da=new Ft,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(e){if(cn(e),3==e.G){var t=e.U++,n=gt(e.I);if(bt(n,"SID",e.K),bt(n,"RID",t),bt(n,"TYPE","terminate"),hn(e,n),(t=new Ge(e,e.j,t)).L=2,t.v=Et(gt(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&i.Image&&((new Image).src=t.v,n=!0),n||(t.g=In(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Ze(t)}En(e)}function an(e){e.g&&(mn(e),e.g.cancel(),e.g=null)}function cn(e){an(e),e.u&&(i.clearTimeout(e.u),e.u=null),yn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&i.clearTimeout(e.s),e.s=null)}function un(e){if(!at(e.h)&&!e.s){e.s=!0;var t=e.Ga;U||j(),F||(U(),F=!0),V.add(t,e),e.B=0}}function ln(e,t){var n;n=t?t.l:e.U++;const r=gt(e.I);bt(r,"SID",e.K),bt(r,"RID",n),bt(r,"AID",e.T),hn(e,r),e.m&&e.o&&Kt(r,e.m,e.o),n=new Ge(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=dn(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),lt(e.h,n),Qe(n,r,t)}function hn(e,t){e.H&&A(e.H,(function(e,n){bt(t,n,e)})),e.l&&ft({},(function(e,n){bt(t,n,e)}))}function dn(e,t,n){n=Math.min(e.i.length,n);var r=e.l?u(e.l.Na,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=t,0>n)t=Math.max(0,i[o].g-100),s=!1;else try{Vt(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,r}function fn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;U||j(),F||(U(),F=!0),V.add(t,e),e.v=0}}function pn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Fe(u(e.Fa,e),wn(e,e.v)),e.v++,0))}function mn(e){null!=e.A&&(i.clearTimeout(e.A),e.A=null)}function gn(e){e.g=new Ge(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=gt(e.qa);bt(t,"RID","rpc"),bt(t,"SID",e.K),bt(t,"AID",e.T),bt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&bt(t,"TO",e.ja),bt(t,"TYPE","xmlhttp"),hn(e,t),e.m&&e.o&&Kt(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=Et(gt(t)),n.m=null,n.P=!0,Je(n,e)}function yn(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function vn(e,t){var n=null;if(e.g==t){yn(e),mn(e),e.g=null;var r=2}else{if(!ut(e.h,t))return;n=t.D,ht(e.h,t),r=1}if(0!=e.G)if(t.o)if(1==r){n=t.m?t.m.length:0,t=Date.now()-t.F;var i=e.B;fe(r=Le(),new Ue(r,n)),un(e)}else fn(e);else if(3==(i=t.s)||0==i&&0<t.X||!(1==r&&function(e,t){return!(ct(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Fe(u(e.Ga,e,t),wn(e,e.B)),e.B++,0)))}(e,t)||2==r&&pn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),i){case 1:bn(e,5);break;case 4:bn(e,10);break;case 3:bn(e,6);break;default:bn(e,2)}}function wn(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function bn(e,t){if(e.j.info("Error code "+t),2==t){var n=u(e.fb,e),r=e.Xa;const t=!r;r=new mt(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||yt(r,"https"),Et(r),t?function(e,t){const n=new Ve;if(i.Image){const r=new Image;r.onload=l(Ut,n,"TestLoadImage: loaded",!0,t,r),r.onerror=l(Ut,n,"TestLoadImage: error",!1,t,r),r.onabort=l(Ut,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=l(Ut,n,"TestLoadImage: timeout",!1,t,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(r.toString(),n):function(e,t){new Ve;const n=new AbortController,r=setTimeout((()=>{n.abort(),Ut(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(r),e.ok?Ut(0,0,!0,t):Ut(0,0,!1,t)})).catch((()=>{clearTimeout(r),Ut(0,0,!1,t)}))}(r.toString(),n)}else Me(2);e.G=0,e.l&&e.l.sa(t),En(e),cn(e)}function En(e){if(e.G=0,e.ka=[],e.l){const t=dt(e.h);0==t.length&&0==e.i.length||(I(e.ka,t),I(e.ka,e.i),e.h.i.length=0,_(e.i),e.i.length=0),e.l.ra()}}function _n(e,t,n){var r=n instanceof mt?gt(n):new mt(n);if(""!=r.g)t&&(r.g=t+"."+r.g),vt(r,r.s);else{var s=i.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var o=new mt(null);r&&yt(o,r),t&&(o.g=t),s&&vt(o,s),n&&(o.l=n),r=o}return n=e.D,t=e.ya,n&&t&&bt(r,n,t),bt(r,"VER",e.la),hn(e,r),r}function In(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Ht(new jt({eb:n})):new Ht(e.pa)).Ha(e.J),t}function Tn(){}function Sn(){}function kn(e,t){de.call(this),this.g=new sn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!T(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!T(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Nn(this)}function Cn(e){Ae.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function An(){Ne.call(this),this.status=1}function Nn(e){this.g=e}(e=Ht.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Be.g(),this.v=this.o?Se(this.o):Se(Be),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Jt(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=i.FormData&&e instanceof i.FormData,!(0<=Array.prototype.indexOf.call(Qt,t,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{en(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Jt(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,fe(this,"complete"),fe(this,"abort"),Zt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Zt(this,!0)),Ht.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Xt(this):this.bb())},e.bb=function(){Xt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<tn(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),_e(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=sn.prototype).la=8,e.G=1,e.connect=function(e,t,n,r){Me(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=_n(this,null,this.W),un(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const i=new Ge(this,this.j,e);let s=this.o;if(this.S&&(s?(s=N(s),O(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=dn(this,i,t),bt(n=gt(this.I),"RID",e),bt(n,"CVER",22),this.D&&bt(n,"X-HTTP-Session-Id",this.D),hn(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(Gt(s)))+"&"+t:this.m&&Kt(n,this.m,s)),lt(this.h,i),this.Ua&&bt(n,"TYPE","init"),this.P?(bt(n,"$req",t),bt(n,"SID","null"),i.T=!0,Qe(i,n,null)):Qe(i,n,t),this.G=2}}else 3==this.G&&(e?ln(this,e):0==this.i.length||at(this.h)||ln(this))},e.Fa=function(){if(this.u=null,gn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Fe(u(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Me(10),an(this),gn(this))},e.Za=function(){null!=this.C&&(this.C=null,an(this),pn(this),Me(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Me(2)):(this.j.info("Failed to ping google.com"),Me(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=Tn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},Sn.prototype.g=function(e,t){return new kn(e,t)},E(kn,de),kn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},kn.prototype.close=function(){on(this.g)},kn.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=Ee(e),e=n);t.i.push(new st(t.Ya++,e)),3==t.G&&un(t)},kn.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,kn.aa.N.call(this)},E(Cn,Ae),E(An,Ne),E(Nn,Tn),Nn.prototype.ua=function(){fe(this.g,"a")},Nn.prototype.ta=function(e){fe(this.g,new Cn(e))},Nn.prototype.sa=function(e){fe(this.g,new An)},Nn.prototype.ra=function(){fe(this.g,"b")},Sn.prototype.createWebChannel=Sn.prototype.g,kn.prototype.send=kn.prototype.o,kn.prototype.open=kn.prototype.m,kn.prototype.close=kn.prototype.close,v=b.createWebChannelTransport=function(){return new Sn},y=b.getStatEventTarget=function(){return Le()},g=b.Event=xe,m=b.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ze.NO_ERROR=0,ze.TIMEOUT=8,ze.HTTP_ERROR=6,p=b.ErrorCode=ze,qe.COMPLETE="complete",f=b.EventType=qe,ke.EventType=Ce,Ce.OPEN="a",Ce.CLOSE="b",Ce.ERROR="c",Ce.MESSAGE="d",de.prototype.listen=de.prototype.K,d=b.WebChannel=ke,b.FetchXmlHttpFactory=jt,Ht.prototype.listenOnce=Ht.prototype.L,Ht.prototype.getLastError=Ht.prototype.Ka,Ht.prototype.getLastErrorCode=Ht.prototype.Ba,Ht.prototype.getStatus=Ht.prototype.Z,Ht.prototype.getResponseJson=Ht.prototype.Oa,Ht.prototype.getResponseText=Ht.prototype.oa,Ht.prototype.send=Ht.prototype.ea,Ht.prototype.setWithCredentials=Ht.prototype.Ha,h=b.XhrIo=Ht}).apply(void 0!==w?w:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const E="@firebase/firestore",_="4.7.9";class I{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}I.UNAUTHENTICATED=new I(null),I.GOOGLE_CREDENTIALS=new I("google-credentials-uid"),I.FIRST_PARTY=new I("first-party-uid"),I.MOCK_USER=new I("mock-user");let T="11.4.0";const S=new a.Vy("@firebase/firestore");function k(){return S.logLevel}function C(e,...t){if(S.logLevel<=a.$b.DEBUG){const n=t.map(x);S.debug(`Firestore (${T}): ${e}`,...n)}}function A(e,...t){if(S.logLevel<=a.$b.ERROR){const n=t.map(x);S.error(`Firestore (${T}): ${e}`,...n)}}function N(e,...t){if(S.logLevel<=a.$b.WARN){const n=t.map(x);S.warn(`Firestore (${T}): ${e}`,...n)}}function x(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function O(e="Unexpected state"){const t=`FIRESTORE (${T}) INTERNAL ASSERTION FAILED: `+e;throw A(t),new Error(t)}function L(e,t){e||O()}function R(e,t){return e}const D={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class P extends c.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class M{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class U{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class F{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(I.UNAUTHENTICATED)))}shutdown(){}}class V{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class j{constructor(e){this.t=e,this.currentUser=I.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){L(void 0===this.o);let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new M;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new M,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{C("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(C("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new M)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(C("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(L("string"==typeof t.accessToken),new U(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return L(null===e||"string"==typeof e),new I(e)}}class B{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=I.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class z{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new B(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(I.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class q{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ${constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,(0,s.xZ)(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){L(void 0===this.o);const n=e=>{null!=e.error&&C("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,C("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{C("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):C("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.V)return Promise.resolve(new q(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(L("string"==typeof e.token),this.R=e.token,new q(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function G(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class K{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=G(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function H(e,t){return e<t?-1:e>t?1:0}function W(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}const Q=-62135596800,J=1e6;class Y{static now(){return Y.fromMillis(Date.now())}static fromDate(e){return Y.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*J);return new Y(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new P(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new P(D.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Q)throw new P(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new P(D.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/J}_compareTo(e){return this.seconds===e.seconds?H(this.nanoseconds,e.nanoseconds):H(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Q;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class X{static fromTimestamp(e){return new X(e)}static min(){return new X(new Y(0,0))}static max(){return new X(new Y(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Z="__name__";class ee{constructor(e,t,n){void 0===t?t=0:t>e.length&&O(),void 0===n?n=e.length-t:n>e.length-t&&O(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===ee.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ee?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=ee.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return Math.sign(e.length-t.length)}static compareSegments(e,t){const n=ee.isNumericId(e),r=ee.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?ee.extractNumericId(e).compare(ee.extractNumericId(t)):e<t?-1:e>t?1:0}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return r.fromString(e.substring(4,e.length-2))}}class te extends ee{construct(e,t,n){return new te(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new P(D.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new te(t)}static emptyPath(){return new te([])}}const ne=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class re extends ee{construct(e,t,n){return new re(e,t,n)}static isValidIdentifier(e){return ne.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),re.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Z}static keyField(){return new re([Z])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new P(D.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new P(D.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new P(D.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new P(D.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new re(t)}static emptyPath(){return new re([])}}class ie{constructor(e){this.path=e}static fromPath(e){return new ie(te.fromString(e))}static fromName(e){return new ie(te.fromString(e).popFirst(5))}static empty(){return new ie(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===te.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ie(new te(e.slice()))}}function se(e){return new oe(e.readTime,e.key,-1)}class oe{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new oe(X.min(),ie.empty(),-1)}static max(){return new oe(X.max(),ie.empty(),-1)}}function ae(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ie.comparator(e.documentKey,t.documentKey),0!==n?n:H(e.largestBatchId,t.largestBatchId))}const ce="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ue{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function le(e){if(e.code!==D.FAILED_PRECONDITION||e.message!==ce)throw e;C("LocalStore","Unexpectedly lost primary lease")}class he{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&O(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new he(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof he?t:he.resolve(t)}catch(e){return he.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):he.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):he.reject(t)}static resolve(e){return new he(((t,n)=>{t(e)}))}static reject(e){return new he(((t,n)=>{n(e)}))}static waitFor(e){return new he(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=he.resolve(!1);for(const n of e)t=t.next((e=>e?he.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new he(((n,r)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;t(e[c]).next((e=>{s[c]=e,++o,o===i&&n(s)}),(e=>r(e)))}}))}static doWhile(e,t){return new he(((n,r)=>{const i=()=>{!0===e()?t().next((()=>{i()}),r):n()};i()}))}}function de(e){return"IndexedDbTransactionError"===e.name}class fe{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.oe(e),this._e=e=>t.writeSequenceNumber(e))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}fe.ae=-1;const pe=-1;function me(e){return null==e}function ge(e){return 0===e&&1/e==-1/0}function ye(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function ve(e){return e+""}const we="owner",be="mutationQueues",Ee="mutations",_e="documentMutations",Ie="remoteDocumentGlobal",Te="targets",Se="targetDocuments",ke="targetGlobal",Ce="collectionParents",Ae="clientMetadata",Ne="bundles",xe="namedQueries";function Oe(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Le(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Re(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class De{constructor(e,t){this.comparator=e,this.root=t||Me.EMPTY}insert(e,t){return new De(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Me.BLACK,null,null))}remove(e){return new De(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Me.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Pe(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Pe(this.root,e,this.comparator,!1)}getReverseIterator(){return new Pe(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Pe(this.root,e,this.comparator,!0)}}class Pe{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Me{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Me.RED,this.left=null!=r?r:Me.EMPTY,this.right=null!=i?i:Me.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new Me(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Me.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Me.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Me.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Me.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw O();if(this.right.isRed())throw O();const e=this.left.check();if(e!==this.right.check())throw O();return e+(this.isRed()?0:1)}}Me.EMPTY=null,Me.RED=!0,Me.BLACK=!1,Me.EMPTY=new class{constructor(){this.size=0}get key(){throw O()}get value(){throw O()}get color(){throw O()}get left(){throw O()}get right(){throw O()}copy(e,t,n,r,i){return this}insert(e,t,n){return new Me(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ue{constructor(e){this.comparator=e,this.data=new De(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Fe(this.data.getIterator())}getIteratorFrom(e){return new Fe(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Ue))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Ue(this.comparator);return t.data=e,t}}class Fe{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Ve{constructor(e){this.fields=e,e.sort(re.comparator)}static empty(){return new Ve([])}unionWith(e){let t=new Ue(re.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Ve(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return W(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class je extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Be{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new je("Invalid base64 string: "+e):e}}(e);return new Be(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Be(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return H(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Be.EMPTY_BYTE_STRING=new Be("");const ze=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qe(e){if(L(!!e),"string"==typeof e){let t=0;const n=ze.exec(e);if(L(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:$e(e.seconds),nanos:$e(e.nanos)}}function $e(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Ge(e){return"string"==typeof e?Be.fromBase64String(e):Be.fromUint8Array(e)}const Ke="server_timestamp",He="__type__",We="__previous_value__",Qe="__local_write_time__";function Je(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[He])||void 0===n?void 0:n.stringValue)===Ke}function Ye(e){const t=e.mapValue.fields[We];return Je(t)?Ye(t):t}function Xe(e){const t=qe(e.mapValue.fields[Qe].timestampValue);return new Y(t.seconds,t.nanos)}class Ze{constructor(e,t,n,r,i,s,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}const et="(default)";class tt{constructor(e,t){this.projectId=e,this.database=t||et}static empty(){return new tt("","")}get isDefaultDatabase(){return this.database===et}isEqual(e){return e instanceof tt&&e.projectId===this.projectId&&e.database===this.database}}const nt="__type__",rt="__max__",it={fields:{__type__:{stringValue:rt}}},st="__vector__",ot="value";function at(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Je(e)?4:Tt(e)?9007199254740991:_t(e)?10:11:O()}function ct(e,t){if(e===t)return!0;const n=at(e);if(n!==at(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Xe(e).isEqual(Xe(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=qe(e.timestampValue),r=qe(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Ge(e.bytesValue).isEqual(Ge(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return $e(e.geoPointValue.latitude)===$e(t.geoPointValue.latitude)&&$e(e.geoPointValue.longitude)===$e(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return $e(e.integerValue)===$e(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=$e(e.doubleValue),r=$e(t.doubleValue);return n===r?ge(n)===ge(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return W(e.arrayValue.values||[],t.arrayValue.values||[],ct);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Oe(n)!==Oe(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!ct(n[e],r[e])))return!1;return!0}(e,t);default:return O()}}function ut(e,t){return void 0!==(e.values||[]).find((e=>ct(e,t)))}function lt(e,t){if(e===t)return 0;const n=at(e),r=at(t);if(n!==r)return H(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return H(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=$e(e.integerValue||e.doubleValue),r=$e(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return ht(e.timestampValue,t.timestampValue);case 4:return ht(Xe(e),Xe(t));case 5:return H(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Ge(e),r=Ge(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=H(n[e],r[e]);if(0!==t)return t}return H(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=H($e(e.latitude),$e(t.latitude));return 0!==n?n:H($e(e.longitude),$e(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return dt(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,r,i,s;const o=e.fields||{},a=t.fields||{},c=null===(n=o[ot])||void 0===n?void 0:n.arrayValue,u=null===(r=a[ot])||void 0===r?void 0:r.arrayValue,l=H((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==l?l:dt(c,u)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===it&&t===it)return 0;if(e===it)return 1;if(t===it)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=H(r[e],s[e]);if(0!==t)return t;const o=lt(n[r[e]],i[s[e]]);if(0!==o)return o}return H(r.length,s.length)}(e.mapValue,t.mapValue);default:throw O()}}function ht(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return H(e,t);const n=qe(e),r=qe(t),i=H(n.seconds,r.seconds);return 0!==i?i:H(n.nanos,r.nanos)}function dt(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=lt(n[e],r[e]);if(t)return t}return H(n.length,r.length)}function ft(e){return pt(e)}function pt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=qe(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return Ge(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return ie.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=pt(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${pt(e.fields[i])}`;return n+"}"}(e.mapValue):O()}function mt(e){switch(at(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Ye(e);return t?16+mt(t):16;case 5:return 2*e.stringValue.length;case 6:return Ge(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+mt(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Le(e.fields,((e,n)=>{t+=e.length+mt(n)})),t}(e.mapValue);default:throw O()}}function gt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function yt(e){return!!e&&"integerValue"in e}function vt(e){return!!e&&"arrayValue"in e}function wt(e){return!!e&&"nullValue"in e}function bt(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Et(e){return!!e&&"mapValue"in e}function _t(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[nt])||void 0===n?void 0:n.stringValue)===st}function It(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Le(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=It(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=It(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Tt(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rt}class St{constructor(e){this.value=e}static empty(){return new St({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Et(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=It(t)}setAll(e){let t=re.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=It(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());Et(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ct(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Et(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Le(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new St(It(this.value))}}function kt(e){const t=[];return Le(e.fields,((e,n)=>{const r=new re([e]);if(Et(n)){const e=kt(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ve(t)}class Ct{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new Ct(e,0,X.min(),X.min(),X.min(),St.empty(),0)}static newFoundDocument(e,t,n,r){return new Ct(e,1,t,X.min(),n,r,0)}static newNoDocument(e,t){return new Ct(e,2,t,X.min(),X.min(),St.empty(),0)}static newUnknownDocument(e,t){return new Ct(e,3,t,X.min(),X.min(),St.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(X.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=St.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=St.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=X.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ct&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ct(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class At{constructor(e,t){this.position=e,this.inclusive=t}}function Nt(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ie.comparator(ie.fromName(o.referenceValue),n.key):lt(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function xt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ct(e.position[n],t.position[n]))return!1;return!0}class Ot{constructor(e,t="asc"){this.field=e,this.dir=t}}function Lt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Rt{}class Dt extends Rt{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Bt(e,t,n):"array-contains"===t?new Gt(e,n):"in"===t?new Kt(e,n):"not-in"===t?new Ht(e,n):"array-contains-any"===t?new Wt(e,n):new Dt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new zt(e,n):new qt(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(lt(t,this.value)):null!==t&&at(this.value)===at(t)&&this.matchesComparison(lt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return O()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Pt extends Rt{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Pt(e,t)}matches(e){return Mt(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function Mt(e){return"and"===e.op}function Ut(e){return function(e){for(const t of e.filters)if(t instanceof Pt)return!1;return!0}(e)&&Mt(e)}function Ft(e){if(e instanceof Dt)return e.field.canonicalString()+e.op.toString()+ft(e.value);if(Ut(e))return e.filters.map((e=>Ft(e))).join(",");{const t=e.filters.map((e=>Ft(e))).join(",");return`${e.op}(${t})`}}function Vt(e,t){return e instanceof Dt?function(e,t){return t instanceof Dt&&e.op===t.op&&e.field.isEqual(t.field)&&ct(e.value,t.value)}(e,t):e instanceof Pt?function(e,t){return t instanceof Pt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&Vt(n,t.filters[r])),!0)}(e,t):void O()}function jt(e){return e instanceof Dt?function(e){return`${e.field.canonicalString()} ${e.op} ${ft(e.value)}`}(e):e instanceof Pt?function(e){return e.op.toString()+" {"+e.getFilters().map(jt).join(" ,")+"}"}(e):"Filter"}class Bt extends Dt{constructor(e,t,n){super(e,t,n),this.key=ie.fromName(n.referenceValue)}matches(e){const t=ie.comparator(e.key,this.key);return this.matchesComparison(t)}}class zt extends Dt{constructor(e,t){super(e,"in",t),this.keys=$t(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class qt extends Dt{constructor(e,t){super(e,"not-in",t),this.keys=$t(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function $t(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ie.fromName(e.referenceValue)))}class Gt extends Dt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return vt(t)&&ut(t.arrayValue,this.value)}}class Kt extends Dt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ut(this.value.arrayValue,t)}}class Ht extends Dt{constructor(e,t){super(e,"not-in",t)}matches(e){if(ut(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!ut(this.value.arrayValue,t)}}class Wt extends Dt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!vt(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>ut(this.value.arrayValue,e)))}}class Qt{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.le=null}}function Jt(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Qt(e,t,n,r,i,s,o)}function Yt(e){const t=R(e);if(null===t.le){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Ft(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),me(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>ft(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>ft(e))).join(",")),t.le=e}return t.le}function Xt(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Lt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Vt(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!xt(e.startAt,t.startAt)&&xt(e.endAt,t.endAt)}function Zt(e){return ie.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class en{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function tn(e){return new en(e)}function nn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function rn(e){return null!==e.collectionGroup}function sn(e){const t=R(e);if(null===t.he){t.he=[];const e=new Set;for(const n of t.explicitOrderBy)t.he.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Ue(re.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.he.push(new Ot(r,n))})),e.has(re.keyField().canonicalString())||t.he.push(new Ot(re.keyField(),n))}return t.he}function on(e){const t=R(e);return t.Pe||(t.Pe=function(e,t){if("F"===e.limitType)return Jt(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Ot(e.field,t)}));const n=e.endAt?new At(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new At(e.startAt.position,e.startAt.inclusive):null;return Jt(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,sn(e))),t.Pe}function an(e,t){const n=e.filters.concat([t]);return new en(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function cn(e,t,n){return new en(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function un(e,t){return Xt(on(e),on(t))&&e.limitType===t.limitType}function ln(e){return`${Yt(on(e))}|lt:${e.limitType}`}function hn(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>jt(e))).join(", ")}]`),me(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>ft(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>ft(e))).join(",")),`Target(${t})`}(on(e))}; limitType=${e.limitType})`}function dn(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ie.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of sn(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Nt(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,sn(e),t)||e.endAt&&!function(e,t,n){const r=Nt(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,sn(e),t))}(e,t)}function fn(e){return(t,n)=>{let r=!1;for(const i of sn(e)){const e=pn(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function pn(e,t,n){const r=e.field.isKeyField()?ie.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?lt(r,i):O()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return O()}}class mn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Le(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Re(this.inner)}size(){return this.innerSize}}const gn=new De(ie.comparator);function yn(){return gn}const vn=new De(ie.comparator);function wn(...e){let t=vn;for(const n of e)t=t.insert(n.key,n);return t}function bn(e){let t=vn;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function En(){return In()}function _n(){return In()}function In(){return new mn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Tn=new De(ie.comparator),Sn=new Ue(ie.comparator);function kn(...e){let t=Sn;for(const n of e)t=t.add(n);return t}const Cn=new Ue(H);function An(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ge(t)?"-0":t}}function Nn(e){return{integerValue:""+e}}function xn(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!ge(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Nn(t):An(e,t)}class On{constructor(){this._=void 0}}function Ln(e,t,n){return e instanceof Pn?function(e,t){const n={fields:{[He]:{stringValue:Ke},[Qe]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&Je(t)&&(t=Ye(t)),t&&(n.fields[We]=t),{mapValue:n}}(n,t):e instanceof Mn?Un(e,t):e instanceof Fn?Vn(e,t):function(e,t){const n=Dn(e,t),r=Bn(n)+Bn(e.Ie);return yt(n)&&yt(e.Ie)?Nn(r):An(e.serializer,r)}(e,t)}function Rn(e,t,n){return e instanceof Mn?Un(e,t):e instanceof Fn?Vn(e,t):n}function Dn(e,t){return e instanceof jn?function(e){return yt(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Pn extends On{}class Mn extends On{constructor(e){super(),this.elements=e}}function Un(e,t){const n=zn(t);for(const t of e.elements)n.some((e=>ct(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Fn extends On{constructor(e){super(),this.elements=e}}function Vn(e,t){let n=zn(t);for(const t of e.elements)n=n.filter((e=>!ct(e,t)));return{arrayValue:{values:n}}}class jn extends On{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Bn(e){return $e(e.integerValue||e.doubleValue)}function zn(e){return vt(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class qn{constructor(e,t){this.field=e,this.transform=t}}class $n{constructor(e,t){this.version=e,this.transformResults=t}}class Gn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Gn}static exists(e){return new Gn(void 0,e)}static updateTime(e){return new Gn(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Kn(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Hn{}function Wn(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ir(e.key,Gn.none()):new Zn(e.key,e.data,Gn.none());{const n=e.data,r=St.empty();let i=new Ue(re.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new er(e.key,r,new Ve(i.toArray()),Gn.none())}}function Qn(e,t,n){e instanceof Zn?function(e,t,n){const r=e.value.clone(),i=nr(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof er?function(e,t,n){if(!Kn(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=nr(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(tr(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Jn(e,t,n,r){return e instanceof Zn?function(e,t,n,r){if(!Kn(e.precondition,t))return n;const i=e.value.clone(),s=rr(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof er?function(e,t,n,r){if(!Kn(e.precondition,t))return n;const i=rr(e.fieldTransforms,r,t),s=t.data;return s.setAll(tr(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Kn(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Yn(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Dn(r.transform,e||null);null!=i&&(null===n&&(n=St.empty()),n.set(r.field,i))}return n||null}function Xn(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&W(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Mn&&t instanceof Mn||e instanceof Fn&&t instanceof Fn?W(e.elements,t.elements,ct):e instanceof jn&&t instanceof jn?ct(e.Ie,t.Ie):e instanceof Pn&&t instanceof Pn}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Zn extends Hn{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class er extends Hn{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function tr(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function nr(e,t,n){const r=new Map;L(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Rn(o,a,n[i]))}return r}function rr(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ln(e,s,t))}return r}class ir extends Hn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sr extends Hn{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class or{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Qn(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Jn(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Jn(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=_n();return this.mutations.forEach((r=>{const i=e.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(r.key)?null:o;const a=Wn(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(X.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),kn())}isEqual(e){return this.batchId===e.batchId&&W(this.mutations,e.mutations,((e,t)=>Xn(e,t)))&&W(this.baseMutations,e.baseMutations,((e,t)=>Xn(e,t)))}}class ar{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){L(e.mutations.length===n.length);let r=Tn;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ar(e,t,n,r)}}class cr{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ur{constructor(e,t){this.count=e,this.unchangedNames=t}}var lr,hr;function dr(e){if(void 0===e)return A("GRPC error has no .code"),D.UNKNOWN;switch(e){case lr.OK:return D.OK;case lr.CANCELLED:return D.CANCELLED;case lr.UNKNOWN:return D.UNKNOWN;case lr.DEADLINE_EXCEEDED:return D.DEADLINE_EXCEEDED;case lr.RESOURCE_EXHAUSTED:return D.RESOURCE_EXHAUSTED;case lr.INTERNAL:return D.INTERNAL;case lr.UNAVAILABLE:return D.UNAVAILABLE;case lr.UNAUTHENTICATED:return D.UNAUTHENTICATED;case lr.INVALID_ARGUMENT:return D.INVALID_ARGUMENT;case lr.NOT_FOUND:return D.NOT_FOUND;case lr.ALREADY_EXISTS:return D.ALREADY_EXISTS;case lr.PERMISSION_DENIED:return D.PERMISSION_DENIED;case lr.FAILED_PRECONDITION:return D.FAILED_PRECONDITION;case lr.ABORTED:return D.ABORTED;case lr.OUT_OF_RANGE:return D.OUT_OF_RANGE;case lr.UNIMPLEMENTED:return D.UNIMPLEMENTED;case lr.DATA_LOSS:return D.DATA_LOSS;default:return O()}}(hr=lr||(lr={}))[hr.OK=0]="OK",hr[hr.CANCELLED=1]="CANCELLED",hr[hr.UNKNOWN=2]="UNKNOWN",hr[hr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",hr[hr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",hr[hr.NOT_FOUND=5]="NOT_FOUND",hr[hr.ALREADY_EXISTS=6]="ALREADY_EXISTS",hr[hr.PERMISSION_DENIED=7]="PERMISSION_DENIED",hr[hr.UNAUTHENTICATED=16]="UNAUTHENTICATED",hr[hr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",hr[hr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",hr[hr.ABORTED=10]="ABORTED",hr[hr.OUT_OF_RANGE=11]="OUT_OF_RANGE",hr[hr.UNIMPLEMENTED=12]="UNIMPLEMENTED",hr[hr.INTERNAL=13]="INTERNAL",hr[hr.UNAVAILABLE=14]="UNAVAILABLE",hr[hr.DATA_LOSS=15]="DATA_LOSS";const fr=new r([4294967295,4294967295],0);function pr(e){const t=(new TextEncoder).encode(e),n=new i;return n.update(t),new Uint8Array(n.digest())}function mr(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new r([n,i],0),new r([s,o],0)]}class gr{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new yr(`Invalid padding: ${t}`);if(n<0)throw new yr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new yr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new yr(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=r.fromNumber(this.Ee)}Ae(e,t,n){let i=e.add(t.multiply(r.fromNumber(n)));return 1===i.compare(fr)&&(i=new r([i.getBits(0),i.getBits(1)],0)),i.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ee)return!1;const t=pr(e),[n,r]=mr(t);for(let e=0;e<this.hashCount;e++){const t=this.Ae(n,r,e);if(!this.Re(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new gr(i,r,t);return n.forEach((e=>s.insert(e))),s}insert(e){if(0===this.Ee)return;const t=pr(e),[n,r]=mr(t);for(let e=0;e<this.hashCount;e++){const t=this.Ae(n,r,e);this.Ve(t)}}Ve(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class yr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class vr{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,wr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new vr(X.min(),r,new De(H),yn(),kn())}}class wr{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new wr(n,t,kn(),kn(),kn())}}class br{constructor(e,t,n,r){this.me=e,this.removedTargetIds=t,this.key=n,this.fe=r}}class Er{constructor(e,t){this.targetId=e,this.ge=t}}class _r{constructor(e,t,n=Be.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Ir{constructor(){this.pe=0,this.ye=kr(),this.we=Be.EMPTY_BYTE_STRING,this.be=!1,this.Se=!0}get current(){return this.be}get resumeToken(){return this.we}get De(){return 0!==this.pe}get ve(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.we=e)}Fe(){let e=kn(),t=kn(),n=kn();return this.ye.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:O()}})),new wr(this.we,this.be,e,t,n)}Me(){this.Se=!1,this.ye=kr()}xe(e,t){this.Se=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.Se=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,L(this.pe>=0)}Le(){this.Se=!0,this.be=!0}}class Tr{constructor(e){this.ke=e,this.qe=new Map,this.Qe=yn(),this.$e=Sr(),this.Ke=Sr(),this.Ue=new De(H)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,(t=>{const n=this.He(t);switch(e.state){case 0:this.Je(t)&&n.Ce(e.resumeToken);break;case 1:n.Be(),n.De||n.Me(),n.Ce(e.resumeToken);break;case 2:n.Be(),n.De||this.removeTarget(t);break;case 3:this.Je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),n.Ce(e.resumeToken));break;default:O()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach(((e,n)=>{this.Je(n)&&t(n)}))}Ze(e){const t=e.targetId,n=e.ge.count,r=this.Xe(t);if(r){const i=r.target;if(Zt(i))if(0===n){const e=new ie(i.path);this.ze(t,e,Ct.newNoDocument(e,X.min()))}else L(1===n);else{const r=this.et(t);if(r!==n){const n=this.tt(e),i=n?this.nt(n,e,r):1;if(0!==i){this.Ye(t);const e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(t,e)}}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=t;let s,o;try{s=Ge(n).toUint8Array()}catch(e){if(e instanceof je)return N("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new gr(s,r,i)}catch(e){return N(e instanceof yr?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Ee?null:o}nt(e,t,n){return t.ge.count===n-this.st(e,t.targetId)?0:2}st(e,t){const n=this.ke.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const i=this.ke.it(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.ze(t,n,null),r++)})),r}ot(e){const t=new Map;this.qe.forEach(((n,r)=>{const i=this.Xe(r);if(i){if(n.current&&Zt(i.target)){const t=new ie(i.target.path);this._t(t).has(r)||this.ut(r,t)||this.ze(r,t,Ct.newNoDocument(t,e))}n.ve&&(t.set(r,n.Fe()),n.Me())}}));let n=kn();this.Ke.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Xe(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.Qe.forEach(((t,n)=>n.setReadTime(e)));const r=new vr(e,t,this.Ue,this.Qe,n);return this.Qe=yn(),this.$e=Sr(),this.Ke=Sr(),this.Ue=new De(H),r}Ge(e,t){if(!this.Je(e))return;const n=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,n),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ke=this.Ke.insert(t.key,this.ct(t.key).add(e))}ze(e,t,n){if(!this.Je(e))return;const r=this.He(e);this.ut(e,t)?r.xe(t,1):r.Oe(t),this.Ke=this.Ke.insert(t,this.ct(t).delete(e)),this.Ke=this.Ke.insert(t,this.ct(t).add(e)),n&&(this.Qe=this.Qe.insert(t,n))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new Ir,this.qe.set(e,t)),t}ct(e){let t=this.Ke.get(e);return t||(t=new Ue(H),this.Ke=this.Ke.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new Ue(H),this.$e=this.$e.insert(e,t)),t}Je(e){const t=null!==this.Xe(e);return t||C("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new Ir),this.ke.getRemoteKeysForTarget(e).forEach((t=>{this.ze(e,t,null)}))}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function Sr(){return new De(ie.comparator)}function kr(){return new De(ie.comparator)}const Cr={asc:"ASCENDING",desc:"DESCENDING"},Ar={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Nr={and:"AND",or:"OR"};class xr{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Or(e,t){return e.useProto3Json||me(t)?t:{value:t}}function Lr(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Rr(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Dr(e,t){return Lr(e,t.toTimestamp())}function Pr(e){return L(!!e),X.fromTimestamp(function(e){const t=qe(e);return new Y(t.seconds,t.nanos)}(e))}function Mr(e,t){return Ur(e,t).canonicalString()}function Ur(e,t){const n=function(e){return new te(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Fr(e){const t=te.fromString(e);return L(ni(t)),t}function Vr(e,t){return Mr(e.databaseId,t.path)}function jr(e,t){const n=Fr(t);if(n.get(1)!==e.databaseId.projectId)throw new P(D.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new P(D.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ie(qr(n))}function Br(e,t){return Mr(e.databaseId,t)}function zr(e){return new te(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function qr(e){return L(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function $r(e,t,n){return{name:Vr(e,t),fields:n.value.mapValue.fields}}function Gr(e,t){return{documents:[Br(e,t.path)]}}function Kr(e,t){const n={structuredQuery:{}},r=t.path;let i;null!==t.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Br(e,i);const s=function(e){if(0!==e.length)return ei(Pt.create(e,"and"))}(t.filters);s&&(n.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:Xr(e.field),direction:Qr(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Or(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ht:n,parent:i}}function Hr(e){let t=function(e){const t=Fr(e);return 4===t.length?te.emptyPath():qr(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){L(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=function(e){const t=Wr(e);return t instanceof Pt&&Ut(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Ot(Zr(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,me(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new At(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new At(n,t)}(n.endAt)),function(e,t,n,r,i,s,o,a){return new en(e,t,n,r,i,s,o,a)}(t,i,o,s,a,"F",c,u)}function Wr(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Zr(e.unaryFilter.field);return Dt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=Zr(e.unaryFilter.field);return Dt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Zr(e.unaryFilter.field);return Dt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Zr(e.unaryFilter.field);return Dt.create(i,"!=",{nullValue:"NULL_VALUE"});default:return O()}}(e):void 0!==e.fieldFilter?function(e){return Dt.create(Zr(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return O()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Pt.create(e.compositeFilter.filters.map((e=>Wr(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return O()}}(e.compositeFilter.op))}(e):O()}function Qr(e){return Cr[e]}function Jr(e){return Ar[e]}function Yr(e){return Nr[e]}function Xr(e){return{fieldPath:e.canonicalString()}}function Zr(e){return re.fromServerFormat(e.fieldPath)}function ei(e){return e instanceof Dt?function(e){if("=="===e.op){if(bt(e.value))return{unaryFilter:{field:Xr(e.field),op:"IS_NAN"}};if(wt(e.value))return{unaryFilter:{field:Xr(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(bt(e.value))return{unaryFilter:{field:Xr(e.field),op:"IS_NOT_NAN"}};if(wt(e.value))return{unaryFilter:{field:Xr(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Xr(e.field),op:Jr(e.op),value:e.value}}}(e):e instanceof Pt?function(e){const t=e.getFilters().map((e=>ei(e)));return 1===t.length?t[0]:{compositeFilter:{op:Yr(e.op),filters:t}}}(e):O()}function ti(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function ni(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class ri{constructor(e,t,n,r,i=X.min(),s=X.min(),o=Be.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new ri(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ri(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ri(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ri(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ii{constructor(e){this.Tt=e}}function si(e){const t=Hr({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?cn(t,t.limit,"L"):t}class oi{constructor(){}At(e,t){this.Rt(e,t),t.Vt()}Rt(e,t){if("nullValue"in e)this.ft(t,5);else if("booleanValue"in e)this.ft(t,10),t.gt(e.booleanValue?1:0);else if("integerValue"in e)this.ft(t,15),t.gt($e(e.integerValue));else if("doubleValue"in e){const n=$e(e.doubleValue);isNaN(n)?this.ft(t,13):(this.ft(t,15),ge(n)?t.gt(0):t.gt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.ft(t,20),"string"==typeof n&&(n=qe(n)),t.yt(`${n.seconds||""}`),t.gt(n.nanos||0)}else if("stringValue"in e)this.wt(e.stringValue,t),this.bt(t);else if("bytesValue"in e)this.ft(t,30),t.St(Ge(e.bytesValue)),this.bt(t);else if("referenceValue"in e)this.Dt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ft(t,45),t.gt(n.latitude||0),t.gt(n.longitude||0)}else"mapValue"in e?Tt(e)?this.ft(t,Number.MAX_SAFE_INTEGER):_t(e)?this.vt(e.mapValue,t):(this.Ct(e.mapValue,t),this.bt(t)):"arrayValue"in e?(this.Ft(e.arrayValue,t),this.bt(t)):O()}wt(e,t){this.ft(t,25),this.Mt(e,t)}Mt(e,t){t.yt(e)}Ct(e,t){const n=e.fields||{};this.ft(t,55);for(const e of Object.keys(n))this.wt(e,t),this.Rt(n[e],t)}vt(e,t){var n,r;const i=e.fields||{};this.ft(t,53);const s=ot,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.ft(t,15),t.gt($e(o)),this.wt(s,t),this.Rt(i[s],t)}Ft(e,t){const n=e.values||[];this.ft(t,50);for(const e of n)this.Rt(e,t)}Dt(e,t){this.ft(t,37),ie.fromName(e).path.forEach((e=>{this.ft(t,60),this.Mt(e,t)}))}ft(e,t){e.gt(t)}bt(e){e.gt(2)}}oi.xt=new oi;class ai{constructor(){this.Tn=new ci}addToCollectionParentIndex(e,t){return this.Tn.add(t),he.resolve()}getCollectionParents(e,t){return he.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return he.resolve()}deleteFieldIndex(e,t){return he.resolve()}deleteAllFieldIndexes(e){return he.resolve()}createTargetIndexes(e,t){return he.resolve()}getDocumentsMatchingTarget(e,t){return he.resolve(null)}getIndexType(e,t){return he.resolve(0)}getFieldIndexes(e,t){return he.resolve([])}getNextCollectionGroupToUpdate(e){return he.resolve(null)}getMinOffset(e,t){return he.resolve(oe.min())}getMinOffsetFromCollectionGroup(e,t){return he.resolve(oe.min())}updateCollectionGroup(e,t,n){return he.resolve()}updateIndexEntries(e,t){return he.resolve()}}class ci{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Ue(te.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Ue(te.comparator)).toArray()}}new Uint8Array(0);const ui={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},li=41943040;class hi{static withCacheSize(e){return new hi(e,hi.DEFAULT_COLLECTION_PERCENTILE,hi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}hi.DEFAULT_COLLECTION_PERCENTILE=10,hi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hi.DEFAULT=new hi(li,hi.DEFAULT_COLLECTION_PERCENTILE,hi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hi.DISABLED=new hi(-1,0,0);class di{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Kn(){return new di(0)}static Un(){return new di(-1)}}const fi="LruGarbageCollector";function pi([e,t],[n,r]){const i=H(e,n);return 0===i?H(t,r):i}class mi{constructor(e){this.Hn=e,this.buffer=new Ue(pi),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();pi(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class gi{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Xn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return null!==this.Xn}er(e){C(fi,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){de(e)?C(fi,"Ignoring IndexedDB error during garbage collection: ",e):await le(e)}await this.er(3e5)}))}}class yi{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return he.resolve(fe.ae);const n=new mi(t);return this.tr.forEachTarget(e,(e=>n.Zn(e.sequenceNumber))).next((()=>this.tr.rr(e,(e=>n.Zn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.tr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector","Garbage collection skipped; disabled"),he.resolve(ui)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(C("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ui):this.ir(e,t)))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let n,r,i,s,o,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(C("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,c=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(u=Date.now(),k()<=a.$b.DEBUG&&C("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-l}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(c-o)+"ms\n"+`\tRemoved ${e} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-l}ms`),he.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class vi{constructor(){this.changes=new mn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ct.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?he.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class wi{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class bi{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Jn(n.mutation,e,Ve.empty(),Y.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,kn()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=kn()){const r=En();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=wn();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=En();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,kn())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let i=yn();const s=In(),o=In();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof er)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),Jn(o.mutation,t,o.mutation.getFieldMask(),Y.now())):s.set(t.key,Ve.empty())})),this.recalculateAndSaveOverlays(e,i).next((e=>(e.forEach(((e,t)=>s.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new wi(t,null!==(n=s.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=In();let r=new De(((e,t)=>e-t)),i=kn();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const i of e)i.keys().forEach((e=>{const s=t.get(e);if(null===s)return;let o=n.get(e)||Ve.empty();o=i.applyToLocalView(s,o),n.set(e,o);const a=(r.get(i.batchId)||kn()).add(e);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=_n();c.forEach((e=>{if(!i.has(e)){const r=Wn(t.get(e),n.get(e));null!==r&&u.set(e,r),i=i.add(e)}})),s.push(this.documentOverlayCache.saveOverlays(e,a,u))}return he.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return ie.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):rn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):he.resolve(En());let o=-1,a=i;return s.next((t=>he.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?he.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,i))).next((()=>this.computeViews(e,a,t,kn()))).next((e=>({batchId:o,changes:bn(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ie(t)).next((e=>{let t=wn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const i=t.collectionGroup;let s=wn();return this.indexManager.getCollectionParents(e,i).next((o=>he.forEach(o,(o=>{const a=function(e,t){return new en(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{s=s.insert(e,t)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r)))).next((e=>{i.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Ct.newInvalidDocument(r)))}));let n=wn();return e.forEach(((e,r)=>{const s=i.get(e);void 0!==s&&Jn(s.mutation,r,Ve.empty(),Y.now()),dn(t,r)&&(n=n.insert(e,r))})),n}))}}class Ei{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return he.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Pr(e.createTime)}}(t)),he.resolve()}getNamedQuery(e,t){return he.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(e){return{name:e.name,query:si(e.bundledQuery),readTime:Pr(e.readTime)}}(t)),he.resolve()}}class _i{constructor(){this.overlays=new De(ie.comparator),this.Rr=new Map}getOverlay(e,t){return he.resolve(this.overlays.get(t))}getOverlays(e,t){const n=En();return he.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.Et(e,t,r)})),he.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Rr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Rr.delete(n)),he.resolve()}getOverlaysForCollection(e,t,n){const r=En(),i=t.length+1,s=new ie(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return he.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new De(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=En(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=En(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return he.resolve(o)}Et(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.Rr.get(r.largestBatchId).delete(n.key);this.Rr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new cr(t,n));let i=this.Rr.get(t);void 0===i&&(i=kn(),this.Rr.set(t,i)),this.Rr.set(t,i.add(n.key))}}class Ii{constructor(){this.sessionToken=Be.EMPTY_BYTE_STRING}getSessionToken(e){return he.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,he.resolve()}}class Ti{constructor(){this.Vr=new Ue(Si.mr),this.gr=new Ue(Si.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const n=new Si(e,t);this.Vr=this.Vr.add(n),this.gr=this.gr.add(n)}yr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.wr(new Si(e,t))}br(e,t){e.forEach((e=>this.removeReference(e,t)))}Sr(e){const t=new ie(new te([])),n=new Si(t,e),r=new Si(t,e+1),i=[];return this.gr.forEachInRange([n,r],(e=>{this.wr(e),i.push(e.key)})),i}Dr(){this.Vr.forEach((e=>this.wr(e)))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new ie(new te([])),n=new Si(t,e),r=new Si(t,e+1);let i=kn();return this.gr.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Si(e,0),n=this.Vr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Si{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return ie.comparator(e.key,t.key)||H(e.Cr,t.Cr)}static pr(e,t){return H(e.Cr,t.Cr)||ie.comparator(e.key,t.key)}}class ki{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new Ue(Si.mr)}checkEmpty(e){return he.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const i=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new or(i,t,n,r);this.mutationQueue.push(s);for(const t of r)this.Mr=this.Mr.add(new Si(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return he.resolve(s)}lookupMutationBatch(e,t){return he.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Nr(n),i=r<0?0:r;return he.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return he.resolve(0===this.mutationQueue.length?pe:this.Fr-1)}getAllMutationBatches(e){return he.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Si(t,0),r=new Si(t,Number.POSITIVE_INFINITY),i=[];return this.Mr.forEachInRange([n,r],(e=>{const t=this.Or(e.Cr);i.push(t)})),he.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Ue(H);return t.forEach((e=>{const t=new Si(e,0),r=new Si(e,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([t,r],(e=>{n=n.add(e.Cr)}))})),he.resolve(this.Br(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ie.isDocumentKey(i)||(i=i.child(""));const s=new Si(new ie(i),0);let o=new Ue(H);return this.Mr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Cr)),!0)}),s),he.resolve(this.Br(o))}Br(e){const t=[];return e.forEach((e=>{const n=this.Or(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){L(0===this.Lr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.Mr;return he.forEach(t.mutations,(r=>{const i=new Si(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Mr=n}))}qn(e){}containsKey(e,t){const n=new Si(t,0),r=this.Mr.firstAfterOrEqual(n);return he.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,he.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Ci{constructor(e){this.kr=e,this.docs=new De(ie.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.kr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return he.resolve(n?n.document.mutableCopy():Ct.newInvalidDocument(t))}getEntries(e,t){let n=yn();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ct.newInvalidDocument(e))})),he.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=yn();const s=t.path,o=new ie(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||ae(se(o),n)<=0||(r.has(o.key)||dn(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return he.resolve(i)}getAllFromCollectionGroup(e,t,n,r){O()}qr(e,t){return he.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Ai(this)}getSize(e){return he.resolve(this.size)}}class Ai extends vi{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Ir.addEntry(e,r)):this.Ir.removeEntry(n)})),he.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}class Ni{constructor(e){this.persistence=e,this.Qr=new mn((e=>Yt(e)),Xt),this.lastRemoteSnapshotVersion=X.min(),this.highestTargetId=0,this.$r=0,this.Kr=new Ti,this.targetCount=0,this.Ur=di.Kn()}forEachTarget(e,t){return this.Qr.forEach(((e,n)=>t(n))),he.resolve()}getLastRemoteSnapshotVersion(e){return he.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return he.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Ur.next(),he.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.$r&&(this.$r=t),he.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ur=new di(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,he.resolve()}updateTargetData(e,t){return this.zn(t),he.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Kr.Sr(t.targetId),this.targetCount-=1,he.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Qr.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Qr.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),he.waitFor(i).next((()=>r))}getTargetCount(e){return he.resolve(this.targetCount)}getTargetData(e,t){const n=this.Qr.get(t)||null;return he.resolve(n)}addMatchingKeys(e,t,n){return this.Kr.yr(t,n),he.resolve()}removeMatchingKeys(e,t,n){this.Kr.br(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),he.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Kr.Sr(t),he.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Kr.vr(t);return he.resolve(n)}containsKey(e,t){return he.resolve(this.Kr.containsKey(t))}}class xi{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new fe(0),this.zr=!1,this.zr=!0,this.jr=new Ii,this.referenceDelegate=e(this),this.Hr=new Ni(this),this.indexManager=new ai,this.remoteDocumentCache=function(e){return new Ci(e)}((e=>this.referenceDelegate.Jr(e))),this.serializer=new ii(t),this.Yr=new Ei(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _i,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Wr[e.toKey()];return n||(n=new ki(t,this.referenceDelegate),this.Wr[e.toKey()]=n),n}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,n){C("MemoryPersistence","Starting transaction:",e);const r=new Oi(this.Gr.next());return this.referenceDelegate.Zr(),n(r).next((e=>this.referenceDelegate.Xr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}ei(e,t){return he.or(Object.values(this.Wr).map((n=>()=>n.containsKey(e,t))))}}class Oi extends ue{constructor(e){super(),this.currentSequenceNumber=e}}class Li{constructor(e){this.persistence=e,this.ti=new Ti,this.ni=null}static ri(e){return new Li(e)}get ii(){if(this.ni)return this.ni;throw O()}addReference(e,t,n){return this.ti.addReference(n,t),this.ii.delete(n.toString()),he.resolve()}removeReference(e,t,n){return this.ti.removeReference(n,t),this.ii.add(n.toString()),he.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),he.resolve()}removeTarget(e,t){this.ti.Sr(t.targetId).forEach((e=>this.ii.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.ii.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return he.forEach(this.ii,(n=>{const r=ie.fromPath(n);return this.si(e,r).next((e=>{e||t.removeEntry(r,X.min())}))})).next((()=>(this.ni=null,t.apply(e))))}updateLimboDocument(e,t){return this.si(e,t).next((e=>{e?this.ii.delete(t.toString()):this.ii.add(t.toString())}))}Jr(e){return 0}si(e,t){return he.or([()=>he.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class Ri{constructor(e,t){this.persistence=e,this.oi=new mn((e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=ve(t)),t=ye(e.get(n),t);return ve(t)}(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=function(e,t){return new yi(e,t)}(this,t)}static ri(e,t){return new Ri(e,t)}Zr(){}Xr(e){return he.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}sr(e){let t=0;return this.rr(e,(e=>{t++})).next((()=>t))}rr(e,t){return he.forEach(this.oi,((n,r)=>this.ar(e,n,r).next((e=>e?he.resolve():t(r)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.qr(e,(r=>this.ar(e,r,t).next((e=>{e||(n++,i.removeEntry(r,X.min()))})))).next((()=>i.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),he.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),he.resolve()}removeReference(e,t,n){return this.oi.set(n,e.currentSequenceNumber),he.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),he.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=mt(e.data.value)),t}ar(e,t,n){return he.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.oi.get(t);return he.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class Di{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Hi=n,this.Ji=r}static Yi(e,t){let n=kn(),r=kn();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Di(e,t.fromCache,n,r)}}class Pi{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Mi{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=(0,c.nr)()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}((0,c.ZQ)())>0?6:4}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,n,r){const i={result:null};return this.rs(e,t).next((e=>{i.result=e})).next((()=>{if(!i.result)return this.ss(e,t,r,n).next((e=>{i.result=e}))})).next((()=>{if(i.result)return;const n=new Pi;return this._s(e,t,n).next((r=>{if(i.result=r,this.Xi)return this.us(e,t,n,r.size)}))})).next((()=>i.result))}us(e,t,n,r){return n.documentReadCount<this.es?(k()<=a.$b.DEBUG&&C("QueryEngine","SDK will not create cache indexes for query:",hn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),he.resolve()):(k()<=a.$b.DEBUG&&C("QueryEngine","Query:",hn(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ts*r?(k()<=a.$b.DEBUG&&C("QueryEngine","The SDK decides to create cache indexes for query:",hn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,on(t))):he.resolve())}rs(e,t){if(nn(t))return he.resolve(null);let n=on(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=cn(t,null,"F"),n=on(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const i=kn(...r);return this.ns.getDocuments(e,i).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const s=this.cs(t,r);return this.ls(t,s,i,n.readTime)?this.rs(e,cn(t,null,"F")):this.hs(e,s,t,n)}))))})))))}ss(e,t,n,r){return nn(t)||r.isEqual(X.min())?he.resolve(null):this.ns.getDocuments(e,n).next((i=>{const s=this.cs(t,i);return this.ls(t,s,n,r)?he.resolve(null):(k()<=a.$b.DEBUG&&C("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),hn(t)),this.hs(e,s,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=X.fromTimestamp(1e9===r?new Y(n+1,0):new Y(n,r));return new oe(i,ie.empty(),t)}(r,-1)).next((e=>e)))}))}cs(e,t){let n=new Ue(fn(e));return t.forEach(((t,r)=>{dn(e,r)&&(n=n.add(r))})),n}ls(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}_s(e,t,n){return k()<=a.$b.DEBUG&&C("QueryEngine","Using full collection scan to execute query:",hn(t)),this.ns.getDocumentsMatchingQuery(e,t,oe.min(),n)}hs(e,t,n,r){return this.ns.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const Ui="LocalStore",Fi=3e8;class Vi{constructor(e,t,n,r){this.persistence=e,this.Ps=t,this.serializer=r,this.Ts=new De(H),this.Is=new mn((e=>Yt(e)),Xt),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(n)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new bi(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ts)))}}async function ji(e,t){const n=R(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((i=>(r=i,n.As(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=kn();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Rs:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Bi(e){const t=R(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Hr.getLastRemoteSnapshotVersion(e)))}function zi(e,t){const n=R(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=pe),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function qi(e,t,n){const r=R(e),i=r.Ts.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!de(e))throw e;C(Ui,`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ts=r.Ts.remove(t),r.Is.delete(i.target)}function $i(e,t,n){const r=R(e);let i=X.min(),s=kn();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=R(e),i=r.Is.get(n);return void 0!==i?he.resolve(r.Ts.get(i)):r.Hr.getTargetData(t,n)}(r,e,on(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.Ps.getDocumentsMatchingQuery(e,t,n?i:X.min(),n?s:kn()))).next((e=>(function(e,t,n){let r=e.Es.get(t)||X.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Es.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,gs:s})))))}class Gi{constructor(){this.activeTargetIds=Cn}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ss(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ki{constructor(){this.ho=new Gi,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,n){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new Gi,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Hi{To(e){}shutdown(){}}const Wi="ConnectivityMonitor";class Qi{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){C(Wi,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){C(Wi,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ji=null;function Yi(){return null===Ji?Ji=268435456+Math.round(2147483648*Math.random()):Ji++,"0x"+Ji.toString(16)}const Xi="RestConnection",Zi={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class es{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${n}/databases/${r}`,this.wo=this.databaseId.database===et?`project_id=${n}`:`project_id=${n}&database_id=${r}`}bo(e,t,n,r,i){const s=Yi(),o=this.So(e,t.toUriEncodedString());C(Xi,`Sending RPC '${e}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(a,r,i),this.vo(e,o,a,n).then((t=>(C(Xi,`Received RPC '${e}' ${s}: `,t),t)),(t=>{throw N(Xi,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t}))}Co(e,t,n,r,i,s){return this.bo(e,t,n,r,i)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+T,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}So(e,t){const n=Zi[e];return`${this.po}/v1/${t}:${n}`}terminate(){}}class ts{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Ko(e){this.ko(e)}Uo(e){this.qo(e)}}const ns="WebChannelConnection";class rs extends es{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,n,r){const i=Yi();return new Promise(((s,o)=>{const a=new h;a.setWithCredentials(!0),a.listenOnce(f.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case p.NO_ERROR:const t=a.getResponseJson();C(ns,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),s(t);break;case p.TIMEOUT:C(ns,`RPC '${e}' ${i} timed out`),o(new P(D.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:const n=a.getStatus();if(C(ns,`RPC '${e}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(D).indexOf(t)>=0?t:D.UNKNOWN}(t.status);o(new P(e,t.message))}else o(new P(D.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new P(D.UNAVAILABLE,"Connection failed."));break;default:O()}}finally{C(ns,`RPC '${e}' ${i} completed.`)}}));const c=JSON.stringify(r);C(ns,`RPC '${e}' ${i} sending request:`,r),a.send(t,"POST",c,n,15)}))}Wo(e,t,n){const r=Yi(),i=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=v(),o=y(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=i.join("");C(ns,`Creating RPC '${e}' stream ${r}: ${u}`,a);const l=s.createWebChannel(u,a);let h=!1,f=!1;const p=new ts({Fo:t=>{f?C(ns,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(h||(C(ns,`Opening RPC '${e}' stream ${r} transport.`),l.open(),h=!0),C(ns,`RPC '${e}' stream ${r} sending:`,t),l.send(t))},Mo:()=>l.close()}),w=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return w(l,d.EventType.OPEN,(()=>{f||(C(ns,`RPC '${e}' stream ${r} transport opened.`),p.Qo())})),w(l,d.EventType.CLOSE,(()=>{f||(f=!0,C(ns,`RPC '${e}' stream ${r} transport closed`),p.Ko())})),w(l,d.EventType.ERROR,(t=>{f||(f=!0,N(ns,`RPC '${e}' stream ${r} transport errored:`,t),p.Ko(new P(D.UNAVAILABLE,"The operation could not be completed")))})),w(l,d.EventType.MESSAGE,(t=>{var n;if(!f){const i=t.data[0];L(!!i);const s=i,o=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){C(ns,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=lr[e];if(void 0!==t)return dr(t)}(t),i=o.message;void 0===n&&(n=D.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),f=!0,p.Ko(new P(n,i)),l.close()}else C(ns,`RPC '${e}' stream ${r} received:`,i),p.Uo(i)}})),w(o,g.STAT_EVENT,(t=>{t.stat===m.PROXY?C(ns,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===m.NOPROXY&&C(ns,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{p.$o()}),0),p}}function is(){return"undefined"!=typeof document?document:null}function ss(e){return new xr(e,!0)}class os{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Ti=e,this.timerId=t,this.Go=n,this.zo=r,this.jo=i,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),n=Math.max(0,Date.now()-this.Yo),r=Math.max(0,t-n);r>0&&C("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,r,(()=>(this.Yo=Date.now(),e()))),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){null!==this.Jo&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){null!==this.Jo&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}const as="PersistentStream";class cs{constructor(e,t,n,r,i,s,o,a){this.Ti=e,this.n_=n,this.r_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new os(e,t)}u_(){return 1===this.state||5===this.state||this.c_()}c_(){return 2===this.state||3===this.state}start(){this.__=0,4!==this.state?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&null===this.s_&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,(()=>this.T_())))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,4!==e?this.a_.reset():t&&t.code===D.RESOURCE_EXHAUSTED?(A(t.toString()),A("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===D.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.i_===t&&this.V_(e,n)}),(t=>{e((()=>{const e=new P(D.UNKNOWN,"Fetching auth token failed: "+t.message);return this.m_(e)}))}))}V_(e,t){const n=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo((()=>{n((()=>this.listener.xo()))})),this.stream.No((()=>{n((()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,(()=>(this.c_()&&(this.state=3),Promise.resolve()))),this.listener.No())))})),this.stream.Lo((e=>{n((()=>this.m_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.__?this.g_(e):this.onNext(e)))}))}l_(){this.state=5,this.a_.Xo((async()=>{this.state=0,this.start()}))}m_(e){return C(as,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget((()=>this.i_===e?t():(C(as,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class us extends cs{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:O()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(L(void 0===t||"string"==typeof t),Be.fromBase64String(t||"")):(L(void 0===t||t instanceof Buffer||t instanceof Uint8Array),Be.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?D.UNKNOWN:dr(e.code);return new P(t,e.message||"")}(o);n=new _r(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=jr(e,r.document.name),s=Pr(r.document.updateTime),o=r.document.createTime?Pr(r.document.createTime):X.min(),a=new St({mapValue:{fields:r.document.fields}}),c=Ct.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];n=new br(u,l,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=jr(e,r.document),s=r.readTime?Pr(r.readTime):X.min(),o=Ct.newNoDocument(i,s),a=r.removedTargetIds||[];n=new br([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=jr(e,r.document),s=r.removedTargetIds||[];n=new br([],s,i,null)}else{if(!("filter"in t))return O();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:i}=e,s=new ur(r,i),o=e.targetId;n=new Er(o,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return X.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?X.min():t.readTime?Pr(t.readTime):X.min()}(e);return this.listener.p_(t,n)}y_(e){const t={};t.database=zr(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=Zt(r)?{documents:Gr(e,r)}:{query:Kr(e,r).ht},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Rr(e,t.resumeToken);const r=Or(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(X.min())>0){n.readTime=Lr(e,t.snapshotVersion.toTimestamp());const r=Or(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return O()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.I_(t)}w_(e){const t={};t.database=zr(this.serializer),t.removeTarget=e,this.I_(t)}}class ls extends cs{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get b_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.b_&&this.S_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return L(!!e.streamToken),this.lastStreamToken=e.streamToken,L(!e.writeResults||0===e.writeResults.length),this.listener.D_()}onNext(e){L(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=function(e,t){return e&&e.length>0?(L(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Pr(e.updateTime):Pr(t);return n.isEqual(X.min())&&(n=Pr(t)),new $n(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Pr(e.commitTime);return this.listener.v_(n,t)}C_(){const e={};e.database=zr(this.serializer),this.I_(e)}S_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof Zn)n={update:$r(e,t.key,t.value)};else if(t instanceof ir)n={delete:Vr(e,t.key)};else if(t instanceof er)n={update:$r(e,t.key,t.data),updateMask:ti(t.fieldMask)};else{if(!(t instanceof sr))return O();n={verify:Vr(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Pn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Mn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Fn)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof jn)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw O()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Dr(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:O()}(e,t.precondition)),n}(this.serializer,e)))};this.I_(t)}}class hs{}class ds extends hs{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.F_=!1}M_(){if(this.F_)throw new P(D.FAILED_PRECONDITION,"The client has already been terminated.")}bo(e,t,n,r){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.bo(e,Ur(t,n),r,i,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new P(D.UNKNOWN,e.toString())}))}Co(e,t,n,r,i){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.Co(e,Ur(t,n),r,s,o,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===D.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new P(D.UNKNOWN,e.toString())}))}terminate(){this.F_=!0,this.connection.terminate()}}class fs{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){0===this.x_&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve()))))}q_(e){"Online"===this.state?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,"Online"===e&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(A(t),this.N_=!1):C("OnlineStateTracker",t)}Q_(){null!==this.O_&&(this.O_.cancel(),this.O_=null)}}const ps="RemoteStore";class ms{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.K_=[],this.U_=new Map,this.W_=new Set,this.G_=[],this.z_=i,this.z_.To((e=>{n.enqueueAndForget((async()=>{Ts(this)&&(C(ps,"Restarting streams for network reachability change."),await async function(e){const t=R(e);t.W_.add(4),await ys(t),t.j_.set("Unknown"),t.W_.delete(4),await gs(t)}(this))}))})),this.j_=new fs(n,r)}}async function gs(e){if(Ts(e))for(const t of e.G_)await t(!0)}async function ys(e){for(const t of e.G_)await t(!1)}function vs(e,t){const n=R(e);n.U_.has(t.targetId)||(n.U_.set(t.targetId,t),Is(n)?_s(n):zs(n).c_()&&bs(n,t))}function ws(e,t){const n=R(e),r=zs(n);n.U_.delete(t),r.c_()&&Es(n,t),0===n.U_.size&&(r.c_()?r.P_():Ts(n)&&n.j_.set("Unknown"))}function bs(e,t){if(e.H_.Ne(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(X.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}zs(e).y_(t)}function Es(e,t){e.H_.Ne(t),zs(e).w_(t)}function _s(e){e.H_=new Tr({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),lt:t=>e.U_.get(t)||null,it:()=>e.datastore.serializer.databaseId}),zs(e).start(),e.j_.B_()}function Is(e){return Ts(e)&&!zs(e).u_()&&e.U_.size>0}function Ts(e){return 0===R(e).W_.size}function Ss(e){e.H_=void 0}async function ks(e){e.j_.set("Online")}async function Cs(e){e.U_.forEach(((t,n)=>{bs(e,t)}))}async function As(e,t){Ss(e),Is(e)?(e.j_.q_(t),_s(e)):e.j_.set("Unknown")}async function Ns(e,t,n){if(e.j_.set("Online"),t instanceof _r&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.U_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.U_.delete(r),e.H_.removeTarget(r))}(e,t)}catch(n){C(ps,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await xs(e,n)}else if(t instanceof br?e.H_.We(t):t instanceof Er?e.H_.Ze(t):e.H_.je(t),!n.isEqual(X.min()))try{const t=await Bi(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.H_.ot(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e.U_.get(r);i&&e.U_.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.U_.get(t);if(!r)return;e.U_.set(t,r.withResumeToken(Be.EMPTY_BYTE_STRING,r.snapshotVersion)),Es(e,t);const i=new ri(r.target,t,n,r.sequenceNumber);bs(e,i)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){C(ps,"Failed to raise snapshot:",t),await xs(e,t)}}async function xs(e,t,n){if(!de(t))throw t;e.W_.add(1),await ys(e),e.j_.set("Offline"),n||(n=()=>Bi(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{C(ps,"Retrying IndexedDB access"),await n(),e.W_.delete(1),await gs(e)}))}function Os(e,t){return t().catch((n=>xs(e,n,t)))}async function Ls(e){const t=R(e),n=qs(t);let r=t.K_.length>0?t.K_[t.K_.length-1].batchId:pe;for(;Rs(t);)try{const e=await zi(t.localStore,r);if(null===e){0===t.K_.length&&n.P_();break}r=e.batchId,Ds(t,e)}catch(e){await xs(t,e)}Ps(t)&&Ms(t)}function Rs(e){return Ts(e)&&e.K_.length<10}function Ds(e,t){e.K_.push(t);const n=qs(e);n.c_()&&n.b_&&n.S_(t.mutations)}function Ps(e){return Ts(e)&&!qs(e).u_()&&e.K_.length>0}function Ms(e){qs(e).start()}async function Us(e){qs(e).C_()}async function Fs(e){const t=qs(e);for(const n of e.K_)t.S_(n.mutations)}async function Vs(e,t,n){const r=e.K_.shift(),i=ar.from(r,t,n);await Os(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await Ls(e)}async function js(e,t){t&&qs(e).b_&&await async function(e,t){if(function(e){return function(e){switch(e){case D.OK:return O();case D.CANCELLED:case D.UNKNOWN:case D.DEADLINE_EXCEEDED:case D.RESOURCE_EXHAUSTED:case D.INTERNAL:case D.UNAVAILABLE:case D.UNAUTHENTICATED:return!1;case D.INVALID_ARGUMENT:case D.NOT_FOUND:case D.ALREADY_EXISTS:case D.PERMISSION_DENIED:case D.FAILED_PRECONDITION:case D.ABORTED:case D.OUT_OF_RANGE:case D.UNIMPLEMENTED:case D.DATA_LOSS:return!0;default:return O()}}(e)&&e!==D.ABORTED}(t.code)){const n=e.K_.shift();qs(e).h_(),await Os(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await Ls(e)}}(e,t),Ps(e)&&Ms(e)}async function Bs(e,t){const n=R(e);n.asyncQueue.verifyOperationInProgress(),C(ps,"RemoteStore received new credentials");const r=Ts(n);n.W_.add(3),await ys(n),r&&n.j_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.W_.delete(3),await gs(n)}function zs(e){return e.J_||(e.J_=function(e,t,n){const r=R(e);return r.M_(),new us(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:ks.bind(null,e),No:Cs.bind(null,e),Lo:As.bind(null,e),p_:Ns.bind(null,e)}),e.G_.push((async t=>{t?(e.J_.h_(),Is(e)?_s(e):e.j_.set("Unknown")):(await e.J_.stop(),Ss(e))}))),e.J_}function qs(e){return e.Y_||(e.Y_=function(e,t,n){const r=R(e);return r.M_(),new ls(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{xo:()=>Promise.resolve(),No:Us.bind(null,e),Lo:js.bind(null,e),D_:Fs.bind(null,e),v_:Vs.bind(null,e)}),e.G_.push((async t=>{t?(e.Y_.h_(),await Ls(e)):(await e.Y_.stop(),e.K_.length>0&&(C(ps,`Stopping write stream with ${e.K_.length} pending writes`),e.K_=[]))}))),e.Y_}class $s{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new M,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new $s(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(D.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gs(e,t){if(A("AsyncQueue",`${t}: ${e}`),de(e))return new P(D.UNAVAILABLE,`${t}: ${e}`);throw e}class Ks{static emptySet(e){return new Ks(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||ie.comparator(t.key,n.key):(e,t)=>ie.comparator(e.key,t.key),this.keyedMap=wn(),this.sortedSet=new De(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ks))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Ks;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Hs{constructor(){this.Z_=new De(ie.comparator)}track(e){const t=e.doc.key,n=this.Z_.get(t);n?0!==e.type&&3===n.type?this.Z_=this.Z_.insert(t,e):3===e.type&&1!==n.type?this.Z_=this.Z_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Z_=this.Z_.remove(t):1===e.type&&2===n.type?this.Z_=this.Z_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):O():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Ws{constructor(e,t,n,r,i,s,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,i){const s=[];return t.forEach((e=>{s.push({type:0,doc:e})})),new Ws(e,t,Ks.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&un(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Qs{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some((e=>e.ra()))}}class Js{constructor(){this.queries=Ys(),this.onlineState="Unknown",this.ia=new Set}terminate(){!function(e,t){const n=R(e),r=n.queries;n.queries=Ys(),r.forEach(((e,n)=>{for(const e of n.ta)e.onError(t)}))}(this,new P(D.ABORTED,"Firestore shutting down"))}}function Ys(){return new mn((e=>ln(e)),un)}async function Xs(e,t){const n=R(e);let r=3;const i=t.query;let s=n.queries.get(i);s?!s.na()&&t.ra()&&(r=2):(s=new Qs,r=t.ra()?0:1);try{switch(r){case 0:s.ea=await n.onListen(i,!0);break;case 1:s.ea=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(e){const n=Gs(e,`Initialization of query '${hn(t.query)}' failed`);return void t.onError(n)}n.queries.set(i,s),s.ta.push(t),t.sa(n.onlineState),s.ea&&t.oa(s.ea)&&no(n)}async function Zs(e,t){const n=R(e),r=t.query;let i=3;const s=n.queries.get(r);if(s){const e=s.ta.indexOf(t);e>=0&&(s.ta.splice(e,1),0===s.ta.length?i=t.ra()?0:1:!s.na()&&t.ra()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function eo(e,t){const n=R(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.ta)t.oa(e)&&(r=!0);i.ea=e}}r&&no(n)}function to(e,t,n){const r=R(e),i=r.queries.get(t);if(i)for(const e of i.ta)e.onError(n);r.queries.delete(t)}function no(e){e.ia.forEach((e=>{e.next()}))}var ro,io;(io=ro||(ro={}))._a="default",io.Cache="cache";class so{constructor(e,t,n){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=n||{}}oa(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Ws(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache)return!0;if(!this.ra())return!0;const n="Offline"!==t;return(!this.options.Ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Pa(e){e=Ws.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==ro.Cache}}class oo{constructor(e){this.key=e}}class ao{constructor(e){this.key=e}}class co{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=kn(),this.mutatedKeys=kn(),this.ya=fn(e),this.wa=new Ks(this.ya)}get ba(){return this.fa}Sa(e,t){const n=t?t.Da:new Hs,r=t?t.wa:this.wa;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=dn(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.va(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.ya(l,a)>0||c&&this.ya(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{wa:s,Da:n,ls:o,mutatedKeys:i}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const i=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const s=e.Da.X_();s.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return O()}};return n(e)-n(t)}(e.type,t.type)||this.ya(e.doc,t.doc))),this.Ca(n),r=null!=r&&r;const o=t&&!r?this.Fa():[],a=0===this.pa.size&&this.current&&!r?1:0,c=a!==this.ga;return this.ga=a,0!==s.length||c?{snapshot:new Ws(this.query,e.wa,i,s,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ma:o}:{Ma:o}}sa(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({wa:this.wa,Da:new Hs,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach((e=>this.fa=this.fa.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.fa=this.fa.delete(e))),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=kn(),this.wa.forEach((e=>{this.xa(e.key)&&(this.pa=this.pa.add(e.key))}));const t=[];return e.forEach((e=>{this.pa.has(e)||t.push(new ao(e))})),this.pa.forEach((n=>{e.has(n)||t.push(new oo(n))})),t}Oa(e){this.fa=e.gs,this.pa=kn();const t=this.Sa(e.documents);return this.applyChanges(t,!0)}Na(){return Ws.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,0===this.ga,this.hasCachedResults)}}const uo="SyncEngine";class lo{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ho{constructor(e){this.key=e,this.Ba=!1}}class fo{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.La={},this.ka=new mn((e=>ln(e)),un),this.qa=new Map,this.Qa=new Set,this.$a=new De(ie.comparator),this.Ka=new Map,this.Ua=new Ti,this.Wa={},this.Ga=new Map,this.za=di.Un(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return!0===this.ja}}async function po(e,t,n=!0){const r=Do(e);let i;const s=r.ka.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Na()):i=await go(r,t,n,!0),i}async function mo(e,t){const n=Do(e);await go(n,t,!0,!1)}async function go(e,t,n,r){const i=await function(e,t){const n=R(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Hr.getTargetData(e,t).next((i=>i?(r=i,he.resolve(r)):n.Hr.allocateTargetId(e).next((i=>(r=new ri(t,i,"TargetPurposeListen",e.currentSequenceNumber),n.Hr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.Ts.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ts=n.Ts.insert(e.targetId,e),n.Is.set(t,e.targetId)),e}))}(e.localStore,on(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(e,t,n,r,i){e.Ha=(t,n,r)=>async function(e,t,n,r){let i=t.view.Sa(n);i.ls&&(i=await $i(e.localStore,t.query,!1).then((({documents:e})=>t.view.Sa(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return Ao(e,t.targetId,a.Ma),a.snapshot}(e,t,n,r);const s=await $i(e.localStore,t,!0),o=new co(t,s.gs),a=o.Sa(s.documents),c=wr.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),u=o.applyChanges(a,e.isPrimaryClient,c);Ao(e,n,u.Ma);const l=new lo(t,n,o);return e.ka.set(t,l),e.qa.has(n)?e.qa.get(n).push(t):e.qa.set(n,[t]),u.snapshot}(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&n&&vs(e.remoteStore,i),a}async function yo(e,t,n){const r=R(e),i=r.ka.get(t),s=r.qa.get(i.targetId);if(s.length>1)return r.qa.set(i.targetId,s.filter((e=>!un(e,t)))),void r.ka.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await qi(r.localStore,i.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(i.targetId),n&&ws(r.remoteStore,i.targetId),ko(r,i.targetId)})).catch(le)):(ko(r,i.targetId),await qi(r.localStore,i.targetId,!0))}async function vo(e,t){const n=R(e),r=n.ka.get(t),i=n.qa.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),ws(n.remoteStore,r.targetId))}async function wo(e,t){const n=R(e);try{const e=await function(e,t){const n=R(e),r=t.snapshotVersion;let i=n.Ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.ds.newChangeBuffer({trackRemovals:!0});i=n.Ts;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Hr.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.Hr.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(Be.EMPTY_BYTE_STRING,X.min()).withLastLimboFreeSnapshotVersion(X.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=Fi||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Hr.updateTargetData(e,u))}));let a=yn(),c=kn();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=kn(),i=kn();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=yn();return n.forEach(((n,s)=>{const o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(X.min())?(t.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),r=r.insert(n,s)):C(Ui,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{Vs:r,fs:i}}))}(e,s,t.documentUpdates).next((e=>{a=e.Vs,c=e.fs}))),!r.isEqual(X.min())){const t=n.Hr.getLastRemoteSnapshotVersion(e).next((t=>n.Hr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return he.waitFor(o).next((()=>s.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.Ts=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Ka.get(t);r&&(L(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.Ba=!0:e.modifiedDocuments.size>0?L(r.Ba):e.removedDocuments.size>0&&(L(r.Ba),r.Ba=!1))})),await Oo(n,e,t)}catch(e){await le(e)}}function bo(e,t,n){const r=R(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ka.forEach(((n,r)=>{const i=r.view.sa(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=R(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.ta)e.sa(t)&&(r=!0)})),r&&no(n)}(r.eventManager,t),e.length&&r.La.p_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Eo(e,t,n){const r=R(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.Ka.get(t),s=i&&i.key;if(s){let e=new De(ie.comparator);e=e.insert(s,Ct.newNoDocument(s,X.min()));const n=kn().add(s),i=new vr(X.min(),new Map,new De(H),e,n);await wo(r,i),r.$a=r.$a.remove(s),r.Ka.delete(t),xo(r)}else await qi(r.localStore,t,!1).then((()=>ko(r,t,n))).catch(le)}async function _o(e,t){const n=R(e),r=t.batch.batchId;try{const e=await function(e,t){const n=R(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.ds.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=he.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);L(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=kn();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);So(n,r,null),To(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Oo(n,e)}catch(e){await le(e)}}async function Io(e,t,n){const r=R(e);try{const e=await function(e,t){const n=R(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(L(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);So(r,t,n),To(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Oo(r,e)}catch(n){await le(n)}}function To(e,t){(e.Ga.get(t)||[]).forEach((e=>{e.resolve()})),e.Ga.delete(t)}function So(e,t,n){const r=R(e);let i=r.Wa[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.Wa[r.currentUser.toKey()]=i}}function ko(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.qa.get(t))e.ka.delete(r),n&&e.La.Ja(r,n);e.qa.delete(t),e.isPrimaryClient&&e.Ua.Sr(t).forEach((t=>{e.Ua.containsKey(t)||Co(e,t)}))}function Co(e,t){e.Qa.delete(t.path.canonicalString());const n=e.$a.get(t);null!==n&&(ws(e.remoteStore,n),e.$a=e.$a.remove(t),e.Ka.delete(n),xo(e))}function Ao(e,t,n){for(const r of n)r instanceof oo?(e.Ua.addReference(r.key,t),No(e,r)):r instanceof ao?(C(uo,"Document no longer in limbo: "+r.key),e.Ua.removeReference(r.key,t),e.Ua.containsKey(r.key)||Co(e,r.key)):O()}function No(e,t){const n=t.key,r=n.path.canonicalString();e.$a.get(n)||e.Qa.has(r)||(C(uo,"New document in limbo: "+n),e.Qa.add(r),xo(e))}function xo(e){for(;e.Qa.size>0&&e.$a.size<e.maxConcurrentLimboResolutions;){const t=e.Qa.values().next().value;e.Qa.delete(t);const n=new ie(te.fromString(t)),r=e.za.next();e.Ka.set(r,new ho(n)),e.$a=e.$a.insert(n,r),vs(e.remoteStore,new ri(on(tn(n.path)),r,"TargetPurposeLimboResolution",fe.ae))}}async function Oo(e,t,n){const r=R(e),i=[],s=[],o=[];r.ka.isEmpty()||(r.ka.forEach(((e,a)=>{o.push(r.Ha(a,t,n).then((e=>{var t;if((e||n)&&r.isPrimaryClient){const i=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=Di.Yi(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.La.p_(i),await async function(e,t){const n=R(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>he.forEach(t,(t=>he.forEach(t.Hi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>he.forEach(t.Ji,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!de(e))throw e;C(Ui,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Ts.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.Ts=n.Ts.insert(t,i)}}}(r.localStore,s))}async function Lo(e,t){const n=R(e);if(!n.currentUser.isEqual(t)){C(uo,"User change. New user:",t.toKey());const e=await ji(n.localStore,t);n.currentUser=t,function(e){e.Ga.forEach((e=>{e.forEach((e=>{e.reject(new P(D.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ga.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Oo(n,e.Rs)}}function Ro(e,t){const n=R(e),r=n.Ka.get(t);if(r&&r.Ba)return kn().add(r.key);{let e=kn();const r=n.qa.get(t);if(!r)return e;for(const t of r){const r=n.ka.get(t);e=e.unionWith(r.view.ba)}return e}}function Do(e){const t=R(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=wo.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ro.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Eo.bind(null,t),t.La.p_=eo.bind(null,t.eventManager),t.La.Ja=to.bind(null,t.eventManager),t}function Po(e){const t=R(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=_o.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Io.bind(null,t),t}class Mo{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ss(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return function(e,t,n,r){return new Vi(e,t,n,r)}(this.persistence,new Mi,e.initialUser,this.serializer)}Xa(e){return new xi(Li.ri,this.serializer)}Za(e){return new Ki}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Mo.provider={build:()=>new Mo};class Uo extends Mo{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){L(this.persistence.referenceDelegate instanceof Ri);const n=this.persistence.referenceDelegate.garbageCollector;return new gi(n,e.asyncQueue,t)}Xa(e){const t=void 0!==this.cacheSizeBytes?hi.withCacheSize(this.cacheSizeBytes):hi.DEFAULT;return new xi((e=>Ri.ri(e,t)),this.serializer)}}class Fo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>bo(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Lo.bind(null,this.syncEngine),await async function(e,t){const n=R(e);t?(n.W_.delete(2),await gs(n)):t||(n.W_.add(2),await ys(n),n.j_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Js}createDatastore(e){const t=ss(e.databaseInfo.databaseId),n=function(e){return new rs(e)}(e.databaseInfo);return function(e,t,n,r){return new ds(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,i){return new ms(e,t,n,r,i)}(this.localStore,this.datastore,e.asyncQueue,(e=>bo(this.syncEngine,e,0)),Qi.D()?new Qi:new Hi)}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new fo(e,t,n,r,i,s);return o&&(a.ja=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=R(e);C(ps,"RemoteStore shutting down."),t.W_.add(5),await ys(t),t.z_.shutdown(),t.j_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Fo.provider={build:()=>new Fo};class Vo{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):A("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const jo="FirestoreClient";class Bo{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=I.UNAUTHENTICATED,this.clientId=K.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,(async e=>{C(jo,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(C(jo,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new M;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Gs(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function zo(e,t){e.asyncQueue.verifyOperationInProgress(),C(jo,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await ji(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function qo(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){C(jo,"Using user provided OfflineComponentProvider");try{await zo(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===D.FAILED_PRECONDITION||e.code===D.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;N("Error using user provided cache. Falling back to memory cache: "+n),await zo(e,new Mo)}}else C(jo,"Using default OfflineComponentProvider"),await zo(e,new Uo(void 0));return e._offlineComponents}(e);C(jo,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Bs(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Bs(t.remoteStore,n))),e._onlineComponents=t}async function $o(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(C(jo,"Using user provided OnlineComponentProvider"),await qo(e,e._uninitializedComponentsProvider._online)):(C(jo,"Using default OnlineComponentProvider"),await qo(e,new Fo))),e._onlineComponents}async function Go(e){const t=await $o(e),n=t.eventManager;return n.onListen=po.bind(null,t.syncEngine),n.onUnlisten=yo.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=mo.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=vo.bind(null,t.syncEngine),n}function Ko(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Ho=new Map;function Wo(e,t,n){if(!n)throw new P(D.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Qo(e){if(!ie.isDocumentKey(e))throw new P(D.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Jo(e){if(ie.isDocumentKey(e))throw new P(D.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Yo(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":O()}function Xo(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new P(D.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yo(e);throw new P(D.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}const Zo="firestore.googleapis.com",ea=!0;class ta{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new P(D.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Zo,this.ssl=ea}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:ea;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=li;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new P(D.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new P(D.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ko(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new P(D.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new P(D.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new P(D.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class na{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ta({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new P(D.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new P(D.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ta(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new F;switch(e.type){case"firstParty":return new z(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new P(D.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Ho.get(e);t&&(C("ComponentProvider","Removing Datastore"),Ho.delete(e),t.terminate())}(this),Promise.resolve()}}class ra{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new ra(this.firestore,e,this._query)}}class ia{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new sa(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ia(this.firestore,e,this._key)}}class sa extends ra{constructor(e,t,n){super(e,t,tn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ia(this.firestore,null,new ie(e))}withConverter(e){return new sa(this.firestore,e,this._path)}}function oa(e,t,...n){if(e=(0,c.Ku)(e),Wo("collection","path",t),e instanceof na){const r=te.fromString(t,...n);return Jo(r),new sa(e,null,r)}{if(!(e instanceof ia||e instanceof sa))throw new P(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(te.fromString(t,...n));return Jo(r),new sa(e.firestore,null,r)}}function aa(e,t,...n){if(e=(0,c.Ku)(e),1===arguments.length&&(t=K.newId()),Wo("doc","path",t),e instanceof na){const r=te.fromString(t,...n);return Qo(r),new ia(e,null,new ie(r))}{if(!(e instanceof ia||e instanceof sa))throw new P(D.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(te.fromString(t,...n));return Qo(r),new ia(e.firestore,e instanceof sa?e.converter:null,new ie(r))}}const ca="AsyncQueue";class ua{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new os(this,"async_queue_retry"),this.bu=()=>{const e=is();e&&C(ca,"Visibility state changed to "+e.visibilityState),this.a_.t_()},this.Su=e;const t=is();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bu)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=is();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.bu)}}enqueue(e){if(this.Du(),this.mu)return new Promise((()=>{}));const t=new M;return this.vu((()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Vu.push(e),this.Cu())))}async Cu(){if(0!==this.Vu.length){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!de(e))throw e;C(ca,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo((()=>this.Cu()))}}vu(e){const t=this.Su.then((()=>(this.pu=!0,e().catch((e=>{this.gu=e,this.pu=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw A("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.pu=!1,e))))));return this.Su=t,t}enqueueAfterDelay(e,t,n){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const r=$s.createAndSchedule(this,e,t,n,(e=>this.Fu(e)));return this.fu.push(r),r}Du(){this.gu&&O()}verifyOperationInProgress(){}async Mu(){let e;do{e=this.Su,await e}while(e!==this.Su)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then((()=>{this.fu.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.fu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Mu()}))}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}class la extends na{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ua,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new ua(e),this._firestoreClient=void 0,await e}}}function ha(e,t){const n="object"==typeof e?e:(0,s.Sx)(),r="string"==typeof e?e:t||et,i=(0,s.j6)(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const e=(0,c.yU)("firestore");e&&function(e,t,n,r={}){var i;const s=(e=Xo(e,na))._getSettings(),o=Object.assign(Object.assign({},s),{emulatorOptions:e._getEmulatorOptions()}),a=`${t}:${n}`;s.host!==Zo&&s.host!==a&&N("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},s),{host:a,ssl:!1,emulatorOptions:r});if(!(0,c.bD)(u,o)&&(e._setSettings(u),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=I.MOCK_USER;else{t=(0,c.Fy)(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new P(D.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new I(s)}e._authCredentials=new V(new U(t,n))}}(i,...e)}return i}function da(e){if(e._terminated)throw new P(D.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;const i=e._freezeSettings(),s=function(e,t,n,r){return new Ze(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Ko(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Bo(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class fa{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fa(Be.fromBase64String(e))}catch(e){throw new P(D.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new fa(Be.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pa{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new P(D.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ma{constructor(e){this._methodName=e}}class ga{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new P(D.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new P(D.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return H(this._lat,e._lat)||H(this._long,e._long)}}class ya{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}const va=/^__.*__$/;class wa{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new er(e,this.data,this.fieldMask,t,this.fieldTransforms):new Zn(e,this.data,t,this.fieldTransforms)}}class ba{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new er(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ea(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw O()}}class _a{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Bu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new _a(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.$u(e),r}Ku(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ku({path:n,Qu:!1});return r.Bu(),r}Uu(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return Pa(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(0===e.length)throw this.Wu("Document fields must not be empty");if(Ea(this.Lu)&&va.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class Ia{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ss(e)}ju(e,t,n,r=!1){return new _a({Lu:e,methodName:t,zu:n,path:re.emptyPath(),Qu:!1,Gu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ta(e){const t=e._freezeSettings(),n=ss(e._databaseId);return new Ia(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Sa(e,t,n,r,i,s={}){const o=e.ju(s.merge||s.mergeFields?2:0,t,n,i);Oa("Data must be an object, but it was:",o,r);const a=Na(r,o);let c,u;if(s.merge)c=new Ve(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=La(t,r,n);if(!o.contains(i))throw new P(D.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Ma(e,i)||e.push(i)}c=new Ve(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new wa(new St(a),c,u)}class ka extends ma{_toFieldTransform(e){if(2!==e.Lu)throw 1===e.Lu?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ka}}class Ca extends ma{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){const t=function(e,t,n){return new _a({Lu:3,zu:t.settings.zu,methodName:e._methodName,Qu:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}(this,e,!0),n=this.Hu.map((e=>Aa(e,t))),r=new Mn(n);return new qn(e.path,r)}isEqual(e){return e instanceof Ca&&(0,c.bD)(this.Hu,e.Hu)}}function Aa(e,t){if(xa(e=(0,c.Ku)(e)))return Oa("Unsupported field value:",t,e),Na(e,t);if(e instanceof ma)return function(e,t){if(!Ea(t.Lu))throw t.Wu(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Wu(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Qu&&4!==t.Lu)throw t.Wu("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=Aa(i,t.Uu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,c.Ku)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return xn(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Y.fromDate(e);return{timestampValue:Lr(t.serializer,n)}}if(e instanceof Y){const n=new Y(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Lr(t.serializer,n)}}if(e instanceof ga)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof fa)return{bytesValue:Rr(t.serializer,e._byteString)};if(e instanceof ia){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Wu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Mr(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof ya)return function(e,t){return{mapValue:{fields:{[nt]:{stringValue:st},[ot]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.Wu("VectorValues must only contain numeric values.");return An(t.serializer,e)}))}}}}}}(e,t);throw t.Wu(`Unsupported field value: ${Yo(e)}`)}(e,t)}function Na(e,t){const n={};return Re(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Le(e,((e,r)=>{const i=Aa(r,t.qu(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function xa(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Y||e instanceof ga||e instanceof fa||e instanceof ia||e instanceof ma||e instanceof ya)}function Oa(e,t,n){if(!xa(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Yo(n);throw"an object"===r?t.Wu(e+" a custom object"):t.Wu(e+" "+r)}}function La(e,t,n){if((t=(0,c.Ku)(t))instanceof pa)return t._internalPath;if("string"==typeof t)return Da(e,t);throw Pa("Field path arguments must be of type string or ",e,!1,void 0,n)}const Ra=new RegExp("[~\\*/\\[\\]]");function Da(e,t,n){if(t.search(Ra)>=0)throw Pa(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new pa(...t.split("."))._internalPath}catch(r){throw Pa(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Pa(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new P(D.INVALID_ARGUMENT,a+e+c)}function Ma(e,t){return e.some((e=>e.isEqual(t)))}class Ua{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ia(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Fa(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Va("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Fa extends Ua{data(){return super.data()}}function Va(e,t){return"string"==typeof t?Da(e,t):t instanceof pa?t._internalPath:t._delegate._internalPath}class ja{}class Ba extends ja{}function za(e,t,...n){let r=[];t instanceof ja&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof Ga)).length,n=e.filter((e=>e instanceof qa)).length;if(t>1||t>0&&n>0)throw new P(D.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}class qa extends Ba{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new qa(e,t,n)}_apply(e){const t=this._parse(e);return Wa(e._query,t),new ra(e.firestore,e.converter,an(e._query,t))}_parse(e){const t=Ta(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new P(D.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Ha(o,s);const t=[];for(const n of o)t.push(Ka(r,e,n));a={arrayValue:{values:t}}}else a=Ka(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Ha(o,s),a=function(e,t,n,r=!1){return Aa(n,e.ju(r?4:3,t))}(n,"where",o,"in"===s||"not-in"===s);return Dt.create(i,s,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function $a(e,t,n){const r=t,i=Va("where",e);return qa._create(i,r,n)}class Ga extends ja{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ga(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Pt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)Wa(n,e),n=an(n,e)}(e._query,t),new ra(e.firestore,e.converter,an(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Ka(e,t,n){if("string"==typeof(n=(0,c.Ku)(n))){if(""===n)throw new P(D.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!rn(t)&&-1!==n.indexOf("/"))throw new P(D.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(te.fromString(n));if(!ie.isDocumentKey(r))throw new P(D.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return gt(e,new ie(r))}if(n instanceof ia)return gt(e,n._key);throw new P(D.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yo(n)}.`)}function Ha(e,t){if(!Array.isArray(e)||0===e.length)throw new P(D.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Wa(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new P(D.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new P(D.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class Qa{convertValue(e,t="none"){switch(at(e)){case 0:return null;case 1:return e.booleanValue;case 2:return $e(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ge(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw O()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Le(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertVectorValue(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.fields)||void 0===t?void 0:t[ot].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map((e=>$e(e.doubleValue)));return new ya(i)}convertGeoPoint(e){return new ga($e(e.latitude),$e(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Ye(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Xe(e));default:return null}}convertTimestamp(e){const t=qe(e);return new Y(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=te.fromString(e);L(ni(n));const r=new tt(n.get(1),n.get(3)),i=new ie(n.popFirst(5));return r.isEqual(t)||A(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}class Ja{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ya extends Ua{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Xa(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Va("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class Xa extends Ya{data(e={}){return super.data(e)}}class Za{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Ja(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new Xa(this._firestore,this._userDataWriter,n.key,n,new Ja(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(D.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new Xa(e._firestore,e._userDataWriter,n.doc.key,n.doc,new Ja(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new Xa(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Ja(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:ec(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function ec(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return O()}}function tc(e){e=Xo(e,ia);const t=Xo(e.firestore,la);return function(e,t,n={}){const r=new M;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Vo({next:a=>{s.su(),t.enqueueAndForget((()=>Zs(e,o)));const c=a.docs.has(n);!c&&a.fromCache?i.reject(new P(D.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?i.reject(new P(D.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new so(tn(n.path),s,{includeMetadataChanges:!0,Ta:!0});return Xs(e,o)}(await Go(e),e.asyncQueue,t,n,r))),r.promise}(da(t),e._key).then((n=>function(e,t,n){const r=n.docs.get(t._key),i=new nc(e);return new Ya(e,i,t._key,r,new Ja(n.hasPendingWrites,n.fromCache),t.converter)}(t,e,n)))}class nc extends Qa{constructor(e){super(),this.firestore=e}convertBytes(e){return new fa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ia(this.firestore,null,t)}}function rc(e){e=Xo(e,ra);const t=Xo(e.firestore,la),n=da(t),r=new nc(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new P(D.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,t,n={}){const r=new M;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Vo({next:n=>{s.su(),t.enqueueAndForget((()=>Zs(e,o))),n.fromCache&&"server"===r.source?i.reject(new P(D.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new so(n,s,{includeMetadataChanges:!0,Ta:!0});return Xs(e,o)}(await Go(e),e.asyncQueue,t,n,r))),r.promise}(n,e._query).then((n=>new Za(t,r,e,n)))}function ic(e,t,n){e=Xo(e,ia);const r=Xo(e.firestore,la),i=function(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}(e.converter,t,n);return ac(r,[Sa(Ta(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Gn.none())])}function sc(e,t,n,...r){e=Xo(e,ia);const i=Xo(e.firestore,la),s=Ta(i);let o;return o="string"==typeof(t=(0,c.Ku)(t))||t instanceof pa?function(e,t,n,r,i,s){const o=e.ju(1,t,n),a=[La(t,r,n)],u=[i];if(s.length%2!=0)throw new P(D.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(La(t,s[e])),u.push(s[e+1]);const l=[],h=St.empty();for(let e=a.length-1;e>=0;--e)if(!Ma(l,a[e])){const t=a[e];let n=u[e];n=(0,c.Ku)(n);const r=o.Ku(t);if(n instanceof ka)l.push(t);else{const e=Aa(n,r);null!=e&&(l.push(t),h.set(t,e))}}const d=new Ve(l);return new ba(h,d,o.fieldTransforms)}(s,"updateDoc",e._key,t,n,r):function(e,t,n,r){const i=e.ju(1,t,n);Oa("Data must be an object, but it was:",i,r);const s=[],o=St.empty();Le(r,((e,r)=>{const a=Da(t,e,n);r=(0,c.Ku)(r);const u=i.Ku(a);if(r instanceof ka)s.push(a);else{const e=Aa(r,u);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Ve(s);return new ba(o,a,i.fieldTransforms)}(s,"updateDoc",e._key,t),ac(i,[o.toMutation(e._key,Gn.exists(!0))])}function oc(e){return ac(Xo(e.firestore,la),[new ir(e._key,Gn.none())])}function ac(e,t){return function(e,t){const n=new M;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=Po(e);try{const e=await function(e,t){const n=R(e),r=Y.now(),i=t.reduce(((e,t)=>e.add(t.key)),kn());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=yn(),c=kn();return n.ds.getEntries(e,i).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((i=>{s=i;const o=[];for(const e of t){const t=Yn(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new er(e.key,t,kt(t.value.mapValue),Gn.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:bn(s)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Wa[e.currentUser.toKey()];r||(r=new De(H)),r=r.insert(t,n),e.Wa[e.currentUser.toKey()]=r}(r,e.batchId,n),await Oo(r,e.changes),await Ls(r.remoteStore)}catch(e){const t=Gs(e,"Failed to persist write");n.reject(t)}}(await function(e){return $o(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(da(e),t)}function cc(...e){return new Ca("arrayUnion",e)}new WeakMap,function(e,t=!0){!function(e){T=e}(s.MF),(0,s.om)(new o.uA("firestore",((e,{instanceIdentifier:n,options:r})=>{const i=e.getProvider("app").getImmediate(),s=new la(new j(e.getProvider("auth-internal")),new $(i,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new P(D.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tt(e.options.projectId,t)}(i,n),i);return r=Object.assign({useFetchStreams:t},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),(0,s.KO)(E,_,e),(0,s.KO)(E,_,"esm2017")}()},632:(e,t,n)=>{n.r(t),n.d(t,{analytics:()=>Ie,auth:()=>_e,db:()=>Te,isUsernameAvailable:()=>Se,reserveUsername:()=>Ce,updateUsername:()=>Ne});var r=n(223),i=n(43),s=n(461),o=n(424),a=n(126),c=n(125),u=n(148);const l="@firebase/installations",h="0.6.13",d=`w:${h}`,f="FIS_v2",p=new a.FA("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function m(e){return e instanceof a.g&&e.code.includes("request-failed")}function g({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function y(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function v(e,t){const n=(await t.json()).error;return p.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function w({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function b(e){const t=await e();return t.status>=500&&t.status<600?e():t}function E(e){return new Promise((t=>{setTimeout(t,e)}))}const _=/^[cdef][\w-]{21}$/;function I(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return _.test(t)?t:""}catch(e){return""}}function T(e){return`${e.appName}!${e.appId}`}const S=new Map;function k(e,t){const n=T(e);C(n,t),function(e,t){const n=(!A&&"BroadcastChannel"in self&&(A=new BroadcastChannel("[Firebase] FID Change"),A.onmessage=e=>{C(e.data.key,e.data.fid)}),A);n&&n.postMessage({key:e,fid:t}),0===S.size&&A&&(A.close(),A=null)}(n,t)}function C(e,t){const n=S.get(e);if(n)for(const e of n)e(t)}let A=null;const N="firebase-installations-store";let x=null;function O(){return x||(x=(0,u.P2)("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(N)}})),x}async function L(e,t){const n=T(e),r=(await O()).transaction(N,"readwrite"),i=r.objectStore(N),s=await i.get(n);return await i.put(t,n),await r.done,s&&s.fid===t.fid||k(e,t.fid),t}async function R(e){const t=T(e),n=(await O()).transaction(N,"readwrite");await n.objectStore(N).delete(t),await n.done}async function D(e,t){const n=T(e),r=(await O()).transaction(N,"readwrite"),i=r.objectStore(N),s=await i.get(n),o=t(s);return void 0===o?await i.delete(n):await i.put(o,n),await r.done,!o||s&&s.fid===o.fid||k(e,o.fid),o}async function P(e){let t;const n=await D(e.appConfig,(n=>{const r=function(e){return F(e||{fid:I(),registrationStatus:0})}(n),i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(p.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const r=g(e),i=w(e),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={fid:n,authVersion:f,appId:e.appId,sdkVersion:d},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await b((()=>fetch(r,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:y(e.authToken)}}throw await v("Create Installation",c)}(e,t);return L(e.appConfig,n)}catch(n){throw m(n)&&409===n.customData.serverCode?await R(e.appConfig):await L(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:M(e)}:{installationEntry:t}}(e,r);return t=i.registrationPromise,i.installationEntry}));return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function M(e){let t=await U(e.appConfig);for(;1===t.registrationStatus;)await E(100),t=await U(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await P(e);return n||t}return t}function U(e){return D(e,(e=>{if(!e)throw p.create("installation-not-found");return F(e)}))}function F(e){return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function V({appConfig:e,heartbeatServiceProvider:t},n){const r=function(e,{fid:t}){return`${g(e)}/${t}/authTokens:generate`}(e,n),i=function(e,{refreshToken:t}){const n=w(e);return n.append("Authorization",function(e){return`${f} ${e}`}(t)),n}(e,n),s=t.getImmediate({optional:!0});if(s){const e=await s.getHeartbeatsHeader();e&&i.append("x-firebase-client",e)}const o={installation:{sdkVersion:d,appId:e.appId}},a={method:"POST",headers:i,body:JSON.stringify(o)},c=await b((()=>fetch(r,a)));if(c.ok)return y(await c.json());throw await v("Generate Auth Token",c)}async function j(e,t=!1){let n;const r=await D(e.appConfig,(r=>{if(!z(r))throw p.create("not-registered");const i=r.authToken;if(!t&&(2===(s=i).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(s)))return r;var s;if(1===i.requestStatus)return n=async function(e,t){let n=await B(e.appConfig);for(;1===n.authToken.requestStatus;)await E(100),n=await B(e.appConfig);const r=n.authToken;return 0===r.requestStatus?j(e,t):r}(e,t),r;{if(!navigator.onLine)throw p.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(r);return n=async function(e,t){try{const n=await V(e,t),r=Object.assign(Object.assign({},t),{authToken:n});return await L(e.appConfig,r),n}catch(n){if(!m(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await L(e.appConfig,n)}else await R(e.appConfig);throw n}}(e,t),t}}));return n?await n:r.authToken}function B(e){return D(e,(e=>{if(!z(e))throw p.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function z(e){return void 0!==e&&2===e.registrationStatus}function q(e){return p.create("missing-app-config-values",{valueName:e})}const $="installations";(0,s.om)(new c.uA($,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw q("App Configuration");if(!e.name)throw q("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw q(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:(0,s.j6)(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),(0,s.om)(new c.uA("installations-internal",(e=>{const t=e.getProvider("app").getImmediate(),n=(0,s.j6)(t,$).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:r}=await P(t);return r?r.catch(console.error):j(t).catch(console.error),n.fid}(n),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await P(e);t&&await t}(n),(await j(n,t)).token}(n,e)}}),"PRIVATE")),(0,s.KO)(l,h),(0,s.KO)(l,h,"esm2017");const G="analytics",K="https://www.googletagmanager.com/gtag/js",H=new o.Vy("@firebase/analytics"),W=new a.FA("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Q(e){if(!e.startsWith(K)){const t=W.create("invalid-gtag-resource",{gtagURL:e});return H.warn(t.message),""}return e}function J(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Y=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function X(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Z(e,t=Y,n){const{appId:r,apiKey:i,measurementId:s}=e.options;if(!r)throw W.create("no-app-id");if(!i){if(s)return{measurementId:s,appId:r};throw W.create("no-api-key")}const o=t.getThrottleMetadata(r)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new te;return setTimeout((async()=>{a.abort()}),void 0!==n?n:6e4),ee({appId:r,apiKey:i,measurementId:s},o,a,t)}async function ee(e,{throttleEndTimeMillis:t,backoffCount:n},r,i=Y){var s;const{appId:o,measurementId:c}=e;try{await function(e,t){return new Promise(((n,r)=>{const i=Math.max(t-Date.now(),0),s=setTimeout(n,i);e.addEventListener((()=>{clearTimeout(s),r(W.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(r,t)}catch(e){if(c)return H.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:c};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:r}=e,i={method:"GET",headers:X(r)},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,i);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw W.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return i.deleteThrottleMetadata(o),t}catch(t){const u=t;if(!function(e){if(!(e instanceof a.g&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(u)){if(i.deleteThrottleMetadata(o),c)return H.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==u?void 0:u.message}]`),{appId:o,measurementId:c};throw t}const l=503===Number(null===(s=null==u?void 0:u.customData)||void 0===s?void 0:s.httpStatus)?(0,a.p9)(n,i.intervalMillis,30):(0,a.p9)(n,i.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return i.setThrottleMetadata(o,h),H.debug(`Calling attemptFetch again in ${l} millis`),ee(e,h,r,i)}}class te{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let ne,re;async function ie(e,t,n,r,i,s,o){var c;const u=Z(e);u.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&H.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>H.error(e))),t.push(u);const l=async function(){if(!(0,a.zW)())return H.warn(W.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await(0,a.eX)()}catch(e){return H.warn(W.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?r.getId():void 0)),[h,d]=await Promise.all([u,l]);(function(e){const t=window.document.getElementsByTagName("script");for(const n of Object.values(t))if(n.src&&n.src.includes(K)&&n.src.includes(e))return n;return null})(s)||function(e,t){const n=function(e,t){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",t)),n}(0,{createScriptURL:Q}),r=document.createElement("script"),i=`${K}?l=${e}&id=${t}`;r.src=n?null==n?void 0:n.createScriptURL(i):i,r.async=!0,document.head.appendChild(r)}(s,h.measurementId),re&&(i("consent","default",re),re=void 0),i("js",new Date);const f=null!==(c=null==o?void 0:o.config)&&void 0!==c?c:{};return f.origin="firebase",f.update=!0,null!=d&&(f.firebase_id=d),i("config",h.measurementId,f),ne&&(i("set",ne),ne=void 0),h.measurementId}class se{constructor(e){this.app=e}_delete(){return delete oe[this.app.options.appId],Promise.resolve()}}let oe={},ae=[];const ce={};let ue,le,he="dataLayer",de=!1;function fe(e,t,n){!function(){const e=[];if((0,a.sr)()&&e.push("This is a browser extension environment."),(0,a.dM)()||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=W.create("invalid-analytics-context",{errorInfo:t});H.warn(n.message)}}();const r=e.options.appId;if(!r)throw W.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw W.create("no-api-key");H.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=oe[r])throw W.create("already-exists",{id:r});if(!de){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(he);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,r,i){let s=function(...e){window[r].push(arguments)};return window[i]&&"function"==typeof window[i]&&(s=window[i]),window[i]=function(e,t,n,r){return async function(i,...s){try{if("event"===i){const[r,i]=s;await async function(e,t,n,r,i){try{let s=[];if(i&&i.send_to){let e=i.send_to;Array.isArray(e)||(e=[e]);const r=await J(n);for(const n of e){const e=r.find((e=>e.measurementId===n)),i=e&&t[e.appId];if(!i){s=[];break}s.push(i)}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",r,i||{})}catch(e){H.error(e)}}(e,t,n,r,i)}else if("config"===i){const[i,o]=s;await async function(e,t,n,r,i,s){const o=r[i];try{if(o)await t[o];else{const e=(await J(n)).find((e=>e.measurementId===i));e&&await t[e.appId]}}catch(e){H.error(e)}e("config",i,s)}(e,t,n,r,i,o)}else if("consent"===i){const[t,n]=s;e("consent",t,n)}else if("get"===i){const[t,n,r]=s;e("get",t,n,r)}else if("set"===i){const[t]=s;e("set",t)}else e(i,...s)}catch(e){H.error(e)}}}(s,e,t,n),{gtagCore:s,wrappedGtag:window[i]}}(oe,ae,ce,he,"gtag");le=e,ue=t,de=!0}return oe[r]=ie(e,ae,ce,t,ue,he,n),new se(e)}const pe="@firebase/analytics",me="0.10.12";(0,s.om)(new c.uA(G,((e,{options:t})=>fe(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),(0,s.om)(new c.uA("analytics-internal",(function(e){try{const t=e.getProvider(G).getImmediate();return{logEvent:(e,n,r)=>function(e,t,n,r){e=(0,a.Ku)(e),async function(e,t,n,r,i){if(i&&i.global)e("event",n,r);else{const i=await t;e("event",n,Object.assign(Object.assign({},r),{send_to:i}))}}(le,oe[e.app.options.appId],t,n,r).catch((e=>H.error(e)))}(t,e,n,r)}}catch(e){throw W.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),(0,s.KO)(pe,me),(0,s.KO)(pe,me,"esm2017");var ge=n(594);function ye(e){return ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(e)}function ve(){ve=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var s=t&&t.prototype instanceof y?t:y,o=Object.create(s.prototype),a=new x(r||[]);return i(o,"_invoke",{value:k(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function v(){}function w(){}var b={};u(b,o,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(O([])));_&&_!==n&&r.call(_,o)&&(b=_);var I=w.prototype=y.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,s,o,a){var c=h(e[i],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==ye(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function k(t,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===m){if("throw"===s)throw o;return{value:e,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=C(a,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?m:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=m,r.method="throw",r.arg=u.arg)}}}function C(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,g;var o=s.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(ye(t)+" is not iterable")}return v.prototype=w,i(I,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},T(S.prototype),u(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new S(l(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(I),u(I,c,"Generator"),u(I,o,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function we(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function be(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){we(s,r,i,o,a,"next",e)}function a(e){we(s,r,i,o,a,"throw",e)}o(void 0)}))}}var Ee=(0,r.Wp)({apiKey:"AIzaSyCp5Rt67nkZ_DECiyyim3QuBC-Zgq6y1Dw",authDomain:"cabincrew-game.firebaseapp.com",projectId:"cabincrew-game",storageBucket:"cabincrew-game.firebasestorage.app",messagingSenderId:"525011831374",appId:"1:525011831374:web:ace85fdd1963f62485911f",measurementId:"G-6YSD9F2ZHQ"}),_e=(0,i.xI)(Ee),Ie=null;try{Ie=function(e=(0,s.Sx)()){e=(0,a.Ku)(e);const t=(0,s.j6)(e,G);return t.isInitialized()?t.getImmediate():function(e,t={}){const n=(0,s.j6)(e,G);if(n.isInitialized()){const e=n.getImmediate();if((0,a.bD)(t,n.getOptions()))return e;throw W.create("already-initialized")}return n.initialize({options:t})}(e)}(Ee)}catch(e){console.warn("Analytics non supportato in questo ambiente:",e)}var Te=(0,ge.aU)(Ee);function Se(e){return ke.apply(this,arguments)}function ke(){return(ke=be(ve().mark((function e(t){var n,r,i;return ve().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,ge.rJ)(Te,"usernames"),r=(0,ge.P)(n,(0,ge._M)("username","==",t)),e.next=5,(0,ge.GG)(r);case 5:return i=e.sent,e.abrupt("return",i.empty);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Errore nel verificare l'username:",e.t0),e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function Ce(e,t){return Ae.apply(this,arguments)}function Ae(){return(Ae=be(ve().mark((function e(t,n){return ve().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,ge.BN)((0,ge.H9)(Te,"usernames",n),{userId:t,username:n,createdAt:new Date});case 3:return e.next=5,(0,ge.BN)((0,ge.H9)(Te,"users",t),{username:n,updatedAt:new Date},{merge:!0});case 5:return e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),console.error("Errore nel salvare l'username:",e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function Ne(e,t,n){return xe.apply(this,arguments)}function xe(){return(xe=be(ve().mark((function e(t,n,r){return ve().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Se(r);case 3:if(e.sent){e.next=6;break}return e.abrupt("return",{success:!1,error:"Username gi in uso da un altro utente"});case 6:if(!n){e.next=15;break}return e.prev=7,e.next=10,(0,ge.kd)((0,ge.H9)(Te,"usernames",n));case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.warn("Impossibile eliminare il vecchio username:",e.t0);case 15:return e.next=17,Ce(t,r);case 17:if(e.sent){e.next=20;break}return e.abrupt("return",{success:!1,error:"Errore nel salvare il nuovo username"});case 20:return e.abrupt("return",{success:!0});case 23:return e.prev=23,e.t1=e.catch(0),console.error("Errore nell'aggiornare l'username:",e.t1),e.abrupt("return",{success:!1,error:"Errore di sistema: "+e.t1.message});case 27:case"end":return e.stop()}}),e,null,[[0,23],[7,12]])})))).apply(this,arguments)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function s(e){var t=function(e){if("object"!=r(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==r(t)?t:t+""}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const o=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.musicVolume=.3,this.isMuted=!1,this.autoplay=!0,this.menuMusic=new Audio,this.menuMusic.src="/asset/audio/ripples in the sand.mp3",this.menuMusic.loop=!0,this.menuMusic.volume=this.musicVolume,this.gamePlaylist=["/asset/audio/time.mp3","/asset/audio/cornfield chase.mp3","/asset/audio/stay.mp3","/asset/audio/No Time For Caution.mp3","/asset/audio/coward.mp3"],this.currentGameTrack=null,this._initAudio(),window.audioManager=this},t=[{key:"_initAudio",value:function(){var e=this;document.addEventListener("click",(function(){e.autoplay&&!e.isMuted&&(e.playMenuMusic(),e.autoplay=!1)}),{once:!0}),console.log("AudioManager inizializzato")}},{key:"playMenuMusic",value:function(){var e=this;this.isMuted||(console.log("Tentativo di riproduzione musica menu..."),this.stopGameMusic(),this.menuMusic.play().then((function(){return console.log("Musica menu avviata con successo")})).catch((function(t){console.error("Errore riproduzione musica menu:",t),document.addEventListener("click",(function(){e.menuMusic.play().catch((function(e){return console.warn("Nuovo tentativo fallito:",e)}))}),{once:!0})})))}},{key:"stopMenuMusic",value:function(){this.menuMusic.pause(),this.menuMusic.currentTime=0}},{key:"playRandomGameMusic",value:function(){var e=this;if(!this.isMuted){console.log("Tentativo di riproduzione musica gioco..."),this.stopMenuMusic(),this.stopGameMusic();var t=Math.floor(Math.random()*this.gamePlaylist.length),n=this.gamePlaylist[t];console.log("Traccia selezionata:",n),this.currentGameTrack=new Audio(n),this.currentGameTrack.volume=this.musicVolume,this.currentGameTrack.play().then((function(){return console.log("Musica gioco avviata con successo")})).catch((function(t){console.error("Errore riproduzione musica gioco:",t),document.addEventListener("click",(function(){e.currentGameTrack&&e.currentGameTrack.play().catch((function(e){return console.warn("Nuovo tentativo fallito:",e)}))}),{once:!0})}))}}},{key:"stopGameMusic",value:function(){this.currentGameTrack&&(this.currentGameTrack.pause(),this.currentGameTrack.currentTime=0,this.currentGameTrack=null)}},{key:"toggleMute",value:function(){return this.isMuted=!this.isMuted,this.isMuted?(this.stopMenuMusic(),this.stopGameMusic(),console.log("Audio disattivato")):(document.getElementById("game-room-screen")&&!document.getElementById("game-room-screen").classList.contains("hidden")?this.playRandomGameMusic():this.playMenuMusic(),console.log("Audio riattivato")),this.isMuted}},{key:"setMusicVolume",value:function(e){e<0&&(e=0),e>1&&(e=1),this.musicVolume=e,this.menuMusic.volume=e,this.currentGameTrack&&(this.currentGameTrack.volume=e),console.log("Volume impostato a:",e)}},{key:"testAudio",value:function(){var e=this;console.log("Test audio avviato");var t=document.createElement("div");t.style.position="fixed",t.style.bottom="20px",t.style.right="20px",t.style.background="rgba(0,0,0,0.8)",t.style.color="white",t.style.padding="10px",t.style.borderRadius="5px",t.style.zIndex="9999",t.innerHTML='\n      <div>Test Audio</div>\n      <button id="test-menu">Play Menu Music</button>\n      <button id="test-game">Play Game Music</button>\n      <button id="test-stop">Stop All</button>\n      <div id="test-status">Stato: in attesa</div>\n    ',document.body.appendChild(t),document.getElementById("test-menu").addEventListener("click",(function(){e.playMenuMusic(),document.getElementById("test-status").textContent="Stato: menu music"})),document.getElementById("test-game").addEventListener("click",(function(){e.playRandomGameMusic(),document.getElementById("test-status").textContent="Stato: game music"})),document.getElementById("test-stop").addEventListener("click",(function(){e.stopMenuMusic(),e.stopGameMusic(),document.getElementById("test-status").textContent="Stato: audio fermato"})),setTimeout((function(){document.body.removeChild(t)}),3e4)}}],t&&i(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e,t,n){return(t=h(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function h(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}function d(){var e=document.getElementById("resurrection-bonus"),t=document.getElementById("double-multiplier-bonus"),n=document.getElementById("shield-bonus");e&&e.classList.add("hidden"),t&&t.classList.add("hidden"),n&&n.classList.add("hidden"),document.querySelectorAll(".screen").forEach((function(e){new MutationObserver((function(t){t.forEach((function(t){if("class"===t.attributeName){var n=e.classList.contains("hidden");!function(e,t){if(!t)switch(e){case"auth-screen":case"lobby-screen":case"profile-screen":o.playMenuMusic()}}(e.id,n)}}))})).observe(e,{attributes:!0})}));var r=document.getElementById("countdown-timer");r&&new MutationObserver((function(){if(!r.classList.contains("hidden")){var e=document.getElementById("game-room-screen");e&&!e.classList.contains("hidden")&&o.playRandomGameMusic()}})).observe(r,{attributes:!0})}new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.bonusTypes={resurrection:{name:"Resurrection",description:"Salva automaticamente il giocatore aggiungendo 0.10 crediti quando il saldo scende sotto 0.10",icon:""},doubleMultiplier:{name:"x2 Boost",description:"Raddoppia il moltiplicatore ottenuto in un round",icon:"2"},shield:{name:"Scudo",description:"Protegge dalla perdita dei crediti in caso di crash per un round",icon:""}},this.bonusChance=30},t=[{key:"shouldAwardBonus",value:function(){return 100*Math.random()<=this.bonusChance}},{key:"getRandomBonus",value:function(){var e=Object.keys(this.bonusTypes),t=e[Math.floor(Math.random()*e.length)];return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:t},this.bonusTypes[t])}},{key:"applyBonus",value:function(e,t){switch(e.bonuses||(e.bonuses=[]),t){case"resurrection":e.hasResurrection=!0;break;case"doubleMultiplier":e.hasDoubleMultiplier=!0;break;case"shield":e.hasShield=!0}return!0}},{key:"checkResurrection",value:function(e){return!!(e.hasResurrection&&e.credits<.1&&e.credits>0)&&(e.credits+=.1,e.hasResurrection=!1,!0)}},{key:"calculateWinWithBonus",value:function(e,t,n){var r=n;return e.hasDoubleMultiplier&&(r*=2,e.hasDoubleMultiplier=!1),t*r}},{key:"handleCrash",value:function(e,t){return e.hasShield?(e.hasShield=!1,0):-t}}],t&&l(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}());var f=n(632),p=n(43);function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function g(){g=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var s=t&&t.prototype instanceof w?t:w,o=Object.create(s.prototype),a=new L(r||[]);return i(o,"_invoke",{value:A(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",y="completed",v={};function w(){}function b(){}function E(){}var _={};u(_,o,(function(){return this}));var I=Object.getPrototypeOf,T=I&&I(I(R([])));T&&T!==n&&r.call(T,o)&&(_=T);var S=E.prototype=w.prototype=Object.create(_);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(i,s,o,a){var c=h(e[i],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==m(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function A(t,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===y){if("throw"===s)throw o;return{value:e,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=N(a,r);if(c){if(c===v)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?y:f,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=y,r.method="throw",r.arg=u.arg)}}}function N(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,N(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,v;var o=s.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(m(t)+" is not iterable")}return b.prototype=E,i(S,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:b,configurable:!0}),b.displayName=u(E,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},k(C.prototype),u(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new C(l(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(S),u(S,c,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function y(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){y(s,r,i,o,a,"next",e)}function a(e){y(s,r,i,o,a,"throw",e)}o(void 0)}))}}function w(){document.getElementById("auth-screen").classList.add("hidden"),document.getElementById("lobby-screen").classList.remove("hidden")}var b=null;function E(e,t,n){console.log("handleSuccessfulAuth chiamato con:",e.uid,t),b={uid:e.uid,email:e.email||"anonymous",isAnonymous:e.isAnonymous||!0,username:t},localStorage.setItem("username",t),n.emit("register",{uid:e.uid,username:t}),ke("lobby-screen"),console.log("Lobby mostrata")}function _(){var e=sessionStorage.getItem("user");return e?JSON.parse(e):b}var I=n(594);function T(e){return T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},T(e)}function S(){S=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var s=t&&t.prototype instanceof y?t:y,o=Object.create(s.prototype),a=new L(r||[]);return i(o,"_invoke",{value:A(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function v(){}function w(){}var b={};u(b,o,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(R([])));_&&_!==n&&r.call(_,o)&&(b=_);var I=w.prototype=y.prototype=Object.create(b);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(i,s,o,a){var c=h(e[i],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==T(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function A(t,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===m){if("throw"===s)throw o;return{value:e,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=N(a,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?m:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=m,r.method="throw",r.arg=u.arg)}}}function N(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,N(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,g;var o=s.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function R(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(T(t)+" is not iterable")}return v.prototype=w,i(I,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},k(C.prototype),u(C.prototype,a,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new C(l(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(I),u(I,c,"Generator"),u(I,o,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=R,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function k(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){k(s,r,i,o,a,"next",e)}function a(e){k(s,r,i,o,a,"throw",e)}o(void 0)}))}}function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,N(r.key),r)}}function N(e){var t=function(e){if("object"!=T(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=T(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==T(t)?t:t+""}var x=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.badges={"season1-badge":{id:"season1-badge",name:"Season 1",image:"asset/images/badges/season1-badge.png",description:"Badge della Season 1 (07 Marzo - 15 Aprile 2025)",requirement:"Registrazione durante la Season 1",isDefault:!0},"ryanair-badge":{id:"ryanair-badge",name:"Ryanair",image:"asset/images/badges/ryanair-badge.png",description:"Badge Ryanair",requirement:"Ottieni la prima vittoria"},"easyjet-badge":{id:"easyjet-badge",name:"EasyJet",image:"asset/images/badges/easyjet-badge.png",description:"Badge EasyJet",requirement:"Ottieni 3 vittorie"},"alitalia-badge":{id:"alitalia-badge",name:"Alitalia",image:"asset/images/badges/alitalia-badge.png",description:"Badge Alitalia",requirement:"Ottieni un moltiplicatore uguale a x1,00"},"vueling-badge":{id:"vueling-badge",name:"Vueling",image:"asset/images/badges/vueling-badge.png",description:"Badge Vueling",requirement:"Ottieni 5 vittorie"},"wizz-badge":{id:"wizz-badge",name:"WizzAir",image:"asset/images/badges/wizz-badge.png",description:"Badge WizzAir",requirement:"Ottieni un moltiplicatore maggiore di x4,99"},"lufthansa-badge":{id:"lufthansa-badge",name:"Lufthansa",image:"asset/images/badges/lufthansa-badge.png",description:"Badge Lufthansa",requirement:"Ottieni 10 vittorie"},"klm-badge":{id:"klm-badge",name:"KLM",image:"asset/images/badges/klm-badge.png",description:"Badge KLM",requirement:"Ottieni un moltiplicatore maggiore di x9,99"},"airfrance-badge":{id:"airfrance-badge",name:"AirFrance",image:"asset/images/badges/airfrance-badge.png",description:"Badge AirFrance",requirement:"Ottieni 20 vittorie"},"british-badge":{id:"british-badge",name:"British Airways",image:"asset/images/badges/british-badge.png",description:"Badge British Airways",requirement:"Ottieni 30 vittorie"},"finnair-badge":{id:"finnair-badge",name:"FinnAir",image:"asset/images/badges/finnair-badge.png",description:"Badge FinnAir",requirement:"Partecipa ad almeno 50 partite"}}},t=[{key:"initializeUserBadges",value:(s=C(S().mark((function e(t){var n,r,i;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Inizializzazione badge per utente:",t),n=(0,I.H9)(f.db,"users",t),e.next=5,(0,I.x7)(n);case 5:if(!((r=e.sent).exists()&&r.data().badges&&r.data().badges.length>0)){e.next=9;break}return console.log("I badge utente esistono gi:",r.data().badges),e.abrupt("return",r.data().badges);case 9:if(i=["season1-badge"],r.exists()){e.next=15;break}return e.next=13,(0,I.BN)(n,{badges:i,selectedBadge:i[0],stats:{totalGames:0,highestMultiplier:0,wins:0},createdAt:new Date});case 13:e.next=17;break;case 15:return e.next=17,(0,I.mZ)(n,{badges:i,selectedBadge:i[0],stats:{totalGames:0,highestMultiplier:0,wins:0}},{merge:!0});case 17:return console.log("Badge utente inizializzati:",i),e.abrupt("return",i);case 21:return e.prev=21,e.t0=e.catch(0),console.error("Errore nell'inizializzazione dei badge:",e.t0),e.abrupt("return",["season1-badge"]);case 25:case"end":return e.stop()}}),e,null,[[0,21]])}))),function(e){return s.apply(this,arguments)})},{key:"getUserBadges",value:(i=C(S().mark((function e(t){var n,r,i,s,o;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Recupero badge per utente:",t),n=(0,I.H9)(f.db,"users",t),e.next=5,(0,I.x7)(n);case 5:if((r=e.sent).exists()){e.next=19;break}return console.log("Utente non trovato, inizializzazione nuovo profilo"),e.prev=8,e.next=11,this.initializeUserBadges(t);case 11:return i=e.sent,e.abrupt("return",{badges:i||["season1-badge"],selectedBadge:i&&i.length>0?i[0]:"season1-badge"});case 15:return e.prev=15,e.t0=e.catch(8),console.error("Errore nell'inizializzazione dei badge:",e.t0),e.abrupt("return",{badges:["season1-badge"],selectedBadge:"season1-badge"});case 19:if(s=r.data(),console.log("Dati utente recuperati:",s),s.badges&&0!==s.badges.length){e.next=34;break}return console.log("Badge non trovati, inizializzazione..."),e.prev=23,e.next=26,this.initializeUserBadges(t);case 26:return o=e.sent,e.abrupt("return",{badges:o||["season1-badge"],selectedBadge:o&&o.length>0?o[0]:"season1-badge"});case 30:return e.prev=30,e.t1=e.catch(23),console.error("Errore nell'inizializzazione dei badge:",e.t1),e.abrupt("return",{badges:["season1-badge"],selectedBadge:"season1-badge"});case 34:return e.abrupt("return",{badges:s.badges||["season1-badge"],selectedBadge:s.selectedBadge||s.badges[0]||"season1-badge"});case 37:return e.prev=37,e.t2=e.catch(0),console.error("Errore nel recupero dei badge:",e.t2),e.abrupt("return",{badges:["season1-badge"],selectedBadge:"season1-badge"});case 41:case"end":return e.stop()}}),e,this,[[0,37],[8,15],[23,30]])}))),function(e){return i.apply(this,arguments)})},{key:"selectBadge",value:function(){var e=C(S().mark((function e(t,n){var r;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBadges(t);case 3:if(e.sent.badges.includes(n)){e.next=8;break}return console.error("Badge non disponibile per questo utente"),e.abrupt("return",!1);case 8:return r=(0,I.H9)(f.db,"users",t),e.next=11,(0,I.mZ)(r,{selectedBadge:n});case 11:return console.log("Badge selezionato aggiornato:",n),e.abrupt("return",!0);case 15:return e.prev=15,e.t0=e.catch(0),console.error("Errore nella selezione del badge:",e.t0),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,this,[[0,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"unlockBadge",value:(r=C(S().mark((function e(t,n){var r;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBadges(t);case 3:if(!e.sent.badges.includes(n)){e.next=8;break}return console.log("Badge gi sbloccato"),e.abrupt("return",!0);case 8:return r=(0,I.H9)(f.db,"users",t),e.next=11,(0,I.mZ)(r,{badges:(0,I.hq)(n)});case 11:return console.log("Badge sbloccato:",n),e.abrupt("return",!0);case 15:return e.prev=15,e.t0=e.catch(0),console.error("Errore nello sblocco del badge:",e.t0),e.abrupt("return",!1);case 19:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(e,t){return r.apply(this,arguments)})},{key:"checkBadgeAchievements",value:(n=C(S().mark((function e(t,n){var r,i,s,o,a;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=n.wins,i=n.highestMultiplier,s=n.totalGames,e.next=4,this.getUserBadges(t);case 4:if(o=e.sent,a=o.badges,!(r>=1)||a.includes("ryanair-badge")){e.next=9;break}return e.next=9,this.unlockBadge(t,"ryanair-badge");case 9:if(!(r>=3)||a.includes("easyjet-badge")){e.next=12;break}return e.next=12,this.unlockBadge(t,"easyjet-badge");case 12:if(!(r>=5)||a.includes("vueling-badge")){e.next=15;break}return e.next=15,this.unlockBadge(t,"vueling-badge");case 15:if(!(r>=10)||a.includes("lufthansa-badge")){e.next=18;break}return e.next=18,this.unlockBadge(t,"lufthansa-badge");case 18:if(!(r>=20)||a.includes("airfrance-badge")){e.next=21;break}return e.next=21,this.unlockBadge(t,"airfrance-badge");case 21:if(!(r>=30)||a.includes("british-badge")){e.next=24;break}return e.next=24,this.unlockBadge(t,"british-badge");case 24:if(1!==i||a.includes("alitalia-badge")){e.next=27;break}return e.next=27,this.unlockBadge(t,"alitalia-badge");case 27:if(!(i>4.99)||a.includes("wizz-badge")){e.next=30;break}return e.next=30,this.unlockBadge(t,"wizz-badge");case 30:if(!(i>9.99)||a.includes("klm-badge")){e.next=33;break}return e.next=33,this.unlockBadge(t,"klm-badge");case 33:if(!(s>=50)||a.includes("finnair-badge")){e.next=36;break}return e.next=36,this.unlockBadge(t,"finnair-badge");case 36:return e.abrupt("return",!0);case 39:return e.prev=39,e.t0=e.catch(0),console.error("Errore nel controllo dei badge:",e.t0),e.abrupt("return",!1);case 43:case"end":return e.stop()}}),e,this,[[0,39]])}))),function(e,t){return n.apply(this,arguments)})},{key:"updateUserStats",value:function(){var e=C(S().mark((function e(t,n){var r;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,I.H9)(f.db,"users",t),e.next=4,(0,I.mZ)(r,{stats:n},{merge:!0});case 4:return e.next=6,this.checkBadgeAchievements(t,n);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(0),console.error("Errore nell'aggiornamento delle statistiche:",e.t0),e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getBadgeInfo",value:function(e){return this.badges[e]||null}},{key:"getAllBadges",value:function(){return this.badges}}],t&&A(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,r,i,s}();const O=new x;var L=document.createElement("style");function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function D(){D=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var s=t&&t.prototype instanceof y?t:y,o=Object.create(s.prototype),a=new x(r||[]);return i(o,"_invoke",{value:k(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function v(){}function w(){}var b={};u(b,o,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(O([])));_&&_!==n&&r.call(_,o)&&(b=_);var I=w.prototype=y.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,s,o,a){var c=h(e[i],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==R(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function k(t,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===m){if("throw"===s)throw o;return{value:e,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=C(a,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?m:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=m,r.method="throw",r.arg=u.arg)}}}function C(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,g;var o=s.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(R(t)+" is not iterable")}return v.prototype=w,i(I,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},T(S.prototype),u(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new S(l(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(I),u(I,c,"Generator"),u(I,o,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function P(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function M(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){P(s,r,i,o,a,"next",e)}function a(e){P(s,r,i,o,a,"throw",e)}o(void 0)}))}}L.textContent="\n  @keyframes shake {\n    0% { transform: translate(0, 0); }\n    10% { transform: translate(-10px, 0); }\n    20% { transform: translate(10px, 0); }\n    30% { transform: translate(-10px, 0); }\n    40% { transform: translate(10px, 0); }\n    50% { transform: translate(-10px, 0); }\n    60% { transform: translate(10px, 0); }\n    70% { transform: translate(-10px, 0); }\n    80% { transform: translate(10px, 0); }\n    90% { transform: translate(-10px, 0); }\n    100% { transform: translate(0, 0); }\n  }\n  \n  .shake {\n    animation: shake 0.5s;\n  }\n",document.head.appendChild(L);var U={multiplier:0,isWinner:!1};function F(e){document.getElementById("multiplier-display").textContent="".concat(e.toFixed(2),"x"),function(e){var t,n=document.getElementById("multiplier-animation"),r=Math.min(e/10*100,100);if(n.style.height="".concat(r,"%"),e<2){var i=Math.floor((e-1)/1*255);t="rgba(".concat(i,", ").concat(255,", 0, 0.2)")}else if(e<5){var s=Math.floor(255*(1-(e-2)/3));t="rgba(255, ".concat(s,", 0, 0.3)")}else t="rgba(255, 0, 0, 0.4)";n.style.backgroundColor=t}(e),U.multiplier=e}function V(e){document.getElementById("credit-amount").textContent=e.toFixed(2)}function j(e){document.getElementById("status-message").textContent=e}function B(e){var t=document.getElementById("resurrection-bonus");e.resurrection?t.classList.add("active"):t.classList.remove("active")}function z(){return q.apply(this,arguments)}function q(){return(q=M(D().mark((function e(){var t,n,r;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_()){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,n=t.uid||t.id,e.next=7,$(n);case 7:return(r=e.sent)||(r={totalGames:0,highestMultiplier:0,wins:0}),r.totalGames=(r.totalGames||0)+1,U.multiplier>(r.highestMultiplier||0)&&(r.highestMultiplier=U.multiplier),U.isWinner&&(r.wins=(r.wins||0)+1),e.next=14,K(n,r);case 14:return e.next=16,O.checkBadgeAchievements(n,r);case 16:console.log("Statistiche aggiornate:",r),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(3),console.error("Errore nell'elaborazione dei risultati del gioco:",e.t0);case 22:case"end":return e.stop()}}),e,null,[[3,19]])})))).apply(this,arguments)}function $(e){return G.apply(this,arguments)}function G(){return(G=M(D().mark((function e(t){var n,r;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,I.H9)(f.db,"users",t),e.next=4,(0,I.x7)(n);case 4:if(!(r=e.sent).exists()||!r.data().stats){e.next=7;break}return e.abrupt("return",r.data().stats);case 7:return e.abrupt("return",null);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Errore nel recupero delle statistiche utente:",e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function K(e,t){return H.apply(this,arguments)}function H(){return(H=M(D().mark((function e(t,n){var r,i;return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=(0,I.H9)(f.db,"users",t),e.next=4,(0,I.mZ)(r,{stats:n},{merge:!0});case 4:return(i=JSON.parse(sessionStorage.getItem("user"))||{}).stats=n,sessionStorage.setItem("user",JSON.stringify(i)),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Errore nell'aggiornamento delle statistiche:",e.t0),e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function Q(){Q=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var s=t&&t.prototype instanceof y?t:y,o=Object.create(s.prototype),a=new x(r||[]);return i(o,"_invoke",{value:k(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function v(){}function w(){}var b={};u(b,o,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(O([])));_&&_!==n&&r.call(_,o)&&(b=_);var I=w.prototype=y.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,s,o,a){var c=h(e[i],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==W(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function k(t,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===m){if("throw"===s)throw o;return{value:e,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=C(a,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?m:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=m,r.method="throw",r.arg=u.arg)}}}function C(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,g;var o=s.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(W(t)+" is not iterable")}return v.prototype=w,i(I,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},T(S.prototype),u(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new S(l(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(I),u(I,c,"Generator"),u(I,o,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Y(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function X(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){Y(s,r,i,o,a,"next",e)}function a(e){Y(s,r,i,o,a,"throw",e)}o(void 0)}))}}function Z(){return Z=X(Q().mark((function e(t){var n,r,i,s,o;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("create-room-button"),r=document.getElementById("join-room-button"),i=document.getElementById("leave-room-button"),s=document.getElementById("profile-button"),o=document.getElementById("back-from-profile"),n.addEventListener("click",(function(){var e,n=document.getElementById("room-name").value.trim(),r=document.getElementById("room-code").value.trim(),i=parseFloat(document.getElementById("initial-credits").value),s=parseInt(document.getElementById("round-count").value),o=(null===(e=document.getElementById("enable-bonuses"))||void 0===e?void 0:e.checked)||!1;n&&r?isNaN(i)||i<=0?alert("Initial credits must be a positive number"):isNaN(s)||s<=0||s>20?alert("Round count must be between 1 and 20"):t.emit("createRoom",{roomName:n,roomCode:r,initialCredits:i,roundCount:s,enableBonuses:o,userData:_()}):alert("Please fill in room name and code")})),r.addEventListener("click",(function(){var e=document.getElementById("join-room-code").value.trim();e?t.emit("joinRoom",{roomCode:e,userData:_()}):alert("Please enter a room code")})),i.addEventListener("click",(function(){t.emit("leaveRoom"),ke("lobby-screen")})),null==s||s.addEventListener("click",(function(){ke("profile-screen")})),null==o||o.addEventListener("click",(function(){ke("lobby-screen")})),t.on("gameOver",function(){var e=X(Q().mark((function e(t){var n,r;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=_()){e.next=3;break}return e.abrupt("return");case 3:if(!(null===(n=t.players)||void 0===n?void 0:n.find((function(e){return e.isWinner&&(e.id===r.uid||e.id===r.id)})))){e.next=13;break}return e.prev=5,e.next=8,z();case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("Error processing game results for badges:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])})));return function(t){return e.apply(this,arguments)}}());case 11:case"end":return e.stop()}}),e)}))),Z.apply(this,arguments)}function ee(e){document.getElementById("room-title").textContent=e.roomName,document.getElementById("round-info").textContent="Round ".concat(e.currentRound,"/").concat(e.roundCount),document.getElementById("room-code-display").textContent="Code: ".concat(e.roomCode)}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=X(Q().mark((function e(t){var n,r;return Q().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=document.getElementById("players-container")).innerHTML="",!(r=_())){e.next=15;break}return e.prev=5,e.next=8,O.getUserBadges(r.uid||r.id);case 8:e.sent.badges,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),console.error("Error loading user badges:",e.t0);case 15:t.forEach((function(e){var t=document.createElement("div");t.className="player-item";var i=document.createElement("div");i.className="player-name";var s=document.createElement("div");if(s.className="player-badge",r&&(e.id===r.uid||e.id===r.id)&&e.selectedBadge){var o=document.createElement("img"),a=O.getBadgeInfo(e.selectedBadge);a?(o.src=a.image,o.alt=a.name,s.appendChild(o)):s.textContent=""}else s.textContent="";var c=document.createElement("span");c.textContent=e.username,i.appendChild(s),i.appendChild(c);var u=document.createElement("div");u.className="player-status";var l=document.createElement("div");l.className="status-indicator ".concat(e.ready?"ready":"not-ready");var h=document.createElement("span");h.textContent=e.ready?"Ready":"Not Ready";var d=document.createElement("div");d.className="player-credits",d.textContent="".concat(e.credits.toFixed(2)," credits"),u.appendChild(l),u.appendChild(h),t.appendChild(i),t.appendChild(d),t.appendChild(u),n.appendChild(t)}));case 16:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function re(e){e.on("registered",(function(e){console.log("Registered with server:",e)})),e.on("roomCreated",(function(e){console.log("Room created:",e),ee(e),ke("game-room-screen")})),e.on("roomJoined",(function(e){console.log("Room joined:",e),ee(e),ke("game-room-screen")})),e.on("playerJoined",(function(t){te(t);var n=t.find((function(t){return t.id===e.id}));n&&(V(n.credits),B(n.bonuses)),j("".concat(t.length," player(s) in room. Waiting for game to start..."))})),e.on("playerLeft",(function(e){te(e.players)})),e.on("playerReadyUpdate",(function(e){te(e)})),e.on("roundStarting",(function(e){console.log("Round ".concat(e.roundNumber,"/").concat(e.totalRounds," starting...")),ee({roomName:document.getElementById("room-title").textContent,currentRound:e.roundNumber,roundCount:e.totalRounds,roomCode:document.getElementById("room-code-display").textContent.replace("Code: ","")}),document.getElementById("results-screen").classList.add("hidden"),j("Round ".concat(e.roundNumber," starting..."))})),e.on("countdown",(function(e){console.log("Countdown:",e),function(e){var t=document.getElementById("multiplier-display");t.textContent=e.toString(),t.style.fontSize="6rem",0===e&&setTimeout((function(){t.style.fontSize="4rem",t.textContent="1.00x"}),1e3)}(e)})),e.on("roundStarted",(function(){var e,t,n;console.log("Round started!"),e=document.getElementById("ready-button"),t=document.getElementById("eject-button"),n=document.getElementById("bet-amount"),e.disabled=!0,e.textContent="Round in progress",t.disabled=!1,t.textContent="EJECT",n.disabled=!0,F(1),U={multiplier:0,isWinner:!1}})),e.on("multiplierUpdate",(function(e){F(e)})),e.on("playerEjected",(function(t){console.log("Player ".concat(t.playerId," ejected at ").concat(t.multiplier,"x")),t.playerId===e.id&&(j("You ejected at ".concat(t.multiplier.toFixed(2),"x!")),void 0!==t.credits&&V(t.credits))})),e.on("gameCrashed",(function(t){console.log("Game crashed at ".concat(t.crashPoint,"x")),function(){var e=document.querySelector(".multiplier-container"),t=document.getElementById("multiplier-animation");e.classList.add("shake"),t.style.backgroundColor="rgba(255, 0, 0, 0.6)",t.style.height="100%";var n=document.getElementById("multiplier-display");n.textContent="CRASHED!",n.style.color="#ea4335",setTimeout((function(){e.classList.remove("shake")}),1e3)}(),function(e,t){document.getElementById("results-screen").classList.remove("hidden"),document.getElementById("crash-point").textContent="Crashed at ".concat(t.toFixed(2),"x");var n=document.getElementById("results-list");n.innerHTML="";var r,i=_(),s=null;if(i&&(s=e.find((function(e){return e.id===i.uid||e.id===i.id})))){var o=Math.max.apply(Math,function(e){if(Array.isArray(e))return J(e)}(r=e.map((function(e){return e.multiplier})))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());s.multiplier===o&&(s.isWinner=!0)}e.forEach((function(e){var t=document.createElement("div");t.className="result-item",!i||e.id!==i.uid&&e.id!==i.id||t.classList.add("current-user-result"),e.isWinner&&t.classList.add("winner-result");var r=document.createElement("div");r.className="player-info",r.textContent=e.username;var s=document.createElement("div");s.className="result-info";var o=document.createElement("span");o.className="result-multiplier",o.textContent="".concat(e.multiplier.toFixed(2),"x");var a=document.createElement("span");a.className="bet-amount",a.textContent=" (".concat(e.betAmount.toFixed(2),")");var c=document.createElement("span");if(c.className="result-credits",c.textContent=" - ".concat(e.credits.toFixed(2)," credits"),s.appendChild(o),s.appendChild(a),s.appendChild(c),e.resurrectionUsed){var u=document.createElement("span");u.className="resurrection-used",u.textContent=" (Resurrection Used)",s.appendChild(u)}t.appendChild(r),t.appendChild(s),n.appendChild(t)})),s&&s.isWinner&&z()}(t.results,t.crashPoint);var n=t.results.find((function(t){return t.id===e.id}));n&&(V(n.credits),n.resurrectionUsed?(j("You crashed but Resurrection saved you!"),B({resurrection:!1})):0===n.multiplier?j("You crashed!"):j("You ejected at ".concat(n.multiplier.toFixed(2),"x!")))})),e.on("waitingForReady",(function(){var e,t,n;console.log("Waiting for players to ready up"),e=document.getElementById("ready-button"),t=document.getElementById("eject-button"),n=document.getElementById("bet-amount"),e.disabled=!1,e.textContent="Ready",t.disabled=!0,t.textContent="EJECT",n.disabled=!1,j("Get ready for the next round!"),function(e,t,n){var r=document.getElementById("countdown-timer"),i=document.getElementById("timer-value");r.classList.remove("hidden"),i.textContent=10;var s=10,o=setInterval((function(){s--,i.textContent=s,s<=0&&(clearInterval(o),r.classList.add("hidden"),n&&n())}),1e3)}(0,0,(function(){j("Please click Ready when you are prepared for the next round.")}))})),e.on("gameEnded",(function(e){console.log("Game ended, winner:",e.winner),alert("Game over! Winner: ".concat(e.winner.username," with ").concat(e.winner.credits.toFixed(2)," credits!")),ke("lobby-screen")})),e.on("chatMessage",(function(e){!function(e,t){var n=document.getElementById("chat-messages"),r=document.createElement("div");r.className="chat-message";var i=document.createElement("span");i.className="chat-username",i.textContent=e+": ";var s=document.createElement("span");s.className="chat-text",s.textContent=t,r.appendChild(i),r.appendChild(s),n.appendChild(r),n.scrollTop=n.scrollHeight}(e.username,e.message)})),e.on("error",(function(e){console.error("Socket error:",e),alert(e.message)}))}function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function se(){se=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var s=t&&t.prototype instanceof y?t:y,o=Object.create(s.prototype),a=new x(r||[]);return i(o,"_invoke",{value:k(e,n,a)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",m="completed",g={};function y(){}function v(){}function w(){}var b={};u(b,o,(function(){return this}));var E=Object.getPrototypeOf,_=E&&E(E(O([])));_&&_!==n&&r.call(_,o)&&(b=_);var I=w.prototype=y.prototype=Object.create(b);function T(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,s,o,a){var c=h(e[i],e,s);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==ie(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,a)}),(function(e){n("throw",e,o,a)})):t.resolve(l).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return s=s?s.then(i,i):i()}})}function k(t,n,r){var i=d;return function(s,o){if(i===p)throw Error("Generator is already running");if(i===m){if("throw"===s)throw o;return{value:e,done:!0}}for(r.method=s,r.arg=o;;){var a=r.delegate;if(a){var c=C(a,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var u=h(t,n,r);if("normal"===u.type){if(i=r.done?m:f,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=m,r.method="throw",r.arg=u.arg)}}}function C(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,C(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var s=h(i,t.iterator,n.arg);if("throw"===s.type)return n.method="throw",n.arg=s.arg,n.delegate=null,g;var o=s.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function O(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return s.next=s}}throw new TypeError(ie(t)+" is not iterable")}return v.prototype=w,i(I,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:v,configurable:!0}),v.displayName=u(w,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,u(e,c,"GeneratorFunction")),e.prototype=Object.create(I),e},t.awrap=function(e){return{__await:e}},T(S.prototype),u(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,n,r,i,s){void 0===s&&(s=Promise);var o=new S(l(e,n,r,i),s);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(I),u(I,c,"Generator"),u(I,o,(function(){return this})),u(I,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=O,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return a.type="throw",a.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;N(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:O(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function oe(e,t,n,r,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function ae(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function o(e){oe(s,r,i,o,a,"next",e)}function a(e){oe(s,r,i,o,a,"throw",e)}o(void 0)}))}}function ce(){return ue.apply(this,arguments)}function ue(){return(ue=ae(se().mark((function e(){var t,n,r,i,s,o,a,c,u,l,h,d;return se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=_()){e.next=3;break}return e.abrupt("return");case 3:return document.querySelectorAll(".profile-username").forEach((function(e){var n=t.username;e.innerHTML="";var r=document.createElement("span");r.textContent=n,e.appendChild(r);var i=document.createElement("button");i.className="edit-button",i.innerHTML="<span></span>",i.addEventListener("click",ye),e.appendChild(i)})),(n=document.getElementById("profile-username"))&&!n.querySelector(".edit-button")&&(r=n.textContent.trim()||t.username,n.classList.add("profile-username"),n.innerHTML="",(i=document.createElement("span")).textContent=r,n.appendChild(i),(s=document.createElement("button")).className="edit-button",s.innerHTML="<span></span>",s.addEventListener("click",ye),n.appendChild(s)),e.prev=7,o=t.uid||t.id,console.log("Caricamento profilo per utente:",o),e.next=12,O.getUserBadges(o);case 12:if(a=e.sent,c=a.badges,u=a.selectedBadge,c&&0!==c.length){e.next=21;break}return console.log("Inizializzazione badge utente..."),e.next=19,O.initializeUserBadges(o);case 19:c=e.sent,u=c&&c.length>0?c[0]:null;case 21:if(console.log("Badge utente:",c,"Badge selezionato:",u),l={totalGames:0,highestMultiplier:0,wins:0},!(h=le())){e.next=28;break}return e.next=27,O.updateUserStats(o,h);case 27:l=h;case 28:return he(l),e.next=31,de(c,u,o);case 31:e.next=46;break;case 33:return e.prev=33,e.t0=e.catch(7),console.error("Errore nel caricamento del profilo:",e.t0),(d=le())&&he(d),e.prev=38,e.next=41,de(["season1-badge"],"season1-badge",t.uid||t.id);case 41:e.next=46;break;case 43:e.prev=43,e.t1=e.catch(38),console.error("Errore nel caricamento fallback dei badge:",e.t1);case 46:case"end":return e.stop()}}),e,null,[[7,33],[38,43]])})))).apply(this,arguments)}function le(){try{var e=JSON.parse(sessionStorage.getItem("user"));return e&&e.stats?e.stats:{totalGames:0,highestMultiplier:0,wins:0}}catch(e){return console.error("Errore nel recupero delle statistiche locali:",e),null}}function he(e){document.getElementById("total-games").textContent=e.totalGames||0,document.getElementById("highest-multiplier").textContent="".concat((e.highestMultiplier||0).toFixed(2),"x"),document.getElementById("games-won").textContent=e.wins||0}function de(){return fe.apply(this,arguments)}function fe(){return fe=ae(se().mark((function e(){var t,n,r,i,s,o,a,c,u,l,h=arguments;return se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=h.length>0&&void 0!==h[0]?h[0]:[],n=h.length>1?h[1]:void 0,r=h.length>2?h[2]:void 0,i=document.getElementById("badges-list")){e.next=6;break}return e.abrupt("return");case 6:if(i.innerHTML="",console.log("Caricamento badge:",t,"Badge selezionato:",n),t&&0!==t.length){e.next=22;break}return e.prev=9,e.next=12,O.initializeUserBadges(r);case 12:s=e.sent,t=s||["season1-badge"],n=n||"season1-badge",console.log("Badge inizializzati:",t),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(9),console.error("Errore nell'inizializzazione dei badge:",e.t0),t=["season1-badge"];case 22:o=O.getAllBadges(),(a=document.createElement("div")).className="badge-rows",(c=document.createElement("div")).className="badge-row season-row",(u=document.createElement("div")).className="badge-row",(l=document.createElement("div")).className="badge-row",Object.values(o).forEach((function(e){var i=t.includes(e.id),s=n===e.id,o=document.createElement("div");o.className="badge-item ".concat(i?"":"badge-locked"," ").concat(s?"selected badge-selected":""),o.dataset.badgeId=e.id;var a=document.createElement("div");a.className="badge-icon";var h=document.createElement("img");h.src=e.image,h.alt=e.name,h.onerror=function(){console.warn("Errore nel caricamento dell'immagine badge:",e.image),h.src="asset/images/badges/default-badge.png"},a.appendChild(h);var d=document.createElement("div");d.className="badge-name",d.textContent=e.name;var f=document.createElement("div");f.className="badge-tooltip",f.textContent=i?"Badge sbloccato: ".concat(e.description):"Requisito: ".concat(e.requirement);var p=document.createElement("div");p.className="tooltip-arrow",f.appendChild(p),o.appendChild(a),o.appendChild(d),o.appendChild(f),o.addEventListener("mouseenter",(function(){if(f.style.display="block",f.getBoundingClientRect().top<0){f.style.top="80px",f.style.bottom="auto";var e=f.querySelector(".tooltip-arrow");e&&(e.style.top="-8px",e.style.bottom="auto",e.style.borderBottom="8px solid rgba(24, 25, 37, 0.9)",e.style.borderTop="none")}})),o.addEventListener("mouseleave",(function(){f.style.display="none"})),i&&o.addEventListener("click",(function(){return me(e.id,r)})),"season1-badge"===e.id?c.appendChild(o):["ryanair-badge","easyjet-badge","alitalia-badge","vueling-badge","wizz-badge"].includes(e.id)?u.appendChild(o):l.appendChild(o)})),a.appendChild(c),a.appendChild(u),a.appendChild(l),i.appendChild(a),pe(n);case 37:case"end":return e.stop()}}),e,null,[[9,18]])}))),fe.apply(this,arguments)}function pe(e){var t=O.getBadgeInfo(e);if(t){console.log("Aggiornamento badge selezionato:",e,t);var n=document.getElementById("selected-badge");if(n){n.innerHTML="";var r=document.createElement("img");r.src=t.image,r.alt=t.name,r.className="selected-badge-img",r.style.width="24px",r.style.height="24px",r.style.marginRight="8px",r.style.borderRadius="50%",r.onerror=function(){console.warn("Errore nel caricamento dell'immagine badge:",t.image),r.src="asset/images/badges/default-badge.png"},n.appendChild(r),n.appendChild(document.createTextNode(t.name))}else console.warn("Elemento selected-badge non trovato");var i=document.getElementById("selected-badge-icon");i?(i.src=t.image,i.onerror=function(){console.warn("Errore nel caricamento dell'immagine badge:",t.image),i.src="asset/images/badges/default-badge.png"}):console.warn("Elemento selected-badge-icon non trovato")}else console.warn("Badge info non trovate per:",e)}function me(e,t){return ge.apply(this,arguments)}function ge(){return(ge=ae(se().mark((function e(t,n){var r;return se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.selectBadge(n,t);case 3:document.querySelectorAll(".badge-item").forEach((function(e){e.classList.remove("selected","badge-selected"),e.dataset.badgeId===t&&e.classList.add("selected","badge-selected")})),pe(t),(r=JSON.parse(sessionStorage.getItem("user")))&&(r.selectedBadge=t,sessionStorage.setItem("user",JSON.stringify(r))),console.log("Badge selezionato aggiornato:",t),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Errore nella selezione del badge:",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function ye(){var e=document.getElementById("edit-username-modal");if(!e){var t=document.createElement("div");t.innerHTML='\n<div id="edit-username-modal" class="modal hidden">\n  <div class="modal-content">\n    <div class="modal-header">\n      <h3>Modifica Username</h3>\n      <button class="close-modal"></button>\n    </div>\n    <div class="modal-body">\n      <input type="text" id="new-username" placeholder="Nuovo username">\n      <button id="save-username-button" class="primary-button">Salva</button>\n    </div>\n  </div>\n</div>\n',document.body.appendChild(t.firstElementChild),(e=document.getElementById("edit-username-modal")).querySelector(".close-modal").addEventListener("click",ve),e.querySelector("#save-username-button").addEventListener("click",we),e.addEventListener("click",(function(t){t.target===e&&ve()})),document.addEventListener("keydown",(function(t){"Escape"!==t.key||e.classList.contains("hidden")||ve()}))}var n=_();n&&(e.querySelector("#new-username").value=n.username),e.classList.remove("hidden")}function ve(){var e=document.getElementById("edit-username-modal");e&&e.classList.add("hidden")}function we(){return be.apply(this,arguments)}function be(){return(be=ae(se().mark((function e(){var t,r,i,s,o,a,c,u,l,h,d;return se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("new-username"),r=t.value.trim()){e.next=5;break}return alert("Inserisci un username valido"),e.abrupt("return");case 5:if(i=_()){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,e.next=11,Promise.resolve().then(n.bind(n,632));case 11:if(s=e.sent,o=s.isUsernameAvailable,a=s.updateUsername,i.username===r){e.next=27;break}return e.next=17,o(r);case 17:if(e.sent){e.next=21;break}return alert("Username gi in uso. Scegline un altro."),e.abrupt("return");case 21:return e.next=23,a(i.uid||i.id,i.username,r);case 23:if((c=e.sent).success){e.next=27;break}return alert(c.error||"Errore nell'aggiornamento dell'username"),e.abrupt("return");case 27:(u=JSON.parse(sessionStorage.getItem("user")))&&(u.username=r,sessionStorage.setItem("user",JSON.stringify(u)),u.id&&localStorage.setItem("username_"+u.id,r)),document.querySelectorAll(".profile-username span").forEach((function(e){e.textContent=r})),(l=document.getElementById("username-display"))&&(l.textContent=r),(h=document.getElementById("profile-username"))&&h.querySelector("span")&&(h.querySelector("span").textContent=r),(d=document.getElementById("profile-tab-username"))&&(d.textContent=r),ve(),e.next=43;break;case 39:e.prev=39,e.t0=e.catch(8),console.error("Errore nell'aggiornamento dell'username:",e.t0),alert("Si  verificato un errore. Riprova pi tardi.");case 43:case"end":return e.stop()}}),e,null,[[8,39]])})))).apply(this,arguments)}function Ee(e){var t=document.getElementById("chat-input"),n=t.value.trim();if(n){var r=_();r&&(e.emit("sendChatMessage",{username:r.username,message:n}),t.value="")}}var _e=n(223);console.log("Inizializzazione Firebase");var Ie=(0,_e.Wp)({apiKey:"AIzaSyA8TdGdbX6HDAyRSid7MMrDf0kzNqtUe3U",authDomain:"cabincrew-aa740.firebaseapp.com",projectId:"cabincrew-aa740",storageBucket:"cabincrew-aa740.firebasestorage.app",messagingSenderId:"835219215914",appId:"1:835219215914:web:c2b5f16472053b67725553",measurementId:"G-9XPK3JMETS"}),Te=(0,p.xI)(Ie),Se=io();function ke(e){console.log("Cambio schermata a:",e),document.querySelectorAll(".screen").forEach((function(e){e.classList.add("hidden")})),document.getElementById(e).classList.remove("hidden")}document.addEventListener("DOMContentLoaded",(function(){var e;console.log("DOM caricato, inizializzazione componenti"),re(Se),function(e,t){var n=document.getElementById("auth-button"),r=document.getElementById("username");n.addEventListener("click",(function(){var n=r.value.trim()||"Guest";console.log("Tentativo di login anonimo con username:",n),(0,p.zK)(t).then((function(t){console.log("Login anonimo riuscito:",t.user.uid),E(t.user,n,e)})).catch((function(t){console.error("Errore login anonimo:",t),console.log("Fallback su mock user"),E({uid:"guest-"+Date.now(),email:"guest@example.com",isAnonymous:!0},n,e)}))}))}(Se,Te),function(e){Z.apply(this,arguments)}(Se),function(e){var t=document.getElementById("ready-button"),n=document.getElementById("eject-button"),r=document.getElementById("bet-amount"),i=document.getElementById("sit-out-button");n.disabled=!0,t.addEventListener("click",(function(){var n=parseFloat(r.value);isNaN(n)||n>0&&n<.1||n>100?alert("La puntata deve essere 0 per saltare o tra 0.10 e 100"):(e.emit("playerReady",{betAmount:n}),t.disabled=!0,t.textContent="Waiting for others...")})),i.addEventListener("click",(function(){r.value="0",e.emit("playerReady",{betAmount:0}),t.disabled=!0,t.textContent="Sitting out..."})),n.addEventListener("click",(function(){var t=parseFloat(r.value);e.emit("eject",{betAmount:t}),n.disabled=!0,n.textContent="Ejected!"})),r.addEventListener("change",(function(){var e=parseFloat(r.value);e>0&&e<.1?r.value="0.10":e>100&&(r.value="100")})),e.on("roundResults",(function(e){if(e&&e.players){var t=_();if(t){var n=e.players.find((function(e){return e.id===t.uid||e.id===t.id}));n&&(U.multiplier=n.multiplier||0,U.isWinner=n.isWinner||!1,z())}}}))}(Se),(e=document.querySelector('.tab-button[data-tab="profile-tab"]'))&&e.addEventListener("click",(function(){setTimeout(ce,50)})),ce(),setTimeout(ce,500),function(e){var t=document.getElementById("chat-button"),n=document.getElementById("chat-container"),r=document.getElementById("chat-input"),i=document.getElementById("send-message-button");t.addEventListener("click",(function(){n.classList.toggle("hidden"),n.classList.contains("hidden")||r.focus()})),i.addEventListener("click",(function(){Ee(e)})),r.addEventListener("keypress",(function(t){"Enter"===t.key&&Ee(e)}))}(Se),ke("auth-screen"),console.log("Inizializzazione completata")})),document.addEventListener("DOMContentLoaded",(function(){console.log("DOM caricato, inizializzazione componenti..."),setTimeout((function(){!function(){var e=document.getElementById("login-tab"),t=document.getElementById("register-tab"),n=document.getElementById("login-form"),r=document.getElementById("register-form"),i=document.getElementById("switch-to-register"),s=document.getElementById("switch-to-login"),o=document.getElementById("login-button"),a=document.getElementById("register-button");function c(){e.classList.add("active"),t.classList.remove("active"),n.classList.remove("hidden"),r.classList.add("hidden")}function u(){t.classList.add("active"),e.classList.remove("active"),r.classList.remove("hidden"),n.classList.add("hidden")}function l(){return(l=v(g().mark((function e(){var t,n,r,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("login-email").value,n=document.getElementById("login-password").value,t&&n){e.next=5;break}return alert("Compila tutti i campi richiesti"),e.abrupt("return");case 5:return e.prev=5,e.next=8,(0,p.x9)(f.auth,t,n);case 8:if(r=e.sent,(i=r.user).emailVerified){e.next=13;break}return alert("Per favore verifica la tua email prima di accedere."),e.abrupt("return");case 13:sessionStorage.setItem("user",JSON.stringify({id:i.uid,username:i.displayName||t.split("@")[0],email:i.email})),w(),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(5),console.error(e.t0),alert("Errore di login: "+e.t0.message);case 21:case"end":return e.stop()}}),e,null,[[5,17]])})))).apply(this,arguments)}function h(){return(h=v(g().mark((function e(){var t,n,r,i,s,o;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("register-username").value,n=document.getElementById("register-email").value,r=document.getElementById("register-password").value,i=document.getElementById("register-confirm-password").value,t&&n&&r&&i){e.next=7;break}return alert("Compila tutti i campi richiesti"),e.abrupt("return");case 7:if(r===i){e.next=10;break}return alert("Le password non corrispondono"),e.abrupt("return");case 10:return e.prev=10,e.next=13,(0,p.eJ)(f.auth,n,r);case 13:return s=e.sent,o=s.user,e.next=17,(0,p.gA)(o);case 17:alert("Registrazione completata! Ti abbiamo inviato un'email di conferma."),c(),e.next=25;break;case 21:e.prev=21,e.t0=e.catch(10),console.error(e.t0),alert("Errore di registrazione: "+e.t0.message);case 25:case"end":return e.stop()}}),e,null,[[10,21]])})))).apply(this,arguments)}e&&t&&n&&r?(e.addEventListener("click",c),t.addEventListener("click",u),i&&i.addEventListener("click",(function(e){e.preventDefault(),u()})),s&&s.addEventListener("click",(function(e){e.preventDefault(),c()})),o&&o.addEventListener("click",(function(){return l.apply(this,arguments)})),a&&a.addEventListener("click",(function(){return h.apply(this,arguments)}))):console.error("Elementi DOM per autenticazione non trovati")}(),f.auth.onAuthStateChanged((function(e){return!(!e||!e.emailVerified||(sessionStorage.setItem("user",JSON.stringify({id:e.uid,username:e.displayName||e.email.split("@")[0],email:e.email})),w(),0))})),o.playMenuMusic(),document.addEventListener("DOMContentLoaded",d),console.log("Inizializzazione completata")}),100)}))})();